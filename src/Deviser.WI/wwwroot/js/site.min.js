$(function(){$("#side-menu").metisMenu()}),function(){var e=angular.module("deviser.config",[]);e.config(function(e){e.appSettings.serviceBaseUrl="/api",e.appSettings.systemErrorMsg="Unexpected error has been occured, Please contact system administrator"}),e.provider("globals",function(){this.$get=function(){return{appSettings:e.appSettings}};var e=this;e.appSettings={serviceBaseUrl:"",systemErrorMsg:"",alertLifeTime:1e4,permissions:{pageView:"29cb1b57-1862-4300-b378-f3271b870148",pageEdit:"2da41181-be15-4ad6-a89c-3ba8b71f993b"},roles:{administrator:"9b461499-c49e-4398-bfed-4364a176ebbd"}}})}(),function(){function e(e,t,n,i,o,r,a,s,c,l,u,d,p,f){function g(){W.uaLayout={};I().then(function(){i.all([C(),L(),R(),M(),E()]).then(function(){x()})})}function v(e,t){{var n=$(e.currentTarget).scope().$parent;n.item.id}O(n.item)}function h(e,t,n){return n.sortOrder=t+1,n}function m(e,t){e.placeHolders.splice(t,1),console.log("itemMoved")}function y(e,t,n){return G(n),n}function S(e){("content"===e.layoutTemplate||"module"===e.layoutTemplate)&&(W.selectedItem=e)}function w(e){}function b(e){var t=i.defer(),n=o.open({animation:!0,size:"lg",openedClass:"edit-content-modal",backdrop:"static",templateUrl:"contenttypes/"+e.contentType.name+".html",controller:"EditContentCtrl as ecVM",resolve:{contentInfo:function(){var t=e;return t}}});return n.result.then(function(e){t.resolve("data received!")},function(){t.reject(SYS_ERROR_MSG)}),t.promise}function T(){if("content"===W.selectedItem.layoutTemplate){var e={},t=[];_.each(W.selectedItem.properties,function(e){if(e){var n={id:e.id,name:e.name,label:e.label,value:e.value};t.push(n)}}),e.id=W.selectedItem.pageContent.id,e.pageId=W.selectedItem.pageContent.pageId,e.contentTypeId=W.selectedItem.pageContent.contentTypeId,e.properties=t,e.containerId=W.selectedItem.pageContent.containerId,e.sortOrder=W.selectedItem.sortOrder,u.put(e).then(function(e){console.log(e)},function(e){console.log(e)})}}function I(){var e=i.defer();return c.get(pageContext.currentPageId).then(function(t){W.currentPage=t,e.resolve(t)},function(t){H("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}function E(){var e=i.defer();return f.get(pageContext.currentPageId).then(function(t){W.pageModules=t,e.resolve(t)},function(t){H("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}function C(){var e=i.defer();return s.get(W.currentPage.layoutId).then(function(t){pageLayout=t,e.resolve("data received")},function(t){H("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}function L(){var e=i.defer();return l.get().then(function(t){var n=t;W.contentTypes=[],_.each(n,function(e){W.contentTypes.push({layoutTemplate:"content",type:"content",contentType:e,properties:e.properties})}),e.resolve("data received!")},function(t){H("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}function R(){var e=i.defer();return p.get().then(function(t){var n=t;W.modules=[],_.each(n,function(e){W.modules.push({layoutTemplate:"module",type:"module",moduleAction:e})}),e.resolve("data received!")},function(e){H("error",SYS_ERROR_MSG),deferred.reject(SYS_ERROR_MSG)}),e.promise}function M(){var e=i.defer();return u.get(pageContext.currentPageId,pageContext.currentLocale).then(function(t){W.pageContents=t,e.resolve(t)},function(t){H("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}function x(){var e=[],t=[];P(pageLayout.placeHolders),W.pageLayout=pageLayout,W.pageLayout.pageId=W.currentPage.id;var n=_.reject(W.pageContents,function(e){return _.contains(q,e.containerId)}),i=_.reject(W.pageModules,function(e){return _.contains(q,e.containerId)});_.each(n,function(t){var n=A(t);e.push(n)}),_.each(i,function(e){var n=(e.sortOrder-1,{id:e.id,layoutTemplate:"module",type:"module",moduleAction:e.moduleAction,pageModule:e,sortOrder:e.sortOrder});t.push(n)}),W.uaLayout.placeHolders=[],W.uaLayout.placeHolders=W.uaLayout.placeHolders.concat(e),W.uaLayout.placeHolders=W.uaLayout.placeHolders.concat(t)}function P(e){e&&_.each(e,function(e){q.push(e.id);var t=_.where(W.pageContents,{containerId:e.id});t&&_.each(t,function(t){var n=A(t);e.placeHolders.push(n)});var n=_.where(W.pageModules,{containerId:e.id});n&&_.each(n,function(t){var n=(t.sortOrder-1,{id:t.id,layoutTemplate:"module",type:"module",moduleAction:t.moduleAction,pageModule:t,sortOrder:t.sortOrder});e.placeHolders.push(n)}),e.placeHolders=_.sortBy(e.placeHolders,"sortOrder"),e.placeHolders&&P(e.placeHolders)})}function A(e){var t=e.properties,n=_.find(W.contentTypes,function(t){return t.contentType.id===e.contentType.id}),i=angular.copy(n.properties);_.each(i,function(e){var n=_.findWhere(t,{id:e.id});n&&(e.value=n.value),e.propertyOptionList&&e.propertyOptionList.list&&(e.propertyOptionList=angular.fromJson(e.propertyOptionList.list))});var o={id:e.id,layoutTemplate:"content",type:"content",properties:i,pageContent:e,contentType:e.contentType,sortOrder:e.sortOrder};return o}function O(e){var t={contents:[],modules:[]};_.forEach(e.placeHolders,function(n,i){n.sortOrder=i+1,"content"===n.layoutTemplate?t.contents.push({element:n,containerId:e.id}):"module"===n.layoutTemplate&&t.modules.push({element:n,containerId:e.id})});var n=jQuery.extend(!0,{},W.pageLayout);k(n),console.log("--------------------------"),console.log("Layout only"),console.log(n),i.all([D(t),V(t),N(n)]).then(function(){H("success","Layout has been saved")})}function k(e){e.placeHolders=_.reject(e.placeHolders,function(e){return"content"===e.layoutTemplate||"module"===e.layoutTemplate}),_.forEach(e.placeHolders,function(e){e.placeHolders&&k(e)})}function D(e){var t=i.defer(),n=[];return _.each(e.contents,function(e){var t={};e.element.id?(t.id=e.element.pageContent.id,t.pageId=e.element.pageContent.pageId,t.contentTypeId=e.element.pageContent.contentTypeId):(t.id=W.newGuid(),t.pageId=pageContext.currentPageId,t.contentTypeId=e.element.contentType.id,e.element.id=t.id,e.element.pageContent=t);var i=[];_.each(e.element.properties,function(e){if(e){var t={id:e.id,name:e.name,label:e.label,value:e.value};i.push(t)}}),t.properties=i,t.containerId=e.containerId,t.sortOrder=e.element.sortOrder,n.push(t)}),n&&n.length>0?u.putContents(n).then(function(e){console.log(e),t.resolve("page content updated")},function(e){console.log(e),t.reject(SYS_ERROR_MSG)}):t.reject(SYS_ERROR_MSG),t.promise}function V(e){var t=i.defer(),n=[];return _.each(e.modules,function(e){var t={pageId:pageContext.currentPageId,containerId:e.containerId,sortOrder:e.element.sortOrder};e.element.id?t.id=e.element.id:(t.id=W.newGuid(),e.element.id=t.id),e.element.pageModule?(t.moduleId=e.element.pageModule.module.id,t.moduleActionId=e.element.pageModule.moduleActionId):(t.moduleId=e.element.moduleAction.module.id,t.moduleActionId=e.element.moduleAction.id),n.push(t)}),n&&n.length>0?f.putModules(n).then(function(e){console.log(e),t.resolve("page content updated")},function(e){t.reject(SYS_ERROR_MSG)}):t.reject(SYS_ERROR_MSG),t.promise}function N(e){var t=i.defer();return s.put(e).then(function(e){t.resolve("layout only updated")},function(e){H("error",SYS_ERROR_MSG),t.reject(SYS_ERROR_MSG)}),t.promise}function G(e){"content"===e.layoutTemplate?F(e.id):"module"===e.layoutTemplate&&U(e.id)}function F(e){u.remove(e).then(function(e){console.log(e)},function(e){H("error",SYS_ERROR_MSG)})}function U(e){f.remove(e).then(function(e){console.log(e)},function(e){H("error",SYS_ERROR_MSG)})}function H(e,n){W.message={messageType:e,content:n},t(function(){W.message={messageType:"",content:""}},r.appSettings.alertLifeTime)}var W=this,q=[];SYS_ERROR_MSG=r.appSettings.systemErrorMsg,W.alerts=[],W.pageLayout={},W.selectedItem={},W.deletedElements=[],W.layoutAllowedTypes=["container"],W.newGuid=a.getGuid,W.dropCallback=h,W.insertedCallback=v,W.itemMoved=m,W.deleteElement=y,W.selectItem=S,W.copyElement=w,W.editContent=b,W.saveProperties=T,g()}function t(e,t,n,i,o,r,a,s){function c(){var e=S(b.selectedLocale.cultureCode);b.contentTranslation=e,w()}function l(){b.contentTranslation.id?($(),a.put(b.contentTranslation).then(function(e){console.log(e),t.close("ok")},function(e){showMessage("error",SYS_ERROR_MSG)})):(b.contentTranslation.pageContentId=b.contentId,$(),a.post(b.contentTranslation).then(function(e){console.log(e),t.close("ok")},function(e){showMessage("error",SYS_ERROR_MSG)}))}function u(){t.dismiss("cancel")}function d(){b.selectedItem={},b.isDetailView=!0}function p(){b.selectedItem.id||(b.selectedItem.id=i.getGuid(),b.selectedItem.viewOrder=b.contentTranslation.contentData.items.length+1,b.contentTranslation.contentData.items.push(b.selectedItem)),b.isDetailView=!1}function f(e){b.selectedItem=e,b.isDetailView=!0}function g(e){var t=b.contentTranslation.contentData.items.indexOf(slideItem);b.contentTranslation.contentData.items.splice(t,1),b.isChanged=!0}function v(){b.isDetailView=!1}function h(){n.all([y(),m()]).then(function(){var e=pageContext.currentLocale;b.selectedLocale=_.findWhere(b.languages,{cultureCode:e});var t=S(b.selectedLocale.cultureCode);b.contentTranslation=t,"string"==typeof b.contentTranslation.contentData&&w()})}function m(){var e=n.defer();return o.getSiteLanguages().then(function(t){b.languages=t,e.resolve("data received!")},function(t){showMessage("error","Cannot get all languages, please contact administrator"),e.reject(SYS_ERROR_MSG)}),e.promise}function y(){var e=n.defer();return r.get(b.contentId).then(function(t){console.log(t),b.contentTranslations=t.pageContentTranslation,b.contentType=t.contentType,e.resolve("data received!")},function(t){showMessage("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}function S(e){var t=_.findWhere(b.contentTranslations,{cultureCode:e});return t||(t="string"===b.contentType.dataType?{cultureCode:e,contentData:""}:"object"===b.contentType.dataType?{cultureCode:e,contentData:{}}:{cultureCode:e,contentData:{items:[]}}),t}function $(){!b.contentType.dataType||"array"!==b.contentType.dataType&&"object"!==b.contentType.dataType||(b.contentTranslation.contentData=angular.toJson(b.contentTranslation.contentData))}function w(){!b.contentType.dataType||"array"!==b.contentType.dataType&&"object"!==b.contentType.dataType||(b.contentTranslation.contentData=JSON.parse(b.contentTranslation.contentData))}var b=this;b.contentId=s.id,b.changeLanguage=c,b.save=l,b.cancel=u,b.newItem=d,b.updateItem=p,b.editItem=f,b.removeItem=g,b.cancelDetailView=v,b.sortableOptions={stop:function(e,t){_.each(b.contentTranslation.contentData.items,function(e,t){e.viewOrder=t+1})}},h()}var n=angular.module("deviserEdit",["ui.router","ui.sortable","ui.bootstrap","ui.select","dndLists","sd.sdlib","deviser.services","deviser.config","modules.app.imageManager"]);n.controller("EditCtrl",["$scope","$timeout","$filter","$q","$uibModal","globals","sdUtil","layoutService","pageService","contentTypeService","pageContentService","moduleService","moduleActionService","pageModuleService",e]),n.controller("EditContentCtrl",["$scope","$uibModalInstance","$q","sdUtil","languageService","pageContentService","contentTranslationService","contentInfo",t])}(),function(){function e(e,t,i){function o(n,i,o){template=t.get("app/components/imageManager.tpl.html"),i.html(template),e(i.contents())(n)}function r(e,t){function i(){a.focusPoint&&n(a.focusPoint)}function o(){r().then(function(e){a.src=e.imageSource,a.alt=e.imageAlt,a.focusPoint=e.focusPoint},function(e){console.log(e)})}function r(){var e=t.open({templateUrl:"app/components/imageManagerPopup.tpl.html",controller:"ImageManagerPopup as imVM",size:"sm",openedClass:"image-manager-modal",resolve:{selectedImage:function(){return{src:a.src,alt:a.alt,focusPoint:a.focusPoint}}}});return e.result}var a=this;a.showPopup=o,i(),e.$watch(function(){return a.focusPoint},function(){a.focusPoint&&n(a.focusPoint)})}var a={restrict:"A",controller:["$scope","$uibModal",r],controllerAs:"locVM",bindToController:!0,link:o,scope:{src:"=",alt:"=",focusPoint:"=",label:"@"}};return a}function t(e,t,i,o,r,a){function s(){p(),b.focusPointAttr={x:0,y:0,w:0,h:0},b.imageSource&&S(b.imageSource),c()}function c(){var e;b.cropWidth=e&&e.Width||300,b.cropHeight=e&&e.Height||200}function l(e){b.selectedImage=e,b.imageSource=e.path,b.selectedTab="PREVIEW",S(b.imageSource)}function u(){t.close({imageSource:b.imageSource,imageAlt:b.imageAlt,focusPoint:b.focusPoint})}function d(){t.dismiss("cancel")}function p(){r.get().then(function(e){_.each(e,function(e){e.path+="?"+100*Math.random()}),b.images=e})}function f(e,t,n,i){s(),console.log(e),b.imageSource=e.data[0],w("success","File uploaded successfully!")}function g(e){console.log(e),409==e.status?(s(),w("error","File already exists! if you want to replace this file, please check 'Replace Image'."),b.imageSource=e.data.filePath):w("error","Server error has been occured: "+e.data.ExceptionMessage)}function v(e){console.log("percent: "+parseInt(100*e.loaded/e.total,10))}function h(e){if(e){var t=o.upload({url:"/api/upload/images",method:"POST",data:{files:e},fileFormDataName:"files"});t.then(f,g,v)}}function m(){var e=o.dataUrltoBlob(b.croppedImage);e.name=b.selectedImage.name;var t=o.upload({url:"/api/upload/images",method:"POST",file:e});t.then(f,g,v)}function y(e){var t=$(e.target),i=t.width(),o=t.height(),r=e.pageX-t.offset().left,a=e.pageY-t.offset().top,s=2*(r/i-.5),c=-2*(a/o-.5);b.focusPointAttr.x=s.toFixed(2),b.focusPointAttr.y=c.toFixed(2),b.focusPoint=b.focusPointAttr;var l=r/i*100,u=a/o*100;n(b.focusPoint),$(".reticle").css({top:u+"%",left:l+"%"})}function S(e){$("<img/>").attr("src",e).load(function(){b.focusPointAttr.w=this.width,b.focusPointAttr.h=this.height})}function w(e,t){b.message={messageType:e,content:t},i(function(){b.message={}},5e3)}var b=this;b.imageSource=a.src,b.imageAlt=a.alt,b.focusPoint=a.focusPoint,b.focusPointAttr={},b.selectImage=l,b.yes=u,b.no=d,b.onFileSelect=h,b.cropImage=m,b.focusImage=y,s()}function n(e){var t=$(".focuspoint.preview"),n=$(".focuspoint");if(ictContentModule.TabModuleSettings.ImageCropSize){var i=JSON.parse(ictContentModule.TabModuleSettings.ImageCropSize);i&&(t.css("height",i.Height-20),t.css("width",i.Width-20))}t.data("focusX",e.x),t.data("focusY",e.y),t.data("imageW",e.w),t.data("imageH",e.h),n.focusPoint()}var i=angular.module("modules.app.imageManager",["ui.router","ui.bootstrap","ui.sortable","ui.select","deviser.services","ngFileUpload","angular-img-cropper"]);i.directive("sdImageManager",["$compile","$templateCache","assetService",e]),i.controller("ImageManagerPopup",["$scope","$uibModalInstance","$timeout","Upload","assetService","selectedImage",t])}(),function(){function e(e,t,n,i,o,r,a,s,c,l,u,d){function p(){i.all([f(),g(),v()]).then(function(){if(h(P.layoutTypes),P.currentPage.layoutId){var e=_.find(P.layouts,function(e){return e.id===P.currentPage.layoutId});e?y(e):m()}})}function f(){var e=i.defer();return s.get(pageContext.currentPageId).then(function(t){P.currentPage=t,e.resolve("data received!")},function(t){x("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}function g(){var e=i.defer();return a.get().then(function(t){console.log(t),t=_.where(t,{isDeleted:!1}),_.each(t,function(e){e&&!e.placeHolders&&(e.placeHolders=[])}),P.layouts=t,e.resolve("data received!")},function(t){x("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}function v(){var e=i.defer();return c.get().then(function(t){P.layoutTypes=t,e.resolve("data received!")},function(t){x("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}function h(e){e&&_.each(e,function(e){e.layoutTypeId=e.id,e.id=r.getGuid(),e.placeHolders=[],e.layoutTypeIds=e.layoutTypeIds.replace(/\s+/g,""),e.allowedTypes=e.layoutTypeIds?e.layoutTypeIds.split(","):"",e.type=e.name,e.layoutTemplate="column"===e.type?"column":"container"===e.type?"container":"row"===e.type?"row":"repeater"})}function m(){P.pageLayout={},P.pageLayout.id=void 0,P.pageLayout.name="",P.pageLayout.isChanged=!1,P.pageLayout.placeHolders=[]}function y(e){P.pageLayout=e,P.pageLayout.isChanged=!0,w(P.pageLayout.placeHolders)}function S(){P.pageLayout.id=void 0,P.pageLayout.name="",P.pageLayout.isChanged=!0}function $(){w(P.pageLayout.placeHolders),P.pageLayout.pageId=pageContext.currentPageId,P.pageLayout.id?a.put(P.pageLayout).then(function(e){P.pageLayout.id=e.id,P.pageLayout.placeHolders=e.placeHolders,P.pageLayout.isChanged=!1,x("success","Layout has been saved"),w(P.pageLayout.placeHolders)},function(e){x("error",SYS_ERROR_MSG)}):a.post(P.pageLayout).then(function(e){console.log(e),P.pageLayout.id=e.id,P.pageLayout.placeHolders=e.placeHolders,P.pageLayout.isChanged=!1,x("success","Layout has been saved"),g().then(function(){w(P.pageLayout.placeHolders)})},function(e){x("error",SYS_ERROR_MSG)})}function w(e){e&&_.each(e,function(e,t){console.log(e);var n=_.findWhere(P.layoutTypes,{layoutTypeId:e.layoutTypeId});n&&(e.label=n.label),e.sortOrder=t+1,e.placeHolders&&w(e.placeHolders)})}function b(){a.remove(P.pageLayout.id).then(function(e){console.log(e),x("success","Layout has been removed"),g(),m()},function(e){x("error",SYS_ERROR_MSG)})}function T(e){var t=e.properties,n=_.findWhere(P.layoutTypes,{layoutTypeId:e.layoutTypeId}),i=n.properties;_.each(i,function(n){if(n){var i=_.findWhere(t,{id:n.id});i?(i.label=n.label,n.propertyOptionList&&n.propertyOptionList.list&&(i.propertyOptionList=angular.fromJson(n.propertyOptionList.list))):e.properties.push(angular.copy(n))}}),P.selectedItem=e}function I(e,t,n){return console.log(n),t>0}function E(e,t,n){return n}function C(e,t,n){return n}function L(e,t){e.placeHolders.splice(t,1)}function R(e,t,n,i,o){var r=i?"External ":"";r+=o+" element is "+e+" position "+n,P.logEvent(r,t)}function M(e,t){console.log(e,"(triggered by the following",t.type,"event)"),console.log(t)}function x(e,n){P.message={messageType:e,content:n},t(function(){P.message={messageType:"",content:""}},o.appSettings.alertLifeTime)}var P=this;SYS_ERROR_MSG=o.appSettings.systemErrorMsg,P.alerts=[],P.pageLayout={},P.selectedItem={},P.deletedElements=[],P.layoutAllowedTypes=["9341f92e-83d8-4afe-ad4a-a95deeda9ae3","5a0a5884-da84-4922-a02f-5828b55d5c92"],P.newGuid=r.getGuid,P.dragoverCallback=I,P.dropCallback=E,P.logListEvent=R,P.logEvent=M,P.newLayout=m,P.selectLayout=y,P.copyLayout=S,P.saveLayout=$,P.deleteLayout=b,P.selectItem=T,P.itemMoved=L,P.deleteElement=C,p()}var t=angular.module("deviserLayout",["ui.router","ui.bootstrap","dndLists","sd.sdlib","deviser.services","deviser.config"]);t.controller("LayoutCtrl",["$scope","$timeout","$filter","$q","globals","sdUtil","layoutService","pageService","layoutTypeService","pageContentService","moduleService","pageModuleService",e])}(),function(){function e(t){t.preventDefault();var n=$(this),i=n.attr("action"),o=n.serialize(),r=n.attr("method").toUpperCase();console.log(o);var a=$.ajax({type:r,url:i,data:o,headers:{IsAjaxRequest:!0}});a.done(function(t,i,o){if(console.log(t),"object"==typeof t)console.log(t),t.value&&302===t.statusCode&&(window.location=t.value);else{var r=n.closest(".sd-module-container");n.remove(),r.html(t),$("form.sd-form").on("submit",e)}}),a.fail(function(e,t){console.log(e+""+t)})}function t(t){t.preventDefault();var n=$(this),i=n.attr("href"),o=$.ajax({type:"GET",url:i,headers:{IsAjaxRequest:!0}});o.done(function(t,i,o){console.log(t);var r=n.closest(".sd-module-container");r.html(t),$("form.sd-form").on("submit",e)}),o.fail(function(e,t){console.log(e+""+t)})}$("form.sd-form").on("submit",e),$("a.sd-ajax-load").on("click",t)}(),function(){function e(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ictEnter)}),t.preventDefault())})}}function t(){function e(e,t,n,i){i.$parsers.push(function(e){if(void 0==e)return"";var t=e.replace(/[^0-9]/g,"");return t!=e&&(i.$setViewValue(t),i.$render()),t})}var t={require:"ngModel",link:e};return t}function n(){function e(e,t,n,i){i.$parsers.push(function(e){if(void 0==e)return"";var t=e.toLowerCase();return t!=e&&(i.$setViewValue(t),i.$render()),t})}var t={require:"ngModel",link:e};return t}function i(e,t){function n(n,i,o,r,a,s){var c="edit_"+o.contentType;template=t.get(c),i.html(template),e(i.contents())(n)}function i(e,t){function n(){if(o.sdVM.ngModel&&o.sdVM.contentId){var e=_.find(o.sdVM.ngModel,function(e){return e.id===o.sdVM.contentId});e&&(i.content=e)}}var i=this,o=e;i.content||(i.content="Please enter the content"),i.edit=function(){i.isEditMode=!i.isEditMode},i.save=function(){i.content&&o.sdVM.contentId&&o.sdVM.containerId&&o.sdVM.onSave()(i.content,o.sdVM.contentId,o.sdVM.containerId),i.cancel()},i.cancel=function(){i.isEditMode=!i.isEditMode},e.$watch(function(){return o.sdVM.ngModel},function(e){console.log("Changed to "+e),n()})}var o={restrict:"A",controller:i,controllerAs:"sdVM",bindToController:!0,link:n,scope:{contentId:"@",containerId:"@",contentType:"@",ngModel:"=",onSave:"&"}};return o}function o(e){return{restrict:"A",require:"?ngModel",link:function(t,n,i,o){function r(){var e=n.html();i.stripBr&&"<br>"==e&&(e=""),o.$setViewValue(e)}o&&(o.$render=function(){n.html(e.getTrustedHtml(o.$viewValue||""))},n.on("blur keyup change",function(){t.$evalAsync(r)}),r())}}}function r(){function e(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function t(e){return/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(e)}var n={getGuid:e,isGuid:t};return n}var a=angular.module("sd.sdlib",["ngSanitize"]);a.directive("sdEnter",e),a.directive("sdNumberOnly",t),a.directive("sdToLowerCase",n),a.directive("sdEdit",["$compile","$templateCache",i]),a.directive("contenteditable",["$sce",o]),a.factory("sdUtil",[r])}(),function(){function e(e,t,n){return $(e,t,n,"/layout")}function t(e,t,n){return $(e,t,n,"/page")}function n(e,t,n){return $(e,t,n,"/skin")}function i(e,t,n){function i(){var i=n.appSettings.serviceBaseUrl+o+"/datatype",r=e({method:"GET",url:i});return r.then(b,function(e){return w(e,t)})}var o="/contenttype",r=$(e,t,n,o);return r.getContentDataType=i,r}function o(e,t,n){var i="/layouttype",o=$(e,t,n,i);return o}function r(e,t,n){var i="/property",o=$(e,t,n,i);return o}function a(e,t,n){var i="/optionlist",o=$(e,t,n,i);return o}function s(e,t,n){function i(){var n=s;if(arguments[0]&&arguments[1]){var i=arguments[1],o=arguments[0];n=s+"/"+i+"/"+o}else if(arguments[0]){var r=arguments[0];n=s+"/"+r}var a=e({method:"GET",url:n});return a.then(b,function(e){return w(e,t)})}function o(n){var i=s+"/list",o=e({method:"PUT",url:i,data:angular.toJson(n)});return o.then(b,function(e){return w(e,t)})}var r="/pagecontent",a=$(e,t,n,r),s=n.appSettings.serviceBaseUrl+r;return a.get=i,a.putContents=o,a}function c(e,t,n){function i(){var n=a;if(arguments[0]&&arguments[1]){var i=arguments[1],o=arguments[0];n=a+"/"+i+"/"+o}else if(arguments[0]){var r=arguments[0];n=a+"/"+r}var s=e({method:"GET",url:n});return s.then(b,function(e){return w(e,t)})}var o="/contenttranslation",r=$(e,t,n,o),a=n.appSettings.serviceBaseUrl+o;return r.get=i,r}function l(e,t,n){var i=$(e,t,n,"/module");return i.put=null,i.post=null,i.remove=null,i}function u(e,t,n){var i=$(e,t,n,"/moduleaction");return i.put=null,i.post=null,i.remove=null,i}function d(e,t,n){function i(n){var i=a+"/page/"+n,o=e({method:"GET",url:i});return o.then(b,function(e){return w(e,t)})}function o(n){var i=a+"/list",o=e({method:"PUT",url:i,data:angular.toJson(n)});return o.then(b,function(e){return w(e,t)})}var r="/pagemodule",a=n.appSettings.serviceBaseUrl+r,s=$(e,t,n,r);return s.get=i,s.put=null,s.putModules=o,s}function p(e,t,n){var i=$(e,t,n,"/user");return i}function f(e,t,n){return $(e,t,n,"/user/isexist")}function g(e,t,n){return $(e,t,n,"/user/passwordreset")}function v(e,t,n){return $(e,t,n,"/role")}function h(e,t,n){function i(n,i){var o=e({method:"DELETE",url:a+"/"+n+"/"+i});return o.then(b,function(e){return w(e,t)})}var o="/user/role",r=$(e,t,n,o),a=n.appSettings.serviceBaseUrl+o;return r.remove=i,r}function m(e,t,n){function i(){var n=r+"/site",i=e({method:"GET",url:n});return i.then(b,function(e){return w(e,t)})}var o="/language",r=n.appSettings.serviceBaseUrl+o,a=$(e,t,n,o);return a.getSiteLanguages=i,a}function y(e,t,n){return $(e,t,n,"/file")}function S(e,t,n){var i=$(e,t,n,"/upload/images");return i}function $(e,t,n,i){function o(n){var i=l;n&&(i=l+"/"+n);var o=e({method:"GET",url:i});return o.then(b,function(e){return w(e,t)})}function r(n){var i=e({method:"POST",url:l,data:angular.toJson(n)});return i.then(b,function(e){return w(e,t)})}function a(n,i){var o=l;i&&(o=l+"/"+i);var r=e({method:"PUT",url:o,data:angular.toJson(n)});return r.then(b,function(e){return w(e,t)})}function s(n){var i=e({method:"DELETE",url:l+"/"+n});return i.then(b,function(e){return w(e,t)})}var c={get:o,put:a,post:r,remove:s},l=n.appSettings.serviceBaseUrl+i;return c}function w(e,t){return t.reject(angular.isObject(e.data)&&e.data?e.data:"An unknown error occurred.")}function b(e){return e.data}var T=angular.module("deviser.services",["deviser.config"]);T.factory("layoutService",e),T.factory("pageService",t),T.factory("contentTypeService",i),T.factory("layoutTypeService",o),T.factory("propertyService",r),T.factory("optionListService",a),T.factory("pageContentService",s),T.factory("contentTranslationService",c),T.factory("moduleService",l),T.factory("moduleActionService",u),T.factory("pageModuleService",d),T.factory("skinService",n),T.factory("userService",p),T.factory("userExistService",f),T.factory("passwordResetService",g),T.factory("roleService",v),T.factory("userRoleService",h),T.factory("languageService",m),T.factory("fileService",y),T.factory("assetService",S)}(),_.mixin({findDeep:function(e,t){function n(e){for(var n in t)if(!_.isUndefined(e)&&t[n]!==e[n])return!1;return!0}function i(e){var t;return _.forEach(e,function(e){return n(e)?(t=e,!1):((_.isObject(e)||_.isArray(e))&&(t=i(e)),t?!1:void 0)}),t}return i(e)}}),function(){"use strict";var e={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,COMMAND:91,MAP:{91:"COMMAND",8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSEBREAK",20:"CAPSLOCK",27:"ESC",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",43:"+",44:"PRINTSCREEN",45:"INSERT",46:"DELETE",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NUMLOCK",145:"SCROLLLOCK",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},isControl:function(t){var n=t.which;switch(n){case e.COMMAND:case e.SHIFT:case e.CTRL:case e.ALT:return!0}return t.metaKey||t.ctrlKey||t.altKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&123>=e},isVerticalMovement:function(t){return~[e.UP,e.DOWN].indexOf(t)},isHorizontalMovement:function(t){return~[e.LEFT,e.RIGHT,e.BACKSPACE,e.DELETE].indexOf(t)},toSeparator:function(t){var n={ENTER:"\n",TAB:"	",SPACE:" "}[t];return n?n:e[t]?void 0:t}};void 0===angular.element.prototype.querySelectorAll&&(angular.element.prototype.querySelectorAll=function(e){return angular.element(this[0].querySelectorAll(e))}),void 0===angular.element.prototype.closest&&(angular.element.prototype.closest=function(e){for(var t=this[0],n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;t;){if(n.bind(t)(e))return t;t=t.parentElement}return!1});var t=0,n=angular.module("ui.select",[]).constant("uiSelectConfig",{theme:"bootstrap",searchEnabled:!0,sortable:!1,placeholder:"",refreshDelay:1e3,closeOnSelect:!0,skipFocusser:!1,dropdownPosition:"auto",removeSelected:!0,generateId:function(){return t++},appendToBody:!1}).service("uiSelectMinErr",function(){var e=angular.$$minErr("ui.select");return function(){var t=e.apply(this,arguments),n=t.message.replace(new RegExp("\nhttp://errors.angularjs.org/.*"),"");return new Error(n)}}).directive("uisTranscludeAppend",function(){return{link:function(e,t,n,i,o){o(e,function(e){t.append(e)})}}}).filter("highlight",function(){function e(e){return(""+e).replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(t,n){return n&&t?(""+t).replace(new RegExp(e(n),"gi"),'<span class="ui-select-highlight">$&</span>'):t}}).factory("uisOffset",["$document","$window",function(e,t){return function(n){var i=n[0].getBoundingClientRect();return{width:i.width||n.prop("offsetWidth"),height:i.height||n.prop("offsetHeight"),top:i.top+(t.pageYOffset||e[0].documentElement.scrollTop),left:i.left+(t.pageXOffset||e[0].documentElement.scrollLeft)}}}]);n.factory("$$uisDebounce",["$timeout",function(e){return function(t,n){var i;return function(){var o=this,r=Array.prototype.slice.call(arguments);i&&e.cancel(i),i=e(function(){t.apply(o,r)},n)}}}]),n.directive("uiSelectChoices",["uiSelectConfig","uisRepeatParser","uiSelectMinErr","$compile","$window",function(e,t,n,i,o){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){t.addClass("ui-select-choices");var n=t.parent().attr("theme")||e.theme;return n+"/choices.tpl.html"},compile:function(i,r){if(!r.repeat)throw n("repeat","Expected 'repeat' expression.");var a=r.groupBy,s=r.groupFilter;if(a){var c=i.querySelectorAll(".ui-select-choices-group");if(1!==c.length)throw n("rows","Expected 1 .ui-select-choices-group but got '{0}'.",c.length);c.attr("ng-repeat",t.getGroupNgRepeatExpression())}var l=t.parse(r.repeat),u=i.querySelectorAll(".ui-select-choices-row");if(1!==u.length)throw n("rows","Expected 1 .ui-select-choices-row but got '{0}'.",u.length);u.attr("ng-repeat",l.repeatExpression(a)).attr("ng-if","$select.open");var d=i.querySelectorAll(".ui-select-choices-row-inner");if(1!==d.length)throw n("rows","Expected 1 .ui-select-choices-row-inner but got '{0}'.",d.length);d.attr("uis-transclude-append","");var p=o.document.addEventListener?u:d;return p.attr("ng-click","$select.select("+l.itemName+",$select.skipFocusser,$event)"),function(t,n,i,o){o.parseRepeatAttr(i.repeat,a,s),o.disableChoiceExpression=i.uiDisableChoice,o.onHighlightCallback=i.onHighlight,o.dropdownPosition=i.position?i.position.toLowerCase():e.dropdownPosition,t.$on("$destroy",function(){u.remove()}),t.$watch("$select.search",function(e){e&&!o.open&&o.multiple&&o.activate(!1,!0),o.activeIndex=o.tagging.isActivated?-1:0,!i.minimumInputLength||o.search.length>=i.minimumInputLength?o.refresh(i.refresh):o.items=[]}),i.$observe("refreshDelay",function(){var n=t.$eval(i.refreshDelay);o.refreshDelay=void 0!==n?n:e.refreshDelay})}}}}]),n.controller("uiSelectCtrl",["$scope","$element","$timeout","$filter","$$uisDebounce","uisRepeatParser","uiSelectMinErr","uiSelectConfig","$parse","$injector","$window",function(t,n,i,o,r,a,s,c,l,u,d){function p(e,t,n){if(e.findIndex)return e.findIndex(t,n);for(var i,o=Object(e),r=o.length>>>0,a=0;r>a;a++)if(i=o[a],t.call(n,i,a,o))return a;return-1}function f(){($.resetSearchInput||void 0===$.resetSearchInput&&c.resetSearchInput)&&($.search=w,$.selected&&$.items.length&&!$.multiple&&($.activeIndex=p($.items,function(e){return angular.equals(this,e)},$.selected)))}function g(e,t){var n,i,o=[];for(n=0;n<t.length;n++)for(i=0;i<e.length;i++)e[i].name==[t[n]]&&o.push(e[i]);return o}function v(e,t){var n=I.indexOf(e);t&&-1===n&&I.push(e),!t&&n>-1&&I.splice(n,0)}function h(e){return I.indexOf(e)>-1}function m(e){function t(e,t){var n=i.indexOf(e);t&&-1===n&&i.push(e),!t&&n>-1&&i.splice(n,0)}function n(e){return i.indexOf(e)>-1}if(e){var i=[];$.isLocked=function(e,i){var o=!1,r=$.selected[i];return r&&(e?(o=!!e.$eval($.lockChoiceExpression),t(r,o)):o=n(r)),
o}}}function y(t){var n=!0;switch(t){case e.DOWN:!$.open&&$.multiple?$.activate(!1,!0):$.activeIndex<$.items.length-1&&$.activeIndex++;break;case e.UP:!$.open&&$.multiple?$.activate(!1,!0):($.activeIndex>0||0===$.search.length&&$.tagging.isActivated&&$.activeIndex>-1)&&$.activeIndex--;break;case e.TAB:(!$.multiple||$.open)&&$.select($.items[$.activeIndex],!0);break;case e.ENTER:$.open&&($.tagging.isActivated||$.activeIndex>=0)?$.select($.items[$.activeIndex],$.skipFocusser):$.activate(!1,!0);break;case e.ESC:$.close();break;default:n=!1}return n}function S(){var e=n.querySelectorAll(".ui-select-choices-content"),t=e.querySelectorAll(".ui-select-choices-row");if(t.length<1)throw s("choices","Expected multiple .ui-select-choices-row but got '{0}'.",t.length);if(!($.activeIndex<0)){var i=t[$.activeIndex],o=i.offsetTop+i.clientHeight-e[0].scrollTop,r=e[0].offsetHeight;o>r?e[0].scrollTop+=o-r:o<i.clientHeight&&($.isGrouped&&0===$.activeIndex?e[0].scrollTop=0:e[0].scrollTop-=i.clientHeight-o)}}var $=this,w="";if($.placeholder=c.placeholder,$.searchEnabled=c.searchEnabled,$.sortable=c.sortable,$.refreshDelay=c.refreshDelay,$.paste=c.paste,$.removeSelected=c.removeSelected,$.closeOnSelect=!0,$.skipFocusser=!1,$.search=w,$.activeIndex=0,$.items=[],$.open=!1,$.focus=!1,$.disabled=!1,$.selected=void 0,$.dropdownPosition="auto",$.focusser=void 0,$.resetSearchInput=!0,$.multiple=void 0,$.disableChoiceExpression=void 0,$.tagging={isActivated:!1,fct:void 0},$.taggingTokens={isActivated:!1,tokens:void 0},$.lockChoiceExpression=void 0,$.clickTriggeredSelect=!1,$.$filter=o,$.$element=n,$.$animate=function(){try{return u.get("$animate")}catch(e){return null}}(),$.searchInput=n.querySelectorAll("input.ui-select-search"),1!==$.searchInput.length)throw s("searchInput","Expected 1 input.ui-select-search but got '{0}'.",$.searchInput.length);$.isEmpty=function(){return angular.isUndefined($.selected)||null===$.selected||""===$.selected||$.multiple&&0===$.selected.length},$.activate=function(e,o){if(!$.disabled&&!$.open){o||f(),t.$broadcast("uis:activate"),$.open=!0,$.activeIndex=$.activeIndex>=$.items.length?0:$.activeIndex,-1===$.activeIndex&&$.taggingLabel!==!1&&($.activeIndex=0);var r=n.querySelectorAll(".ui-select-choices-content"),a=n.querySelectorAll(".ui-select-search");if($.$animate&&$.$animate.on&&$.$animate.enabled(r[0])){var s=function(t,n){"start"===n&&0===$.items.length?($.$animate.off("removeClass",a[0],s),i(function(){$.focusSearchInput(e)})):"close"===n&&($.$animate.off("enter",r[0],s),i(function(){$.focusSearchInput(e)}))};$.items.length>0?$.$animate.on("enter",r[0],s):$.$animate.on("removeClass",a[0],s)}else i(function(){$.focusSearchInput(e),!$.tagging.isActivated&&$.items.length>1&&S()})}},$.focusSearchInput=function(e){$.search=e||$.search,$.searchInput[0].focus()},$.findGroupByName=function(e){return $.groups&&$.groups.filter(function(t){return t.name===e})[0]},$.parseRepeatAttr=function(e,n,i){function o(e){var o=t.$eval(n);if($.groups=[],angular.forEach(e,function(e){var t=angular.isFunction(o)?o(e):e[o],n=$.findGroupByName(t);n?n.items.push(e):$.groups.push({name:t,items:[e]})}),i){var r=t.$eval(i);angular.isFunction(r)?$.groups=r($.groups):angular.isArray(r)&&($.groups=g($.groups,r))}$.items=[],$.groups.forEach(function(e){$.items=$.items.concat(e.items)})}function r(e){$.items=e}$.setItemsFn=n?o:r,$.parserResult=a.parse(e),$.isGrouped=!!n,$.itemProperty=$.parserResult.itemName;var c=$.parserResult.source,u=function(){var e=c(t);t.$uisSource=Object.keys(e).map(function(t){var n={};return n[$.parserResult.keyName]=t,n.value=e[t],n})};$.parserResult.keyName&&(u(),$.parserResult.source=l("$uisSource"+$.parserResult.filters),t.$watch(c,function(e,t){e!==t&&u()},!0)),$.refreshItems=function(e){e=e||$.parserResult.source(t);var n=$.selected;if($.isEmpty()||angular.isArray(n)&&!n.length||!$.multiple||!$.removeSelected)$.setItemsFn(e);else if(void 0!==e&&null!==e){var i=e.filter(function(e){return angular.isArray(n)?n.every(function(t){return!angular.equals(e,t)}):!angular.equals(e,n)});$.setItemsFn(i)}("auto"===$.dropdownPosition||"up"===$.dropdownPosition)&&t.calculateDropdownPos(),t.$broadcast("uis:refresh")},t.$watchCollection($.parserResult.source,function(e){if(void 0===e||null===e)$.items=[];else{if(!angular.isArray(e))throw s("items","Expected an array but got '{0}'.",e);$.refreshItems(e),angular.isDefined($.ngModel.$modelValue)&&($.ngModel.$modelValue=null)}})};var b;$.refresh=function(e){void 0!==e&&(b&&i.cancel(b),b=i(function(){t.$eval(e)},$.refreshDelay))},$.isActive=function(e){if(!$.open)return!1;var t=$.items.indexOf(e[$.itemProperty]),n=t==$.activeIndex;return!n||0>t?!1:(n&&!angular.isUndefined($.onHighlightCallback)&&e.$eval($.onHighlightCallback),n)};var T=function(e){return $.selected&&angular.isArray($.selected)&&$.selected.filter(function(t){return angular.equals(t,e)}).length>0},I=[];$.isDisabled=function(e){if($.open){var t=e[$.itemProperty],n=$.items.indexOf(t),i=!1;if(n>=0&&(angular.isDefined($.disableChoiceExpression)||$.multiple)){if(t.isTag)return!1;$.multiple&&(i=T(t)),!i&&angular.isDefined($.disableChoiceExpression)&&(i=!!e.$eval($.disableChoiceExpression)),v(t,i)}return i}},$.select=function(e,n,o){if(void 0===e||!h(e)){if(!$.items&&!$.search&&!$.tagging.isActivated)return;if(!e||!h(e)){if($.clickTriggeredSelect=!1,o&&"click"===o.type&&e&&($.clickTriggeredSelect=!0),$.tagging.isActivated&&$.clickTriggeredSelect===!1){if($.taggingLabel===!1)if($.activeIndex<0){if(void 0===e&&(e=void 0!==$.tagging.fct?$.tagging.fct($.search):$.search),!e||angular.equals($.items[0],e))return}else e=$.items[$.activeIndex];else if(0===$.activeIndex){if(void 0===e)return;if(void 0!==$.tagging.fct&&"string"==typeof e){if(e=$.tagging.fct(e),!e)return}else"string"==typeof e&&(e=e.replace($.taggingLabel,"").trim())}if(T(e))return void $.close(n)}t.$broadcast("uis:select",e);var r={};r[$.parserResult.itemName]=e,i(function(){$.onSelectCallback(t,{$item:e,$model:$.parserResult.modelMapper(t,r)})}),$.closeOnSelect&&$.close(n)}}},$.close=function(e){$.open&&($.ngModel&&$.ngModel.$setTouched&&$.ngModel.$setTouched(),f(),$.open=!1,t.$broadcast("uis:close",e))},$.setFocus=function(){$.focus||$.focusInput[0].focus()},$.clear=function(e){$.select(void 0),e.stopPropagation(),i(function(){$.focusser[0].focus()},0,!1)},$.toggle=function(e){$.open?($.close(),e.preventDefault(),e.stopPropagation()):$.activate()},$.isLocked=function(){return!1},t.$watch(function(){return angular.isDefined($.lockChoiceExpression)&&""!==$.lockChoiceExpression},m);var E=null,C=!1;$.sizeSearchInput=function(){var e=$.searchInput[0],n=$.searchInput.parent().parent()[0],o=function(){return n.clientWidth*!!e.offsetParent},r=function(t){if(0===t)return!1;var n=t-e.offsetLeft-10;return 50>n&&(n=t),$.searchInput.css("width",n+"px"),!0};$.searchInput.css("width","10px"),i(function(){null!==E||r(o())||(E=t.$watch(function(){C||(C=!0,t.$$postDigest(function(){C=!1,r(o())&&(E(),E=null)}))},angular.noop))})},$.searchInput.on("keydown",function(n){var o=n.which;~[e.ENTER,e.ESC].indexOf(o)&&(n.preventDefault(),n.stopPropagation()),t.$apply(function(){var t=!1;if(($.items.length>0||$.tagging.isActivated)&&(y(o),$.taggingTokens.isActivated)){for(var r=0;r<$.taggingTokens.tokens.length;r++)$.taggingTokens.tokens[r]===e.MAP[n.keyCode]&&$.search.length>0&&(t=!0);t&&i(function(){$.searchInput.triggerHandler("tagged");var t=$.search.replace(e.MAP[n.keyCode],"").trim();$.tagging.fct&&(t=$.tagging.fct(t)),t&&$.select(t,!0)})}}),e.isVerticalMovement(o)&&$.items.length>0&&S(),(o===e.ENTER||o===e.ESC)&&(n.preventDefault(),n.stopPropagation())}),$.searchInput.on("paste",function(t){var n;if(n=window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):(t.originalEvent||t).clipboardData.getData("text/plain"),n=$.search+n,n&&n.length>0)if($.taggingTokens.isActivated){for(var i=[],o=0;o<$.taggingTokens.tokens.length;o++){var r=e.toSeparator($.taggingTokens.tokens[o])||$.taggingTokens.tokens[o];if(n.indexOf(r)>-1){i=n.split(r);break}}0===i.length&&(i=[n]);var a=$.search;angular.forEach(i,function(e){var t=$.tagging.fct?$.tagging.fct(e):e;t&&$.select(t,!0)}),$.search=a||w,t.preventDefault(),t.stopPropagation()}else $.paste&&($.paste(n),$.search=w,t.preventDefault(),t.stopPropagation())}),$.searchInput.on("tagged",function(){i(function(){f()})});var L=r(function(){$.sizeSearchInput()},50);angular.element(d).bind("resize",L),t.$on("$destroy",function(){$.searchInput.off("keyup keydown tagged blur paste"),angular.element(d).off("resize",L)})}]),n.directive("uiSelect",["$document","uiSelectConfig","uiSelectMinErr","uisOffset","$compile","$parse","$timeout",function(e,t,n,i,o,r,a){return{restrict:"EA",templateUrl:function(e,n){var i=n.theme||t.theme;return i+(angular.isDefined(n.multiple)?"/select-multiple.tpl.html":"/select.tpl.html")},replace:!0,transclude:!0,require:["uiSelect","^ngModel"],scope:!0,controller:"uiSelectCtrl",controllerAs:"$select",compile:function(o,s){var c=/{(.*)}\s*{(.*)}/.exec(s.ngClass);if(c){var l="{"+c[1]+", "+c[2]+"}";s.ngClass=l,o.attr("ng-class",l)}return angular.isDefined(s.multiple)?o.append("<ui-select-multiple/>").removeAttr("multiple"):o.append("<ui-select-single/>"),s.inputId&&(o.querySelectorAll("input.ui-select-search")[0].id=s.inputId),function(o,s,c,l,u){function d(e){if(g.open){var t=!1;if(t=window.jQuery?window.jQuery.contains(s[0],e.target):s[0].contains(e.target),!t&&!g.clickTriggeredSelect){var n;if(g.skipFocusser)n=!0;else{var i=["input","button","textarea","select"],r=angular.element(e.target).controller("uiSelect");n=r&&r!==g,n||(n=~i.indexOf(e.target.tagName.toLowerCase()))}g.close(n),o.$digest()}g.clickTriggeredSelect=!1}}function p(){var t=i(s);m=angular.element('<div class="ui-select-placeholder"></div>'),m[0].style.width=t.width+"px",m[0].style.height=t.height+"px",s.after(m),y=s[0].style.width,e.find("body").append(s),s[0].style.position="absolute",s[0].style.left=t.left+"px",s[0].style.top=t.top+"px",s[0].style.width=t.width+"px"}function f(){null!==m&&(m.replaceWith(s),m=null,s[0].style.position="",s[0].style.left="",s[0].style.top="",s[0].style.width=y,g.setFocus())}var g=l[0],v=l[1];g.generatedId=t.generateId(),g.baseTitle=c.title||"Select box",g.focusserTitle=g.baseTitle+" focus",g.focusserId="focusser-"+g.generatedId,g.closeOnSelect=function(){return angular.isDefined(c.closeOnSelect)?r(c.closeOnSelect)():t.closeOnSelect}(),o.$watch("skipFocusser",function(){var e=o.$eval(c.skipFocusser);g.skipFocusser=void 0!==e?e:t.skipFocusser}),g.onSelectCallback=r(c.onSelect),g.onRemoveCallback=r(c.onRemove),g.ngModel=v,g.choiceGrouped=function(e){return g.isGrouped&&e&&e.name},c.tabindex&&c.$observe("tabindex",function(e){g.focusInput.attr("tabindex",e),s.removeAttr("tabindex")}),o.$watch(function(){return o.$eval(c.searchEnabled)},function(e){g.searchEnabled=void 0!==e?e:t.searchEnabled}),o.$watch("sortable",function(){var e=o.$eval(c.sortable);g.sortable=void 0!==e?e:t.sortable}),c.$observe("limit",function(){g.limit=angular.isDefined(c.limit)?parseInt(c.limit,10):void 0}),o.$watch("removeSelected",function(){var e=o.$eval(c.removeSelected);g.removeSelected=void 0!==e?e:t.removeSelected}),c.$observe("disabled",function(){g.disabled=void 0!==c.disabled?c.disabled:!1}),c.$observe("resetSearchInput",function(){var e=o.$eval(c.resetSearchInput);g.resetSearchInput=void 0!==e?e:!0}),c.$observe("paste",function(){g.paste=o.$eval(c.paste)}),c.$observe("tagging",function(){if(void 0!==c.tagging){var e=o.$eval(c.tagging);g.tagging={isActivated:!0,fct:e!==!0?e:void 0}}else g.tagging={isActivated:!1,fct:void 0}}),c.$observe("taggingLabel",function(){void 0!==c.tagging&&(g.taggingLabel="false"===c.taggingLabel?!1:void 0!==c.taggingLabel?c.taggingLabel:"(new)")}),c.$observe("taggingTokens",function(){if(void 0!==c.tagging){var e=void 0!==c.taggingTokens?c.taggingTokens.split("|"):[",","ENTER"];g.taggingTokens={isActivated:!0,tokens:e}}}),angular.isDefined(c.autofocus)&&a(function(){g.setFocus()}),angular.isDefined(c.focusOn)&&o.$on(c.focusOn,function(){a(function(){g.setFocus()})}),e.on("click",d),o.$on("$destroy",function(){e.off("click",d)}),u(o,function(e){var t=angular.element("<div>").append(e),i=t.querySelectorAll(".ui-select-match");if(i.removeAttr("ui-select-match"),i.removeAttr("data-ui-select-match"),1!==i.length)throw n("transcluded","Expected 1 .ui-select-match but got '{0}'.",i.length);s.querySelectorAll(".ui-select-match").replaceWith(i);var o=t.querySelectorAll(".ui-select-choices");if(o.removeAttr("ui-select-choices"),o.removeAttr("data-ui-select-choices"),1!==o.length)throw n("transcluded","Expected 1 .ui-select-choices but got '{0}'.",o.length);s.querySelectorAll(".ui-select-choices").replaceWith(o);var r=t.querySelectorAll(".ui-select-no-choice");r.removeAttr("ui-select-no-choice"),r.removeAttr("data-ui-select-no-choice"),1==r.length&&s.querySelectorAll(".ui-select-no-choice").replaceWith(r)});var h=o.$eval(c.appendToBody);(void 0!==h?h:t.appendToBody)&&(o.$watch("$select.open",function(e){e?p():f()}),o.$on("$destroy",function(){f()}));var m=null,y="",S=null,$="direction-up";o.$watch("$select.open",function(){("auto"===g.dropdownPosition||"up"===g.dropdownPosition)&&o.calculateDropdownPos()});var w=function(e,t){e=e||i(s),t=t||i(S),S[0].style.position="absolute",S[0].style.top=-1*t.height+"px",s.addClass($)},b=function(e,t){s.removeClass($),e=e||i(s),t=t||i(S),S[0].style.position="",S[0].style.top=""},T=function(){a(function(){if("up"===g.dropdownPosition)w();else{s.removeClass($);var t=i(s),n=i(S),o=e[0].documentElement.scrollTop||e[0].body.scrollTop;t.top+t.height+n.height>o+e[0].documentElement.clientHeight?w(t,n):b(t,n)}S[0].style.opacity=1})},I=!1;o.calculateDropdownPos=function(){if(g.open){if(S=angular.element(s).querySelectorAll(".ui-select-dropdown"),0===S.length)return;if(""!==g.search||I||(S[0].style.opacity=0,I=!0),!i(S).height&&g.$animate&&g.$animate.on&&g.$animate.enabled(S)){var e=!0;g.$animate.on("enter",S,function(t,n){"close"===n&&e&&(T(),e=!1)})}else T()}else{if(null===S||0===S.length)return;S[0].style.opacity=0,S[0].style.position="",S[0].style.top="",s.removeClass($)}}}}}}]),n.directive("uiSelectMatch",["uiSelectConfig",function(e){function t(e,t){return e[0].hasAttribute(t)?e.attr(t):e[0].hasAttribute("data-"+t)?e.attr("data-"+t):e[0].hasAttribute("x-"+t)?e.attr("x-"+t):void 0}return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(n){n.addClass("ui-select-match");var i=n.parent(),o=t(i,"theme")||e.theme,r=angular.isDefined(t(i,"multiple"));return o+(r?"/match-multiple.tpl.html":"/match.tpl.html")},link:function(t,n,i,o){function r(e){o.allowClear=angular.isDefined(e)?""===e?!0:"true"===e.toLowerCase():!1}o.lockChoiceExpression=i.uiLockChoice,i.$observe("placeholder",function(t){o.placeholder=void 0!==t?t:e.placeholder}),i.$observe("allowClear",r),r(i.allowClear),o.multiple&&o.sizeSearchInput()}}}]),n.directive("uiSelectMultiple",["uiSelectMinErr","$timeout",function(t,n){return{restrict:"EA",require:["^uiSelect","^ngModel"],controller:["$scope","$timeout",function(e,t){var n,i=this,o=e.$select;angular.isUndefined(o.selected)&&(o.selected=[]),e.$evalAsync(function(){n=e.ngModel}),i.activeMatchIndex=-1,i.updateModel=function(){n.$setViewValue(Date.now()),i.refreshComponent()},i.refreshComponent=function(){o.refreshItems&&o.refreshItems(),o.sizeSearchInput&&o.sizeSearchInput()},i.removeChoice=function(n){if(o.isLocked(null,n))return!1;var r=o.selected[n],a={};return a[o.parserResult.itemName]=r,o.selected.splice(n,1),i.activeMatchIndex=-1,o.sizeSearchInput(),t(function(){o.onRemoveCallback(e,{$item:r,$model:o.parserResult.modelMapper(e,a)})}),i.updateModel(),!0},i.getPlaceholder=function(){return o.selected&&o.selected.length?void 0:o.placeholder}}],controllerAs:"$selectMultiple",link:function(i,o,r,a){function s(e){return angular.isNumber(e.selectionStart)?e.selectionStart:e.value.length}function c(t){function n(){switch(t){case e.LEFT:return~f.activeMatchIndex?u:a;case e.RIGHT:return~f.activeMatchIndex&&c!==a?l:(d.activate(),!1);case e.BACKSPACE:return~f.activeMatchIndex?f.removeChoice(c)?u:c:a;case e.DELETE:return~f.activeMatchIndex?(f.removeChoice(f.activeMatchIndex),c):!1}}var i=s(d.searchInput[0]),o=d.selected.length,r=0,a=o-1,c=f.activeMatchIndex,l=f.activeMatchIndex+1,u=f.activeMatchIndex-1,p=c;return i>0||d.search.length&&t==e.RIGHT?!1:(d.close(),p=n(),f.activeMatchIndex=d.selected.length&&p!==!1?Math.min(a,Math.max(r,p)):-1,!0)}function l(e){if(void 0===e||void 0===d.search)return!1;var t=e.filter(function(e){return void 0===d.search.toUpperCase()||void 0===e?!1:e.toUpperCase()===d.search.toUpperCase()}).length>0;return t}function u(e,t){var n=-1;if(angular.isArray(e))for(var i=angular.copy(e),o=0;o<i.length;o++)if(void 0===d.tagging.fct)i[o]+" "+d.taggingLabel===t&&(n=o);else{var r=i[o];angular.isObject(r)&&(r.isTag=!0),angular.equals(r,t)&&(n=o)}return n}var d=a[0],p=i.ngModel=a[1],f=i.$selectMultiple;d.multiple=!0,d.focusInput=d.searchInput,p.$isEmpty=function(e){return!e||0===e.length},p.$parsers.unshift(function(){for(var e,t={},n=[],o=d.selected.length-1;o>=0;o--)t={},t[d.parserResult.itemName]=d.selected[o],e=d.parserResult.modelMapper(i,t),n.unshift(e);return n}),p.$formatters.unshift(function(e){var t,n=d.parserResult&&d.parserResult.source(i,{$select:{search:""}}),o={};if(!n)return e;var r=[],a=function(e,n){if(e&&e.length){for(var a=e.length-1;a>=0;a--){if(o[d.parserResult.itemName]=e[a],t=d.parserResult.modelMapper(i,o),d.parserResult.trackByExp){var s=/(\w*)\./.exec(d.parserResult.trackByExp),c=/\.([^\s]+)/.exec(d.parserResult.trackByExp);if(s&&s.length>0&&s[1]==d.parserResult.itemName&&c&&c.length>0&&t[c[1]]==n[c[1]])return r.unshift(e[a]),!0}if(angular.equals(t,n))return r.unshift(e[a]),!0}return!1}};if(!e)return r;for(var s=e.length-1;s>=0;s--)a(d.selected,e[s])||a(n,e[s])||r.unshift(e[s]);return r}),i.$watchCollection(function(){return p.$modelValue},function(e,t){t!=e&&(angular.isDefined(p.$modelValue)&&(p.$modelValue=null),f.refreshComponent())}),p.$render=function(){if(!angular.isArray(p.$viewValue)){if(!angular.isUndefined(p.$viewValue)&&null!==p.$viewValue)throw t("multiarr","Expected model value to be array but got '{0}'",p.$viewValue);p.$viewValue=[]}d.selected=p.$viewValue,f.refreshComponent(),i.$evalAsync()},i.$on("uis:select",function(e,t){d.selected.length>=d.limit||(d.selected.push(t),f.updateModel())}),i.$on("uis:activate",function(){f.activeMatchIndex=-1}),i.$watch("$select.disabled",function(e,t){t&&!e&&d.sizeSearchInput()}),d.searchInput.on("keydown",function(t){var n=t.which;i.$apply(function(){var i=!1;e.isHorizontalMovement(n)&&(i=c(n)),i&&n!=e.TAB&&(t.preventDefault(),t.stopPropagation())})}),d.searchInput.on("keyup",function(t){if(e.isVerticalMovement(t.which)||i.$evalAsync(function(){d.activeIndex=d.taggingLabel===!1?-1:0}),d.tagging.isActivated&&d.search.length>0){if(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||e.isVerticalMovement(t.which))return;if(d.activeIndex=d.taggingLabel===!1?-1:0,d.taggingLabel===!1)return;var n,o,r,a,s=angular.copy(d.items),c=angular.copy(d.items),p=!1,f=-1;if(void 0!==d.tagging.fct){if(r=d.$filter("filter")(s,{isTag:!0}),r.length>0&&(a=r[0]),s.length>0&&a&&(p=!0,s=s.slice(1,s.length),c=c.slice(1,c.length)),n=d.tagging.fct(d.search),c.some(function(e){return angular.equals(e,n)})||d.selected.some(function(e){return angular.equals(e,n)}))return void i.$evalAsync(function(){d.activeIndex=0,d.items=s});n&&(n.isTag=!0)}else{if(r=d.$filter("filter")(s,function(e){return e.match(d.taggingLabel)}),r.length>0&&(a=r[0]),o=s[0],void 0!==o&&s.length>0&&a&&(p=!0,s=s.slice(1,s.length),c=c.slice(1,c.length)),n=d.search+" "+d.taggingLabel,u(d.selected,d.search)>-1)return;if(l(c.concat(d.selected)))return void(p&&(s=c,i.$evalAsync(function(){d.activeIndex=0,d.items=s})));if(l(c))return void(p&&(d.items=c.slice(1,c.length)))}p&&(f=u(d.selected,n)),f>-1?s=s.slice(f+1,s.length-1):(s=[],n&&s.push(n),s=s.concat(c)),i.$evalAsync(function(){if(d.activeIndex=0,d.items=s,d.isGrouped){var e=n?s.slice(1):s;d.setItemsFn(e),n&&(d.items.unshift(n),d.groups.unshift({name:"",items:[n],tagging:!0}))}})}}),d.searchInput.on("blur",function(){n(function(){f.activeMatchIndex=-1})})}}}]),n.directive("uiSelectNoChoice",["uiSelectConfig",function(e){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){t.addClass("ui-select-no-choice");var n=t.parent().attr("theme")||e.theme;return n+"/no-choice.tpl.html"}}}]),n.directive("uiSelectSingle",["$timeout","$compile",function(t,n){return{restrict:"EA",require:["^uiSelect","^ngModel"],link:function(i,o,r,a){function s(e,t){var n=-1;if(angular.isArray(e))for(var i=angular.copy(e),o=0;o<i.length;o++)if(void 0===c.tagging.fct)i[o]+" "+c.taggingLabel===t&&(n=o);else{var r=i[o];angular.isObject(r)&&(r.isTag=!0),angular.equals(r,t)&&(n=o)}return n}var c=a[0],l=a[1];l.$parsers.unshift(function(e){var t,n={};return n[c.parserResult.itemName]=e,t=c.parserResult.modelMapper(i,n)}),l.$formatters.unshift(function(e){var t,n=c.parserResult&&c.parserResult.source(i,{$select:{search:""}}),o={};if(n){var r=function(n){return o[c.parserResult.itemName]=n,t=c.parserResult.modelMapper(i,o),t===e};if(c.selected&&r(c.selected))return c.selected;for(var a=n.length-1;a>=0;a--)if(r(n[a]))return n[a]}return e}),i.$watch("$select.selected",function(e){l.$viewValue!==e&&l.$setViewValue(e)}),l.$render=function(){c.selected=l.$viewValue},i.$on("uis:select",function(e,t){c.selected=t}),i.$on("uis:close",function(e,n){t(function(){c.focusser.prop("disabled",!1),n||c.focusser[0].focus()},0,!1)}),i.$on("uis:activate",function(){u.prop("disabled",!0)});var u=angular.element("<input ng-disabled='$select.disabled' class='ui-select-focusser ui-select-offscreen' type='text' id='{{ $select.focusserId }}' aria-label='{{ $select.focusserTitle }}' aria-haspopup='true' role='button' />");n(u)(i),c.focusser=u,c.focusInput=u,o.parent().append(u),u.bind("focus",function(){i.$evalAsync(function(){c.focus=!0})}),u.bind("blur",function(){i.$evalAsync(function(){c.focus=!1})}),u.bind("keydown",function(t){return t.which===e.BACKSPACE?(t.preventDefault(),t.stopPropagation(),c.select(void 0),void i.$apply()):void(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||((t.which==e.DOWN||t.which==e.UP||t.which==e.ENTER||t.which==e.SPACE)&&(t.preventDefault(),t.stopPropagation(),c.activate()),i.$digest()))}),u.bind("keyup input",function(t){t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||t.which==e.ENTER||t.which===e.BACKSPACE||(c.activate(u.val()),u.val(""),i.$digest())}),c.searchInput.on("keyup",function(t){if(e.isVerticalMovement(t.which)||i.$evalAsync(function(){c.activeIndex=c.taggingLabel===!1?-1:0}),c.tagging.isActivated&&c.search.length>0){if(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||e.isVerticalMovement(t.which))return;if(c.activeIndex=c.taggingLabel===!1?-1:0,c.taggingLabel===!1)return;var n,o,r,a,l=angular.copy(c.items),u=angular.copy(c.items),d=!1,p=-1;if(void 0!==c.tagging.fct){if(r=c.$filter("filter")(l,{isTag:!0}),r.length>0&&(a=r[0]),l.length>0&&a&&(d=!0,l=l.slice(1,l.length),u=u.slice(1,u.length)),n=c.tagging.fct(c.search),u.some(function(e){return angular.equals(e,n)}))return void i.$evalAsync(function(){c.activeIndex=0,c.items=l});n&&(n.isTag=!0)}else{if(r=c.$filter("filter")(l,function(e){return e.match(c.taggingLabel)}),r.length>0&&(a=r[0]),o=l[0],void 0!==o&&l.length>0&&a&&(d=!0,l=l.slice(1,l.length),u=u.slice(1,u.length)),n=c.search+" "+c.taggingLabel,s(c.selected,c.search)>-1)return;if(_findCaseInsensitiveDupe(u.concat(c.selected)))return void(d&&(l=u,i.$evalAsync(function(){c.activeIndex=0,c.items=l})));if(_findCaseInsensitiveDupe(u))return void(d&&(c.items=u.slice(1,u.length)))}d&&(p=s(c.selected,n)),p>-1?l=l.slice(p+1,l.length-1):(l=[],n&&l.push(n),l=l.concat(u)),i.$evalAsync(function(){if(c.activeIndex=0,c.items=l,c.isGrouped){var e=n?l.slice(1):l;c.setItemsFn(e),n&&(c.items.unshift(n),c.groups.unshift({name:"",items:[n],tagging:!0}))}})}})}}}]),n.directive("uiSelectSort",["$timeout","uiSelectConfig","uiSelectMinErr",function(e,t,n){return{require:["^^uiSelect","^ngModel"],link:function(t,i,o,r){if(null===t[o.uiSelectSort])throw n("sort","Expected a list to sort");var a=r[0],s=r[1],c=angular.extend({axis:"horizontal"},t.$eval(o.uiSelectSortOptions)),l=c.axis,u="dragging",d="dropping",p="dropping-before",f="dropping-after";t.$watch(function(){return a.sortable},function(e){e?i.attr("draggable",!0):i.removeAttr("draggable")}),i.on("dragstart",function(e){i.addClass(u),(e.dataTransfer||e.originalEvent.dataTransfer).setData("text",t.$index.toString())}),i.on("dragend",function(){h(u)});var g,v=function(e,t){this.splice(t,0,this.splice(e,1)[0])},h=function(e){angular.forEach(a.$element.querySelectorAll("."+e),function(t){angular.element(t).removeClass(e)})},m=function(e){e.preventDefault();var t="vertical"===l?e.offsetY||e.layerY||(e.originalEvent?e.originalEvent.offsetY:0):e.offsetX||e.layerX||(e.originalEvent?e.originalEvent.offsetX:0);t<this["vertical"===l?"offsetHeight":"offsetWidth"]/2?(h(f),i.addClass(p)):(h(p),i.addClass(f))},y=function(t){t.preventDefault();var n=parseInt((t.dataTransfer||t.originalEvent.dataTransfer).getData("text"),10);e.cancel(g),g=e(function(){S(n)},20)},S=function(e){var n=t.$eval(o.uiSelectSort),r=n[e],a=null;a=i.hasClass(p)?e<t.$index?t.$index-1:t.$index:e<t.$index?t.$index:t.$index+1,v.apply(n,[e,a]),s.$setViewValue(Date.now()),t.$apply(function(){t.$emit("uiSelectSort:change",{array:n,item:r,from:e,to:a})}),h(d),h(p),h(f),i.off("drop",y)};i.on("dragenter",function(){i.hasClass(u)||(i.addClass(d),i.on("dragover",m),i.on("drop",y))}),i.on("dragleave",function(e){e.target==i&&(h(d),h(p),h(f),i.off("dragover",m),i.off("drop",y))})}}}]),n.service("uisRepeatParser",["uiSelectMinErr","$parse",function(e,t){var n=this;n.parse=function(n){var i;if(i=n.match(/^\s*(?:([\s\S]+?)\s+as\s+)?(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(\s*[\s\S]+?)?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),!i)throw e("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",n);var o=i[5],r="";if(i[3]){o=i[5].replace(/(^\()|(\)$)/g,"");var a=i[5].match(/^\s*(?:[\s\S]+?)(?:[^\|]|\|\|)+([\s\S]*)\s*$/);a&&a[1].trim()&&(r=a[1],o=o.replace(r,""))}return{itemName:i[4]||i[2],keyName:i[3],source:t(o),filters:r,trackByExp:i[6],modelMapper:t(i[1]||i[4]||i[2]),repeatExpression:function(e){var t=this.itemName+" in "+(e?"$group.items":"$select.items");return this.trackByExp&&(t+=" track by "+this.trackByExp),t}}},n.getGroupNgRepeatExpression=function(){return"$group in $select.groups track by $group.name"}}])}(),angular.module("ui.select").run(["$templateCache",function(e){e.put("bootstrap/choices.tpl.html",'<ul class="ui-select-choices ui-select-choices-content ui-select-dropdown dropdown-menu" role="listbox" ng-show="$select.open && $select.items.length > 0"><li class="ui-select-choices-group" id="ui-select-choices-{{ $select.generatedId }}"><div class="divider" ng-show="$select.isGrouped && $index > 0"></div><div ng-show="$select.isGrouped" class="ui-select-choices-group-label dropdown-header" ng-bind="$group.name"></div><div ng-attr-id="ui-select-choices-row-{{ $select.generatedId }}-{{$index}}" class="ui-select-choices-row" ng-class="{active: $select.isActive(this), disabled: $select.isDisabled(this)}" role="option"><a href="" class="ui-select-choices-row-inner"></a></div></li></ul>'),e.put("bootstrap/match-multiple.tpl.html",'<span class="ui-select-match"><span ng-repeat="$item in $select.selected track by $index"><span class="ui-select-match-item btn btn-default btn-xs" tabindex="-1" type="button" ng-disabled="$select.disabled" ng-click="$selectMultiple.activeMatchIndex = $index;" ng-class="{\'btn-primary\':$selectMultiple.activeMatchIndex === $index, \'select-locked\':$select.isLocked(this, $index)}" ui-select-sort="$select.selected"><span class="close ui-select-match-close" ng-hide="$select.disabled" ng-click="$selectMultiple.removeChoice($index)">&nbsp;&times;</span> <span uis-transclude-append=""></span></span></span></span>'),e.put("bootstrap/match.tpl.html",'<div class="ui-select-match" ng-hide="$select.open && $select.searchEnabled" ng-disabled="$select.disabled" ng-class="{\'btn-default-focus\':$select.focus}"><span tabindex="-1" class="btn btn-default form-control ui-select-toggle" aria-label="{{ $select.baseTitle }} activate" ng-disabled="$select.disabled" ng-click="$select.activate()" style="outline: 0;"><span ng-show="$select.isEmpty()" class="ui-select-placeholder text-muted">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="ui-select-match-text pull-left" ng-class="{\'ui-select-allow-clear\': $select.allowClear && !$select.isEmpty()}" ng-transclude=""></span> <i class="caret pull-right" ng-click="$select.toggle($event)"></i> <a ng-show="$select.allowClear && !$select.isEmpty() && ($select.disabled !== true)" aria-label="{{ $select.baseTitle }} clear" style="margin-right: 10px" ng-click="$select.clear($event)" class="btn btn-xs btn-link pull-right"><i class="glyphicon glyphicon-remove" aria-hidden="true"></i></a></span></div>'),e.put("bootstrap/no-choice.tpl.html",'<ul class="ui-select-no-choice dropdown-menu" ng-show="$select.items.length == 0"><li ng-transclude=""></li></ul>'),e.put("bootstrap/select-multiple.tpl.html",'<div class="ui-select-container ui-select-multiple ui-select-bootstrap dropdown form-control" ng-class="{open: $select.open}"><div><div class="ui-select-match"></div><input type="search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="ui-select-search input-xs" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-disabled="$select.disabled" ng-hide="$select.disabled" ng-click="$select.activate()" ng-model="$select.search" role="combobox" aria-label="{{ $select.baseTitle }}" ondrop="return false;"></div><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>'),e.put("bootstrap/select.tpl.html",'<div class="ui-select-container ui-select-bootstrap dropdown" ng-class="{open: $select.open}"><div class="ui-select-match"></div><input type="search" autocomplete="off" tabindex="-1" aria-expanded="true" aria-label="{{ $select.baseTitle }}" aria-owns="ui-select-choices-{{ $select.generatedId }}" aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}" class="form-control ui-select-search" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-show="$select.searchEnabled && $select.open"><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>'),e.put("select2/choices.tpl.html",'<ul tabindex="-1" class="ui-select-choices ui-select-choices-content select2-results"><li class="ui-select-choices-group" ng-class="{\'select2-result-with-children\': $select.choiceGrouped($group) }"><div ng-show="$select.choiceGrouped($group)" class="ui-select-choices-group-label select2-result-label" ng-bind="$group.name"></div><ul role="listbox" id="ui-select-choices-{{ $select.generatedId }}" ng-class="{\'select2-result-sub\': $select.choiceGrouped($group), \'select2-result-single\': !$select.choiceGrouped($group) }"><li role="option" ng-attr-id="ui-select-choices-row-{{ $select.generatedId }}-{{$index}}" class="ui-select-choices-row" ng-class="{\'select2-highlighted\': $select.isActive(this), \'select2-disabled\': $select.isDisabled(this)}"><div class="select2-result-label ui-select-choices-row-inner"></div></li></ul></li></ul>'),e.put("select2/match-multiple.tpl.html",'<span class="ui-select-match"><li class="ui-select-match-item select2-search-choice" ng-repeat="$item in $select.selected track by $index" ng-class="{\'select2-search-choice-focus\':$selectMultiple.activeMatchIndex === $index, \'select2-locked\':$select.isLocked(this, $index)}" ui-select-sort="$select.selected"><span uis-transclude-append=""></span> <a href="javascript:;" class="ui-select-match-close select2-search-choice-close" ng-click="$selectMultiple.removeChoice($index)" tabindex="-1"></a></li></span>'),
e.put("select2/match.tpl.html",'<a class="select2-choice ui-select-match" ng-class="{\'select2-default\': $select.isEmpty()}" ng-click="$select.toggle($event)" aria-label="{{ $select.baseTitle }} select"><span ng-show="$select.isEmpty()" class="select2-chosen">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="select2-chosen" ng-transclude=""></span> <abbr ng-if="$select.allowClear && !$select.isEmpty()" class="select2-search-choice-close" ng-click="$select.clear($event)"></abbr> <span class="select2-arrow ui-select-toggle"><b></b></span></a>'),e.put("select2/no-choice.tpl.html",'<div class="ui-select-no-choice dropdown" ng-show="$select.items.length == 0"><div class="dropdown-content"><div data-selectable="" ng-transclude=""></div></div></div>'),e.put("select2/select-multiple.tpl.html",'<div class="ui-select-container ui-select-multiple select2 select2-container select2-container-multi" ng-class="{\'select2-container-active select2-dropdown-open open\': $select.open, \'select2-container-disabled\': $select.disabled}"><ul class="select2-choices"><span class="ui-select-match"></span><li class="select2-search-field"><input type="search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="combobox" aria-expanded="true" aria-owns="ui-select-choices-{{ $select.generatedId }}" aria-label="{{ $select.baseTitle }}" aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}" class="select2-input ui-select-search" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-disabled="$select.disabled" ng-hide="$select.disabled" ng-model="$select.search" ng-click="$select.activate()" style="width: 34px;" ondrop="return false;"></li></ul><div class="ui-select-dropdown select2-drop select2-with-searchbox select2-drop-active" ng-class="{\'select2-display-none\': !$select.open || $select.items.length === 0}"><div class="ui-select-choices"></div></div></div>'),e.put("select2/select.tpl.html",'<div class="ui-select-container select2 select2-container" ng-class="{\'select2-container-active select2-dropdown-open open\': $select.open, \'select2-container-disabled\': $select.disabled, \'select2-container-active\': $select.focus, \'select2-allowclear\': $select.allowClear && !$select.isEmpty()}"><div class="ui-select-match"></div><div class="ui-select-dropdown select2-drop select2-with-searchbox select2-drop-active" ng-class="{\'select2-display-none\': !$select.open}"><div class="select2-search" ng-show="$select.searchEnabled"><input type="search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="combobox" aria-expanded="true" aria-owns="ui-select-choices-{{ $select.generatedId }}" aria-label="{{ $select.baseTitle }}" aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}" class="ui-select-search select2-input" ng-model="$select.search"></div><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div></div>'),e.put("selectize/choices.tpl.html",'<div ng-show="$select.open" class="ui-select-choices ui-select-dropdown selectize-dropdown single"><div class="ui-select-choices-content selectize-dropdown-content"><div class="ui-select-choices-group optgroup" role="listbox"><div ng-show="$select.isGrouped" class="ui-select-choices-group-label optgroup-header" ng-bind="$group.name"></div><div role="option" class="ui-select-choices-row" ng-class="{active: $select.isActive(this), disabled: $select.isDisabled(this)}"><div class="option ui-select-choices-row-inner" data-selectable=""></div></div></div></div></div>'),e.put("selectize/match.tpl.html",'<div ng-hide="$select.searchEnabled && ($select.open || $select.isEmpty())" class="ui-select-match" ng-transclude=""></div>'),e.put("selectize/no-choice.tpl.html",'<div class="ui-select-no-choice selectize-dropdown" ng-show="$select.items.length == 0"><div class="selectize-dropdown-content"><div data-selectable="" ng-transclude=""></div></div></div>'),e.put("selectize/select.tpl.html",'<div class="ui-select-container selectize-control single" ng-class="{\'open\': $select.open}"><div class="selectize-input" ng-class="{\'focus\': $select.open, \'disabled\': $select.disabled, \'selectize-focus\' : $select.focus}" ng-click="$select.open && !$select.searchEnabled ? $select.toggle($event) : $select.activate()"><div class="ui-select-match"></div><input type="search" autocomplete="off" tabindex="-1" class="ui-select-search ui-select-toggle" ng-click="$select.toggle($event)" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-hide="!$select.searchEnabled || (!$select.isEmpty() && !$select.open)" ng-disabled="$select.disabled" aria-label="{{ $select.baseTitle }}"></div><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>')}]),function(){function e(e,t,n,i,o,r,a,s){function c(){$(),w(),b()}function l(){E.currentViewState=E.viewStates.NEW,E.selectedContentType={}}function u(e){E.currentViewState=E.viewStates.EDIT,E.selectedContentType=e}function d(e){return!_.findWhere(E.contentTypes,{name:e})}function p(){e.contentTypeForm.submitted=!0,e.contentTypeForm.$valid&&(E.currentViewState==E.viewStates.NEW&&E.isValidName(E.selectedContentType.name)?a.post(E.selectedContentType).then(function(e){console.log(e),E.currentViewState=E.viewStates.LIST,E.selectedContentType={},c(),I("success","New content type has been added")},function(e){I("error","Cannot add layout type, please contact administrator")}):T(E.selectedContentType))}function f(e){T(e)}function g(e,t,n){return e&&n?e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n]:e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid}function v(){E.currentViewState=E.viewStates.LIST}function h(e){var t=e.replace(/\s+/g,"");t=t.toLowerCase();var n={name:t,label:e};return n}function m(){S()||(E.selectedContentType.properties||(E.selectedContentType.properties=[]),E.selectedProperty.id?E.selectedContentType.properties.push(E.selectedProperty):s.post(E.selectedProperty).then(function(e){console.log(e),E.selectedProperty=e,E.selectedContentType.properties.push(E.selectedProperty),b(),I("success","New property has been added")},function(e){I("error","Cannot add new property, please contact administrator")}))}function y(e){E.selectedContentType.properties=_.reject(E.selectedContentType.properties,function(t){return t.id===e.id})}function S(){var e=_.findWhere(E.selectedContentType.properties,{id:E.selectedProperty.id});return e}function $(){a.get().then(function(e){E.contentTypes=e},function(e){I("error","Cannot get all content types, please contact administrator")})}function w(){a.getContentDataType().then(function(e){E.contentDataTypes=e},function(e){I("error","Cannot get all content data types, please contact administrator")})}function b(){s.get().then(function(e){E.properties=e},function(e){I("error","Cannot get all properties, please contact administrator")})}function T(e){a.put(e).then(function(e){console.log(e),c(),I("success","Content Type has been updated"),E.currentViewState=E.viewStates.LIST},function(e){I("error","Cannot update layout type, please contact administrator")})}function I(e,n){E.message={messageType:e,content:n},t(function(){E.message={}},o.appSettings.alertLifeTime)}var E=this;SYS_ERROR_MSG=o.appSettings.systemErrorMsg,E.alerts=[],E.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},E.currentViewState=E.viewStates.LIST,E.newContent=l,E.edit=u,E.isValidName=d,E.save=p,E.activate=f,E.cancel=v,E.hasError=g,E.propertyTransform=h,E.addProperty=m,E.removeProperty=y,E.isPropExist=S,c()}var t=angular.module("deviser.contentTypes",["ui.router","ui.bootstrap","ui.select","sd.sdlib","deviser.services","deviser.config"]);t.controller("ContentTypesCtrl",["$scope","$timeout","$filter","$q","globals","sdUtil","contentTypeService","propertyService",e])}(),function(){function e(e,t,n,i,o,r,a){function s(){S(),$()}function c(){T.currentViewState=T.viewStates.NEW,T.selectedLayoutType={}}function l(e){T.currentViewState=T.viewStates.EDIT,T.selectedLayoutType=e;var t=T.selectedLayoutType.layoutTypeIds.replace(/\s+/g,"").split(",");T.selectedLayoutType.allowedLayoutTypes=_.filter(T.layoutTypes,function(e){return _.contains(t,e.id)})}function u(e){return!_.findWhere(T.layoutTypes,{name:e})}function d(){if(e.layoutForm.submitted=!0,e.layoutForm.$valid)if(T.currentViewState==T.viewStates.NEW&&T.isValidName(T.selectedLayoutType.name))r.post(T.selectedLayoutType).then(function(e){console.log(e),T.currentViewState=T.viewStates.LIST,T.selectedLayoutType={},S(),b("success","New content type has been added")},function(e){b("error","Cannot add layout type, please contact administrator")});else{var t=_.pluck(T.selectedLayoutType.allowedLayoutTypes,"id");T.layoutTypeIds=t.join(","),delete T.selectedLayoutType.allowedLayoutTypes,w(T.selectedLayoutType)}}function p(e){w(e)}function f(e,t,n){return e&&n?e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n]:e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid}function g(){T.currentViewState=T.viewStates.LIST}function v(e){var t=e.replace(/\s+/g,"");t=t.toLowerCase();var n={name:t,label:e};return n}function h(){y()||(T.selectedLayoutType.properties||(T.selectedLayoutType.properties=[]),T.selectedProperty.id?T.selectedLayoutType.properties.push(T.selectedProperty):a.post(T.selectedProperty).then(function(e){console.log(e),T.selectedProperty=e,T.selectedLayoutType.properties.push(T.selectedProperty),$(),b("success","New property has been added")},function(e){b("error","Cannot add new property, please contact administrator")}))}function m(e){T.selectedLayoutType.properties=_.reject(T.selectedLayoutType.properties,function(t){return t.id===e.id})}function y(){var e=_.findWhere(T.selectedLayoutType.properties,{id:T.selectedProperty.id});return e}function S(){r.get().then(function(e){T.layoutTypes=e},function(e){b("error","Cannot get all layout types, please contact administrator")})}function $(){a.get().then(function(e){T.properties=e},function(e){b("error","Cannot get all properties, please contact administrator")})}function w(e){r.put(e).then(function(e){console.log(e),S(),b("success","Layout type has been updated"),T.currentViewState=T.viewStates.LIST},function(e){b("error","Cannot update layout type, please contact administrator")})}function b(e,n){T.message={messageType:e,content:n},t(function(){T.message={}},o.appSettings.alertLifeTime)}var T=this;SYS_ERROR_MSG=o.appSettings.systemErrorMsg,T.alerts=[],T.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},T.currentViewState=T.viewStates.LIST,T.newContentType=c,T.edit=l,T.isValidName=u,T.save=d,T.activate=p,T.cancel=g,T.hasError=f,T.propertyTransform=v,T.addProperty=h,T.removeProperty=m,T.isPropExist=y,s()}var t=angular.module("deviser.layoutTypes",["ui.router","ui.bootstrap","ui.select","sd.sdlib","deviser.services","deviser.config"]);t.controller("LayoutTypesCtrl",["$scope","$timeout","$filter","$q","globals","layoutTypeService","propertyService",e])}(),function(){function e(e,t,n,i,o,r,a){function s(){m()}function c(){$.currentViewState=$.viewStates.NEW,$.selectedOptionList={}}function l(e){$.currentViewState=$.viewStates.EDIT,$.selectedOptionList=e,$.selectedOptionList.items=[],$.selectedOptionList.list&&($.selectedOptionList.items=$.selectedOptionList.list)}function u(e){return!_.findWhere($.optionLists,{name:e})}function d(){e.optionListForm.submitted=!0,e.optionListForm.$valid&&($.selectedOptionList.items&&($.selectedOptionList.list=$.selectedOptionList.items),$.currentViewState==$.viewStates.NEW&&$.isValidName($.selectedOptionList.name)?a.post($.selectedOptionList).then(function(e){console.log(e),$.currentViewState=$.viewStates.LIST,$.selectedOptionList={},m(),S("success","New option list has been added")},function(e){S("error","Cannot add option list, please contact administrator")}):y($.selectedOptionList))}function p(e){y(e)}function f(e,t,n){return e&&n?e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n]:e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid}function g(){$.currentViewState=$.viewStates.LIST}function v(){var e={id:r.getGuid(),name:"",label:""};$.selectedOptionList.items||($.selectedOptionList.items=[]),$.selectedOptionList.items.push(e)}function h(e){$.selectedOptionList.items=_.reject($.selectedOptionList.items,function(t){return t.id===e.id})}function m(){a.get().then(function(e){$.optionLists=e},function(e){S("error","Cannot get option lists, please contact administrator")})}function y(e){a.put(e).then(function(e){console.log(e),m(),S("success","Option list has been updated"),$.currentViewState=$.viewStates.LIST},function(e){S("error","Cannot update option list, please contact administrator")})}function S(e,n){$.message={messageType:e,content:n},t(function(){$.message={}},o.appSettings.alertLifeTime)}var $=this;SYS_ERROR_MSG=o.appSettings.systemErrorMsg,$.alerts=[],$.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},$.currentViewState=$.viewStates.LIST,$.newList=c,$.edit=l,$.isValidName=u,$.save=d,$.activate=p,$.cancel=g,$.hasError=f,$.addListItem=v,$.removeListItem=h,s()}var t=angular.module("deviser.optionList",["ui.router","ui.bootstrap","ui.select","sd.sdlib","deviser.services","deviser.config"]);t.controller("OptionListCtrl",["$scope","$timeout","$filter","$q","globals","sdUtil","optionListService",e])}(),function(){function e(e,t,n,i,o,r,a,s){function c(){h(),m()}function l(){$.currentViewState=$.viewStates.NEW,$.selectedProperty={}}function u(e){$.currentViewState=$.viewStates.EDIT,$.selectedProperty=e,$.selectedProperty.propertyOptionListId&&($.selectedProperty.moreOption=!0)}function d(e){return!_.findWhere($.properties,{name:e})}function p(){e.propertyForm.submitted=!0,e.propertyForm.$valid&&($.selectedProperty.propertyOptionListId=$.selectedProperty.moreOption&&$.selectedProperty.propertyOptionList?$.selectedProperty.propertyOptionList.id:null,$.selectedProperty.propertyOptionList=null,$.currentViewState==$.viewStates.NEW&&$.isValidName($.selectedProperty.name)?a.post($.selectedProperty).then(function(e){console.log(e),$.currentViewState=$.viewStates.LIST,$.selectedProperty={},h(),S("success","New property has been added")},function(e){S("error","Cannot add new property, please contact administrator")}):y($.selectedProperty))}function f(e){y(e)}function g(e,t,n){return e&&n?e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n]:e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid}function v(){$.currentViewState=$.viewStates.LIST}function h(){a.get().then(function(e){$.properties=e},function(e){S("error","Cannot get all properties, please contact administrator")})}function m(){s.get().then(function(e){$.optionLists=e},function(e){S("error","Cannot get option lists, please contact administrator")})}function y(e){a.put(e).then(function(e){console.log(e),h(),S("success","Property has been updated"),$.currentViewState=$.viewStates.LIST},function(e){S("error","Cannot update layout type, please contact administrator")})}function S(e,n){$.message={messageType:e,content:n},t(function(){$.message={}},o.appSettings.alertLifeTime)}var $=this;SYS_ERROR_MSG=o.appSettings.systemErrorMsg,$.alerts=[],$.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},$.currentViewState=$.viewStates.LIST,$.newProperty=l,$.edit=u,$.isValidName=d,$.save=p,$.activate=f,$.cancel=v,$.hasError=g,c()}var t=angular.module("deviser.properties",["ui.router","ui.bootstrap","ui.select","sd.sdlib","deviser.services","deviser.config"]);t.controller("PropertiesCtrl",["$scope","$timeout","$filter","$q","globals","sdUtil","propertyService","optionListService",e])}(),function(){function e(e,t,n,i,o,r){function a(){c()}function s(){}function c(){r.get().then(function(e){u.files=e},function(e){l("error","Cannot get all files and folders, please contact administrator")})}function l(e,n){u.message={messageType:e,content:n},t(function(){u.message={}},o.appSettings.alertLifeTime)}var u=this;SYS_ERROR_MSG=o.appSettings.systemErrorMsg,u.alerts=[],u.upload=s,a()}var t=angular.module("deviser.filemanger",["ui.router","ui.bootstrap","ui.select","sd.sdlib","deviser.services","deviser.config"]);t.controller("FileManagerCtrl",["$scope","$timeout","$filter","$q","globals","fileService",e])}(),function(){function e(e,t,n,i,o,r){function a(){s(),c()}function s(){r.get().then(function(e){g.languages=e},function(e){f("error","Cannot get all languages, please contact administrator")})}function c(){r.getSiteLanguages().then(function(e){g.siteLanguages=e},function(e){f("error","Cannot get site languages, please contact administrator")})}function l(){g.currentViewState=g.viewStates.NEW}function u(){r.post(g.selectedLanguage).then(function(e){console.log(e),g.currentViewState=g.viewStates.LIST,g.selectedLanguage={},c(),f("success","New language has been added")},function(e){f("error","Cannot add language, please contact administrator")})}function d(e){r.put(e).then(function(e){console.log(e),c(),f("success","Role has been updated")},function(e){f("error","Cannot update role, please contact administrator")})}function p(){g.currentViewState=g.viewStates.LIST}function f(e,n){g.message={messageType:e,content:n},t(function(){g.message={}},o.appSettings.alertLifeTime)}var g=this;SYS_ERROR_MSG=o.appSettings.systemErrorMsg,g.alerts=[],g.add=l,g.save=u,g.activate=d,g.cancel=p,g.viewStates={NEW:"NEW",LIST:"LIST"},g.currentViewState=g.viewStates.LIST,a()}var t=angular.module("deviser.language",["ui.router","ui.bootstrap","ui.select","sd.sdlib","deviser.services","deviser.config"]);t.controller("LanguageCtrl",["$scope","$timeout","$filter","$q","globals","languageService",e])}(),function(){function e(e,t,n,i,o,r,a,s,c){function l(){A.currentLocale=pageContext.currentLocale,A.accordion={},u(),f(),d(),p()}function u(){r.get().then(function(e){A.pages=[],A.pages.push(e),x(A.pages[0])},function(e){P("error","Cannot load pages, please contact administrator")})}function d(){a.get().then(function(e){A.skins=e},function(e){P("error","Cannot load skin, please contact administrator")})}function p(){s.getSiteLanguages().then(function(e){A.languages=e},function(e){P("error","Cannot get all languages, please contact administrator")})}function f(){c.get().then(function(e){A.roles=e},function(e){P("error","Cannot get all roles, please contact administrator")})}function g(){var e=_.findWhere(A.selectedItem.pageTranslation,{locale:A.currentLocale}),t=_.findWhere(A.selectedItem.pageTranslation,{locale:A.siteLanguage});t=JSON.parse(angular.toJson(t)),e||(t.locale=A.currentLocale,t.name+=A.currentLocale.replace("-","").toLowerCase(),A.selectedItem.pageTranslation.push(t))}function v(e,t){e.preventDefault(),e.stopPropagation(),t.opened=!0}function h(e,t,n){var i=t&&t.depth()>0;return i}function m(e){var t=e.source.nodeScope.page,n=e.dest.nodesScope.page;t&&n&&(t.parentId=n.id,t.pageLevel=e.dest.nodesScope.depth(),M(A.pages[0]),R())}function y(e){if(e){var t=e.id;r.remove(t).then(function(t){e.isDeleted=!0,P("success","Page has been removed")},function(e){P("error","'Cannot remove page, please contact administrator")})}}function S(e){e.toggle()}function $(e){A.currentLocale=A.siteLanguage,A.selectedItem=e,A.accordion.common=!A.accordion.permissions,A.selectedItem.pagePermissions&&_.each(A.selectedItem.pagePermissions,function(e){e.isView=function(e){}})}function w(e,t){var n=_.find(e.pagePermissions,function(e){return e.roleId===t.id&&e.permissionId===O});return n}function b(e,t){var n=_.find(e.pagePermissions,function(e){return e.roleId===t.id&&e.permissionId===k});return n}function T(e,t){if(t.id!==D)if(w(e,t))e.pagePermissions=_.reject(e.pagePermissions,function(e){return e.roleId===t.id&&e.permissionId===O});else{var n={pageId:e.id,roleId:t.id,permissionId:O};e.pagePermissions.push(n)}}function I(e,t){if(t.id!==D)if(b(e,t))e.pagePermissions=_.reject(e.pagePermissions,function(e){return e.roleId===t.id&&e.permissionId===k});else{var n={pageId:e.id,roleId:t.id,permissionId:k};e.pagePermissions.push(n)}}function E(e){var t={parentId:e.id,childPage:[],pageLevel:e.pageLevel+1,pageTranslation:[{locale:A.currentLocale,name:"",url:"",title:null,description:null,keywords:null}]};r.post(t).then(function(t){e.childPage||(e.childPage=[]),e.childPage.push(t),P("success","Page created successfully")},function(e){P("error","'Cannot update page, please contact administrator")})}function C(){A.selectedItem&&L(A.selectedItem)}function L(e){r.put(e,e.id).then(function(e){A.selectedItem=e,P("success","Page updated successfully")},function(e){P("error","'Cannot update page, please contact administrator")})}function R(){r.put(A.pages[0]).then(function(e){P("success","All pages updated successfully")},function(e){P("error","'Cannot update all pages, please contact administrator")})}function M(e){e&&e.childPage&&_.each(e.childPage,function(e,t){e.pageOrder=t+1,M(e)})}function x(e){e&&(e.childPage?(e.childPage=_.sortBy(e.childPage,function(e){return e.pageOrder}),_.each(e.childPage,function(e,t){x(e)})):e.childPage=[])}function P(e,n){A.message={messageType:e,content:n},t(function(){A.message={}},o.appSettings.alertLifeTime)}var A=this,O=(o.appSettings.systemErrorMsg,o.appSettings.permissions.pageView),k=o.appSettings.permissions.pageEdit,D=o.appSettings.roles.administrator;A.alerts=[],A.pages=[],A.selectedItem={},A.liveTill={},A.liveFrom={},A.administratorRoleId=D,A.options={accept:h,dropped:m},A.dateFormat="dd.MM.yyyy",A.openDatePicker=v,A.dateOptions={formatYear:"yy",startingDay:1},A.disabledDatePicker=function(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())},e.$watch(function(){return A.pages},function(){A.isChanged=!0},!0),A["delete"]=y,A.toggle=S,A.selectPage=$,A.newSubPage=E,A.changeLanguage=g,A.save=C,A.isView=w,A.isEdit=b,A.changeViewPermission=T,A.changeEditPermission=I,A.siteLanguage="en-US",l()}var t=angular.module("deviser.pageMangement",["ui.router","ui.bootstrap","ui.tree","ui.select","sd.sdlib","deviser.services","deviser.config"]);t.controller("PageManagementCtrl",["$scope","$timeout","$filter","$q","globals","pageService","skinService","languageService","roleService",e]),t.filter("selectLanguage",function(){return function(e,t){return e&&t?_.filter(e,function(e){return e.locale===t}):e}})}(),function(){function e(e,t,n,i,o,r){function a(){r.get().then(function(e){g.roles=e},function(e){f("error","Cannot get all roles, please contact administrator")})}function s(){g.currentViewState=g.viewStates.NEW}function c(e){g.selectedRole=e,g.currentViewState=g.viewStates.EDIT}function l(e){r.remove(e.id).then(function(e){console.log(e),a(),g.currentViewState=g.viewStates.LIST,f("success","Role has been removed")},function(e){f("error","Cannot remove role, please contact administrator")})}function u(){e.roleForm.submitted=!0,g.currentViewState==g.viewStates.EDIT?e.editRoleForm.$valid&&r.put(g.selectedRole).then(function(e){console.log(e),a(),g.currentViewState=g.viewStates.LIST,f("success","Role has been updated")},function(e){f("error","Cannot update role, please contact administrator")}):g.currentViewState==g.viewStates.NEW&&e.roleForm.$valid&&r.post(g.newRole).then(function(e){console.log(e),g.currentViewState=g.viewStates.LIST,g.newRole={},a(),f("success","New role has been created")},function(e){f("error","Cannot create role, please contact administrator")})}function d(e,t,n){return e&&n?e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n]:e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid}function p(){g.currentViewState=g.viewStates.LIST}function f(e,n){g.message={messageType:e,content:n},t(function(){g.message={}},o.appSettings.alertLifeTime)}var g=this;SYS_ERROR_MSG=o.appSettings.systemErrorMsg,g.alerts=[],g.add=s,g.edit=c,g.remove=l,g.save=u,g.cancel=p,g.hasError=d,g.viewStates={NEW:"NEW",LIST:"LIST",EDIT:"EDIT"},g.currentViewState=g.viewStates.LIST,a()}var t=angular.module("deviser.securityRoles",["ui.router","ui.bootstrap","ui.tree","sd.sdlib","deviser.services","deviser.config"]);t.controller("SecurityRolesCtrl",["$scope","$timeout","$filter","$q","globals","roleService",e])}(),function(){function e(e,t,n,i,o,r,a,s,c,l){function u(){r.get().then(function(e){E.users=e},function(e){T("error","Cannot get users, please contact administrator")})}function d(){c.get().then(function(e){E.roles=I=e},function(e){T("error","Cannot get roles, please contact administrator")})}function p(){E.currentViewState=E.viewStates.NEW}function f(e){E.selectedUser=e,m(),E.currentViewState=E.viewStates.EDIT}function g(e){r.remove(e.id).then(function(e){console.log(e),u(),T("success","User has been removed")},function(e){T("error","Cannot remove the user, please contact administrator")})}function v(){var e={userId:E.selectedUser.id,roleName:E.selectedRole.name};l.post(e).then(function(e){E.selectedUser=e,m()},function(e){T("error","Cannot add role, please contact administrator")})}function h(e){var t={userId:E.selectedUser.id,roleName:e.name};l.remove(t.userId,t.roleName).then(function(e){E.selectedUser=e,m()},function(e){T("error","Cannot remove role, please contact administrator")})}function m(){E.selectedUser&&(E.roles=_.reject(I,function(e){return _.findWhere(E.selectedUser.roles,{id:e.id})}))}function y(){e.userForm.submitted=!0,E.currentViewState==E.viewStates.EDIT?e.editUserForm.$valid&&r.put(E.selectedUser).then(function(e){console.log(e),E.currentViewState=E.viewStates.LIST,T("success","Profile has been updated")},function(e){T("error","Cannot update user, please contact administrator")}):E.currentViewState==E.viewStates.NEW&&e.userForm.$valid&&!E.isUserExist&&r.post(E.newUser).then(function(e){console.log(e),E.currentViewState=E.viewStates.LIST,E.newUser={},u(),T("success","New user has been created")},function(e){if(e.errors){var t="";_.each(e.errors,function(e){t+=e.description}),T("error",t)}else T("error","Cannot update user, please contact administrator")})}function S(){e.passwordResetForm.submitted=!0,e.passwordResetForm.$valid&&(E.passwordReset.userId=E.selectedUser.id,s.post(E.passwordReset).then(function(e){if(console.log(e),e&&e.succeeded===!0)E.currentViewState=E.viewStates.LIST,E.passwordReset={},u(),T("success","Password has been reset");else if(e.errors){var t="";_.each(e.errors,function(e){t+=e.description}),T("error",t)}else T("error","Cannot reset password, please contact administrator")},function(e){T("error","Cannot reset password, please contact administrator")}))}function $(e,t,n){return e&&n?e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n]:e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid}function w(){E.currentViewState=E.viewStates.LIST}function b(t){if(!e.userForm.email.$error.email&&t){var n={userName:t};a.post(n).then(function(e){E.isUserExist=e},function(e){T("error","Cannot check email address, please contact administrator")})}}function T(e,n){E.message={messageType:e,content:n},t(function(){E.message={}},o.appSettings.alertLifeTime)}var I,E=this;SYS_ERROR_MSG=o.appSettings.systemErrorMsg,E.alerts=[],E.add=p,E.edit=f,E.remove=g,E.save=y,E.cancel=w,E.checkUserExist=b,E.resetPassword=S,E.addRole=v,E.removeRole=h,E.hasError=$,E.viewStates={NEW:"NEW",LIST:"LIST",EDIT:"EDIT"},E.isUserExist=!0,E.currentViewState=E.viewStates.LIST,u(),d()}var t=angular.module("deviser.userManagement",["ui.router","ui.bootstrap","ui.tree","ui.select","ngSanitize","sd.sdlib","deviser.services","deviser.config"]);t.controller("UserManagementCtrl",["$scope","$timeout","$filter","$q","globals","userService","userExistService","passwordResetService","roleService","userRoleService",e])}();