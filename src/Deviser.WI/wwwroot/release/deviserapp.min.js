!function(){var e=angular.module("deviser.config",[]);e.config(["globalsProvider",function(e){e.appSettings.serviceBaseUrl="/api",e.appSettings.systemErrorMsg="Unexpected error has been occured, Please contact system administrator"}]),e.provider("globals",function(){this.$get=function(){return{appSettings:e.appSettings}};var e=this;e.appSettings={serviceBaseUrl:"",systemErrorMsg:"",alertLifeTime:1e4,permissions:{pageView:"29cb1b57-1862-4300-b378-f3271b870148",pageEdit:"2da41181-be15-4ad6-a89c-3ba8b71f993b",moduleView:"34b46847-80be-4099-842a-b654ad550c3e",moduleEdit:"cc3dbe2d-1e4a-46a0-8c10-9e73f1f5c699",contentView:"491b37a3-deba-4f55-9df6-a67cdd810108",contentEdit:"461b37d9-b801-4235-b74f-0c51f35d170f"},roles:{administrator:"9b461499-c49e-4398-bfed-4364a176ebbd",allUsers:"086357bf-01b1-494c-a8b8-54fdfa7c4c9e"},pageTypes:{standard:{id:"4c06dcfd-214f-45af-8404-ff84b412ab01",name:"Standard"},Url:{id:"bfefa535-7af1-4ddc-82c0-c906c948367a",name:"URL"}}}})}(),function(e,t){function n(){t("body").on("submit","form.dev-form",o),t("body").on("click","a.dev-ajax-load",r)}function o(n){n.preventDefault();var o=t(this),r=o.attr("action"),i=o.serialize(),a=o.attr("method").toUpperCase();console.log(i);var s=t.ajax({type:a,url:r,data:i,headers:{IsAjaxRequest:!0}});s.done(function(t,n,r){if(console.log(t),"object"==typeof t)console.log(t),t.value&&302===t.statusCode&&(e.location=t.value);else{var i=o.closest(".dev-module-container");o.remove(),i.html(t)}}),s.fail(function(e,t){console.log(e+""+t)})}function r(e){e.preventDefault();var n=t(this),o=n.attr("href"),r=t.ajax({type:"GET",url:o,headers:{IsAjaxRequest:!0}});r.done(function(e,t,o){console.log(e),n.closest(".dev-module-container").html(e)}),r.fail(function(e,t){console.log(e+""+t)})}e.devFormHelper=n,t(function(){n()})}(window,$),function(){var e=angular.module("deviserEdit",["ui.router","ui.sortable","ui.bootstrap","ui.select","dndLists","textAngular","dev.sdlib","deviser.services","deviser.config","modules.app.imageManager","modules.app.languageSelector","modules.app.linkSelector"]);e.config(["$provide",function(e){e.decorator("taOptions",["taRegisterTool","$delegate",function(e,t){return t.toolbar=[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","indent","outdent"],["html","wordcount","charcount"]],t}])}]),e.directive("devContentPreview",["$compile","$templateCache",function(e,t){return{restrict:"A",controller:["$scope","$uibModal",function(e,t){var n=this;function o(){n.templateMode="PREVIEW",n.contentType=n.content.contentType,n.contentTranslations=n.content.pageContentTranslation;var e=pageContext.currentLocale,t=function(e){var t=_.find(n.contentTranslations,{cultureCode:e});t||(t={cultureCode:e,contentData:{}});return t}(e);n.contentTranslation=t,"string"==typeof n.contentTranslation.contentData&&(n.contentTranslation.contentData=JSON.parse(n.contentTranslation.contentData))}o(),e.$watch(function(){return n.content.pageContentTranslation},function(e,t){o()},!0)}],controllerAs:"ecVM",bindToController:!0,link:function(n,o,r){template=t.get("contenttypes/"+n.ecVM.content.contentType.name+".html"),o.html(template),e(o.contents())(n)},scope:{content:"="}}}]),e.controller("EditCtrl",["$scope","$timeout","$filter","$q","$uibModal","globals","devUtil","editLayoutUtil","layoutService","pageService","contentTypeService","layoutTypeService","pageContentService","moduleService","moduleActionService","pageModuleService",function(e,t,n,o,r,i,a,s,c,l,u,d,p,f,g,m){var v=this,h=[],S={};function y(){var e=[],t=[];T(S.placeHolders),v.pageLayout=S,v.pageLayout.pageId=v.currentPage.id;var n=_.reject(v.pageContents,function(e){return _.includes(h,e.containerId)}),o=_.reject(v.pageModules,function(e){return _.includes(h,e.containerId)});_.forEach(n,function(t){var n=I(t);n.isUnassigned=!0,e.push(n)}),_.forEach(o,function(e){e.sortOrder;var n=L(e);n.isUnassigned=!0,t.push(n)}),v.uaLayout.placeHolders=[],v.uaLayout.placeHolders=v.uaLayout.placeHolders.concat(e),v.uaLayout.placeHolders=v.uaLayout.placeHolders.concat(t)}function T(e){e&&_.forEach(e,function(e){h.push(e.id);var t=_.filter(v.pageContents,{containerId:e.id});t&&_.forEach(t,function(t){var n=I(t);n.title||(n.title=n.contentType.label+" "+(e.placeHolders.length+1)),e.placeHolders.push(n)}),"content"!==e.layoutTemplate&&"module"!==e.layoutTemplate&&function(e){var t=e.properties,n=_.find(v.layoutTypes,{id:e.layoutTypeId}).properties;_.forEach(n,function(n){if(n){var o=_.find(t,{id:n.id});o?(o.label=n.label,o.description=n.description,o.defaultValue=n.defaultValue,o.optionList=n.optionList,o.optionListId=n.optionListId):e.properties.push(angular.copy(n))}})}(e);var n=_.filter(v.pageModules,{containerId:e.id});n&&_.forEach(n,function(t){t.sortOrder;var n=L(t);n.title||(n.title=n.moduleAction.displayName+" "+(e.placeHolders.length+1)),e.placeHolders.push(n)}),e.placeHolders=_.sortBy(e.placeHolders,["sortOrder"]),e.placeHolders&&T(e.placeHolders)})}function I(e){var t=e.properties,n=_.find(v.contentTypes,function(t){return t.contentType.id===e.contentType.id}),o=angular.copy(n.properties);_.forEach(o,function(e){var n=_.find(t,{id:e.id});n&&(e.value=n.value),e.optionList&&e.optionList.list&&(e.optionList=angular.fromJson(e.optionList.list))});var r={id:e.id,layoutTemplate:"content",type:"content",title:e.title,properties:o,pageContent:e,contentType:e.contentType,sortOrder:e.sortOrder};return r}function L(e){var t=e.properties,n=_.find(v.modules,function(t){return t.moduleAction.id===e.moduleAction.id}),o=angular.copy(n.moduleAction.properties);_.forEach(o,function(e){var n=_.find(t,{id:e.id});n&&(e.value=n.value),e.optionList&&e.optionList.list&&(e.optionList=angular.fromJson(e.optionList.list))});var r={id:e.id,layoutTemplate:"module",type:"module",title:e.title,moduleAction:e.moduleAction,pageModule:e,sortOrder:e.sortOrder,properties:o};return r}function E(e){var t={contents:[],modules:[]};_.forEach(e.placeHolders,function(n,o){n.sortOrder=o+1,"content"===n.layoutTemplate?t.contents.push({element:n,containerId:e.id}):"module"===n.layoutTemplate&&t.modules.push({element:n,containerId:e.id})});var n,r,i=jQuery.extend(!0,{},v.pageLayout);!function e(t){t.placeHolders=_.reject(t.placeHolders,function(e){return"content"===e.layoutTemplate||"module"===e.layoutTemplate});_.forEach(t.placeHolders,function(t){_.forEach(t.properties,function(e,t){e.optionList=null}),t.placeHolders&&e(t)})}(i),console.log("--------------------------"),console.log("Layout only"),console.log(i),o.all([function(e){var t=o.defer(),n=[];_.forEach(e.contents,function(e){var t={};e.element.id?(t.id=e.element.pageContent.id,t.pageId=e.element.pageContent.pageId,t.contentTypeId=e.element.pageContent.contentTypeId,t.inheritViewPermissions=e.element.pageContent.inheritViewPermissions,t.inheritEditPermissions=e.element.pageContent.inheritEditPermissions,t.hasEditPermission=e.element.pageContent.hasEditPermission):(t.id=v.newGuid(),t.pageId=pageContext.currentPageId,t.contentTypeId=e.element.contentType.id,t.hasEditPermission=!0,e.element.id=t.id,e.element.pageContent=t);var o=[];_.forEach(e.element.properties,function(e){if(e){var t={id:e.id,name:e.name,label:e.label,value:e.value};o.push(t)}}),t.properties=o,t.containerId=e.containerId,t.sortOrder=e.element.sortOrder,n.push(t)}),n&&n.length>0?p.putContents(n).then(function(e){console.log(e),t.resolve("page content updated")},function(e){console.log(e),t.reject(SYS_ERROR_MSG)}):t.reject(SYS_ERROR_MSG);return t.promise}(t),function(e){var t=o.defer(),n=[];_.forEach(e.modules,function(e){var t={pageId:pageContext.currentPageId,containerId:e.containerId,sortOrder:e.element.sortOrder};e.element.id?t.id=e.element.id:(t.id=v.newGuid(),e.element.id=t.id);var o=[],r=e.element.pageModule&&e.element.pageModule.properties?e.element.pageModule.properties:e.element.moduleAction.properties;_.forEach(r,function(e){if(e){var t={id:e.id,name:e.name,label:e.label,value:e.value};o.push(t)}}),t.properties=o,e.element.pageModule&&e.element.pageModule.module?(t.moduleId=e.element.pageModule.module.id,t.moduleActionId=e.element.pageModule.moduleActionId):(t.moduleId=e.element.moduleAction.moduleId,t.moduleActionId=e.element.moduleAction.id,t.hasEditPermission=!0,e.element.pageModule=t),n.push(t)}),n&&n.length>0?m.putModules(n).then(function(e){console.log(e),t.resolve("page content updated")},function(e){t.reject(SYS_ERROR_MSG)}):t.reject(SYS_ERROR_MSG);return t.promise}(t),(n=i,r=o.defer(),c.put(n).then(function(e){r.resolve("layout only updated")},function(e){C("error",SYS_ERROR_MSG),r.reject(SYS_ERROR_MSG)}),r.promise)]).then(function(){C("success","Layout has been saved")})}function w(e){"content"===e.layoutTemplate?function(e){p.remove(e).then(function(e){console.log(e)},function(e){C("error",SYS_ERROR_MSG)})}(e.id):"module"===e.layoutTemplate&&function(e){m.remove(e).then(function(e){console.log(e)},function(e){C("error",SYS_ERROR_MSG)})}(e.id)}function C(e,n){v.message={messageType:e,content:n},t(function(){v.message={messageType:"",content:""}},i.appSettings.alertLifeTime)}SYS_ERROR_MSG=i.appSettings.systemErrorMsg,v.alerts=[],v.pageLayout={},v.selectedItem={},v.deletedElements=[],v.layoutAllowedTypes=["container"],v.newGuid=a.getGuid,v.dropCallback=function(e,t,n){return n.sortOrder=t+1,n},v.insertedCallback=function(e,t,n){var o=$(e.currentTarget).scope().$parent;o.item.id;console.log("-----------------------"),console.log("insertedCallback"),console.log("-----------------------"),console.log("updatingElement"),E(o.item)},v.itemMoved=function(e,t,n){var o=$(n.currentTarget).closest(".dnd-list").scope().parentItem;e.splice(t,1),E(o),console.log("-----------------------"),console.log("itemMoved"),console.log("-----------------------")},v.deleteElement=function(e,t,n){return w(n),n},v.selectItem=function(e){"content"!==e.layoutTemplate&&"module"!==e.layoutTemplate||(v.selectedItem=e,_.forEach(e.properties,function(e){e.optionList&&e.optionList.list&&(e.optionList=angular.fromJson(e.optionList.list))}))},v.editContent=function(e){var t=o.defer(),n=e;return r.open({animation:!0,size:"lg",openedClass:"edit-content-modal",backdrop:"static",templateUrl:"contenttypes/"+n.contentType.name+".html",controller:"EditContentCtrl as ecVM",resolve:{contentInfo:function(){var e=n;return e}}}).result.then(function(n){e.pageContent.pageContentTranslation[0]=angular.fromJson(n),t.resolve("data received!")},function(){t.reject(SYS_ERROR_MSG)}),t.promise},v.editModule=function(e){var t;v.selectedItem=e,t=e.pageModule?e.pageModule.moduleId:e.moduleAction.moduleId;g.getEditActions(t).then(function(e){v.selectedItem.pageModule||(v.selectedItem.pageModule={}),v.selectedItem.pageModule.editActions=e},function(e){console.log(e),C("error",SYS_ERROR_MSG)})},v.openModuleActionEdit=function(e){var t=o.defer();return r.open({animation:!0,size:"lg",openedClass:"edit-content-modal",backdrop:"static",templateUrl:"app/components/editModule.tpl.html",controller:"EditModuleCtrl as emVM",resolve:{moduleInfo:function(){var t={moduleActionId:e.id,pageModuleId:v.selectedItem.id};return t}}}).result.then(function(e){t.resolve("data received!")},function(){t.reject(SYS_ERROR_MSG)}),t.promise},v.changeModulePermission=function(e){var t=o.defer();return r.open({animation:!0,size:"lg",backdrop:"static",templateUrl:"app/components/permissionEditor.tpl.html",controller:"ModulePermissionCtrl as peVM",resolve:{pageModule:function(){var t=e;return t}}}).result.then(function(e){t.resolve("data received!")},function(){t.reject(SYS_ERROR_MSG)}),t.promise},v.changeContentPermission=function(e){var t=o.defer();return r.open({animation:!0,size:"lg",backdrop:"static",templateUrl:"app/components/permissionEditor.tpl.html",controller:"ContentPermissionCtrl as peVM",resolve:{pageContent:function(){var t=e;return t}}}).result.then(function(e){t.resolve("data received!")},function(){t.reject(SYS_ERROR_MSG)}),t.promise},v.saveProperties=function(){var e=[];if(_.forEach(v.selectedItem.properties,function(t){if(t){var n={id:t.id,name:t.name,label:t.label,value:t.value,description:t.description,defaultValue:t.defaultValue};e.push(n)}}),"content"===v.selectedItem.layoutTemplate){var t={};t.id=v.selectedItem.pageContent.id,t.pageId=v.selectedItem.pageContent.pageId,t.title=v.selectedItem.title,t.contentTypeId=v.selectedItem.pageContent.contentTypeId,t.properties=e,t.containerId=v.selectedItem.pageContent.containerId,t.sortOrder=v.selectedItem.sortOrder,p.put(t).then(function(e){console.log(e),v.selectedItem.isPropertyChanged=!1,C("success","Content Element properities have been saved successfully.")},function(e){console.log(e),C("error","Cannot save the content element properities,please contact administrator")},!0)}else if("module"===v.selectedItem.layoutTemplate){var n=v.selectedItem.pageModule;n.title=v.selectedItem.title,n.containerId=v.selectedItem.pageModule.containerId,n.sortOrder=v.selectedItem.sortOrder,n.properties=e,m.put(n).then(function(e){console.log(e),C("success","Module properities have been saved successfully.")},function(e){console.log(e),C("error","Cannot save the module properities,please contact administrator")},!0)}},v.setColumnWidth=s.setColumnWidth,v.draft=function(){l.draftPage(v.currentPage.id).then(function(e){v.currentPage.state="Publish",C("success","The Page has been drafted.")},function(e){C("error","Cannot draft the page, please contact the administrator.")})},v.publish=function(){"Publish"==v.currentPage.state&&l.publishPage(v.currentPage.id).then(function(e){v.currentPage.state="Published",C("success","The Page has been published.")},function(e){C("error","Cannot publish the page, please contact the administrator.")})},v.uaLayout={},S={},(b=o.defer(),l.get(pageContext.currentPageId).then(function(e){v.currentPage=e;var t=_.find(v.currentPage.pagePermissions,{roleId:i.appSettings.roles.allUsers});v.currentPage.state=t?"Published":"Publish",b.resolve(e)},function(e){C("error",SYS_ERROR_MSG),b.reject(SYS_ERROR_MSG)}),b.promise).then(function(){o.all([function(){var e=o.defer();return c.get(v.currentPage.layoutId).then(function(t){S=t,e.resolve("data received")},function(t){C("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}(),function(){var e=o.defer();return u.get().then(function(t){var n=t;v.contentTypes=[],_.forEach(n,function(e){v.contentTypes.push({layoutTemplate:"content",type:"content",contentType:e,properties:e.properties})}),e.resolve("data received!")},function(t){C("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}(),function(){var e=o.defer();return d.get().then(function(t){v.layoutTypes=t,e.resolve("data received!")},function(t){C("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}(),function(){var e=o.defer();return g.get().then(function(t){var n=t;v.modules=[],_.forEach(n,function(e){v.modules.push({layoutTemplate:"module",type:"module",moduleAction:e,properties:e.properties})}),e.resolve("data received!")},function(e){C("error",SYS_ERROR_MSG),deferred.reject(SYS_ERROR_MSG)}),e.promise}(),function(){var e=o.defer();return p.get(pageContext.currentPageId,pageContext.currentLocale).then(function(t){v.pageContents=t,e.resolve(t)},function(t){C("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}(),function(){var e=o.defer();return m.getByPage(pageContext.currentPageId).then(function(t){v.pageModules=t,e.resolve(t)},function(t){C("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}()]).then(function(){y()})}),e.$watch(function(){return v.selectedItem.properties},function(e,t){v.selectedItem.isPropertyChanged=!0},!0);var b}]),e.controller("EditContentCtrl",["$scope","$uibModalInstance","$q","devUtil","languageService","pageContentService","contentTranslationService","dateConverter","contentInfo",function(e,t,n,o,r,i,a,s,c){var l=this;function u(e){var t=_.find(l.contentTranslations,{cultureCode:e});return t||(t={cultureCode:e,contentData:{items:[]}}),t}function d(){var e=s.prepareRequest(l.contentTranslation.contentData);l.contentTranslation.contentData=angular.toJson(e)}function p(){if("string"==typeof l.contentTranslation.contentData){var e=JSON.parse(l.contentTranslation.contentData);l.contentTranslation.contentData=s.parseResponse(e)}}l.contentId=c.id,l.properties=c.properties,l.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},l.currentViewState=l.viewStates.LIST,l.changeLanguage=function(){var e=u(l.selectedLocale.cultureCode);l.contentTranslation=e,p()},l.save=function(){l.contentTranslation.id?(d(),a.put(l.contentTranslation).then(function(e){e.contentData=angular.fromJson(e.contentData),console.log(e),t.close(e)},function(e){showMessage("error",SYS_ERROR_MSG)})):(l.contentTranslation.pageContentId=l.contentId,d(),a.post(l.contentTranslation).then(function(e){e.contentData=angular.fromJson(e.contentData),console.log(e),t.close(e)},function(e){showMessage("error",SYS_ERROR_MSG)}))},l.cancel=function(){t.dismiss("cancel")},l.newItem=function(){l.selectedItem={},l.currentViewState=l.viewStates.NEW},l.updateItem=function(){l.selectedItem.id||(l.selectedItem.id=o.getGuid(),l.selectedItem.viewOrder=l.contentTranslation.contentData.items.length+1,l.contentTranslation.contentData.items.push(l.selectedItem));l.currentViewState=l.viewStates.LIST},l.editItem=function(e){l.selectedItem=e,l.tempItem=angular.copy(e),l.currentViewState=l.viewStates.EDIT},l.removeItem=function(e){var t=l.contentTranslation.contentData.items.indexOf(e);l.contentTranslation.contentData.items.splice(t,1),l.isChanged=!0},l.cancelDetailView=function(){if(l.currentViewState==l.viewStates.NEW)l.selectedItem={};else if(l.currentViewState==l.viewStates.EDIT){var e=_.findIndex(l.contentTranslation.contentData.items,l.selectedItem);l.selectedItem=l.tempItem,l.contentTranslation.contentData.items.splice(e,1,l.tempItem)}l.currentViewState=l.viewStates.LIST},l.sortableOptions={stop:function(e,t){_.forEach(l.contentTranslation.contentData.items,function(e,t){e.viewOrder=t+1})}},l.dateOptions={formatYear:"yy",maxDate:new Date(2025,11,31),minDate:new Date(2018,0,1),startingDay:1},l.templateMode="EDITCONTENT",n.all([(g=n.defer(),i.get(l.contentId).then(function(e){console.log(e),l.contentTranslations=e.pageContentTranslation,l.contentType=e.contentType,g.resolve("data received!")},function(e){showMessage("error",SYS_ERROR_MSG),g.reject(SYS_ERROR_MSG)}),g.promise),(f=n.defer(),r.getSiteLanguages().then(function(e){l.languages=e,f.resolve("data received!")},function(e){showMessage("error","Cannot get all languages, please contact administrator"),f.reject(SYS_ERROR_MSG)}),f.promise)]).then(function(){var e=pageContext.currentLocale;l.selectedLocale=_.find(l.languages,{cultureCode:e});var t=u(l.selectedLocale.cultureCode);l.contentTranslation=t,p()});var f;var g}]),e.controller("EditModuleCtrl",["$scope","$timeout","$uibModalInstance","$q","$sce","devUtil","globals","moduleActionService","moduleInfo",function(e,t,n,o,r,i,a,s,c){var l=this;l.pageModuleId=c.pageModuleId,l.moduleActionId=c.moduleActionId,l.cancel=function(){n.dismiss("cancel")},s.getEditActionView(pageContext.currentUrl,l.pageModuleId,l.moduleActionId).then(function(e){console.log(e),l.editView=r.trustAsHtml(e)},function(e){console.log(e)})}]),e.controller("ModulePermissionCtrl",["$scope","$timeout","$uibModalInstance","$q","devUtil","globals","roleService","pageModuleService","pageModule",function(e,t,n,o,r,i,a,s,c){var l=this,u=i.appSettings.permissions.moduleView,d=i.appSettings.permissions.moduleEdit,p=i.appSettings.roles.administrator,f=c;function g(e){if(l.pageModule){var t=_.find(l.pageModule.modulePermissions,function(t){return t.roleId===e.id&&t.permissionId===u});return t}return!1}function m(e){if(l.pageModule){var t=_.find(l.pageModule.modulePermissions,function(t){return t.roleId===e.id&&t.permissionId===d});return t}return!1}function v(e,n){l.message={messageType:e,content:n},t(function(){l.message={messageType:"",content:""}},i.appSettings.alertLifeTime)}l.label={title:"Module Permission",tableRowTitleView:"View Module",tableRowTitleEdit:"Edit Module"},l.administratorRoleId=p,l.isView=g,l.isEdit=m,l.changeViewPermission=function(e){if(e.id!==p)if(g(e))l.pageModule.modulePermissions=_.reject(l.pageModule.modulePermissions,function(t){return t.roleId===e.id&&t.permissionId===u});else{var t={pageModuleId:l.pageModule.id,roleId:e.id,permissionId:u};l.pageModule.modulePermissions.push(t)}},l.changeEditPermission=function(e){if(e.id!==p)if(m(e))l.pageModule.modulePermissions=_.reject(l.pageModule.modulePermissions,function(t){return t.roleId===e.id&&t.permissionId===d});else{var t={pageModuleId:l.pageModule.id,roleId:e.id,permissionId:d};l.pageModule.modulePermissions.push(t)}},l.save=function(){var e={id:l.pageModule.id,pageId:l.pageModule.pageId,inheritViewPermissions:l.inheritViewPermissions,inheritEditPermissions:l.inheritEditPermissions,modulePermissions:l.pageModule.modulePermissions};s.putPermission(e).then(function(e){console.log(e),n.dismiss("cancel")},function(e){v("error",SYS_ERROR_MSG)})},l.cancel=function(){n.dismiss("cancel")},a.get().then(function(e){l.roles=e},function(e){v("error","Cannot get all roles, please contact administrator")}),s.get(f.id).then(function(e){l.pageModule=e,l.inheritViewPermissions=l.pageModule.inheritViewPermissions,l.inheritEditPermissions=l.pageModule.inheritEditPermissions},function(e){v("error","Cannot get all roles, please contact administrator")})}]),e.controller("ContentPermissionCtrl",["$scope","$timeout","$uibModalInstance","$q","devUtil","globals","roleService","pageContentService","pageContent",function(e,t,n,o,r,i,a,s,c){var l=this,u=i.appSettings.permissions.contentView,d=i.appSettings.permissions.contentEdit,p=i.appSettings.roles.administrator,f=c;function g(e){if(l.pageContent){var t=_.find(l.pageContent.contentPermissions,function(t){return t.roleId===e.id&&t.permissionId===u});return t}return!1}function m(e){if(l.pageContent){var t=_.find(l.pageContent.contentPermissions,function(t){return t.roleId===e.id&&t.permissionId===d});return t}return!1}function v(e,n){l.message={messageType:e,content:n},t(function(){l.message={messageType:"",content:""}},i.appSettings.alertLifeTime)}l.label={title:"Content Permission",tableRowTitleView:"View Content",tableRowTitleEdit:"Edit Content"},l.administratorRoleId=p,l.isView=g,l.isEdit=m,l.changeViewPermission=function(e){if(e.id!==p)if(g(e))l.pageContent.contentPermissions=_.reject(l.pageContent.contentPermissions,function(t){return t.roleId===e.id&&t.permissionId===u});else{var t={pageContentId:l.pageContent.id,roleId:e.id,permissionId:u};l.pageContent.contentPermissions.push(t)}},l.changeEditPermission=function(e){if(e.id!==p)if(m(e))l.pageContent.contentPermissions=_.reject(l.pageContent.contentPermissions,function(t){return t.roleId===e.id&&t.permissionId===d});else{var t={pageContentId:l.pageContent.id,roleId:e.id,permissionId:d};l.pageContent.contentPermissions.push(t)}},l.save=function(){var e={id:l.pageContent.id,pageId:l.pageContent.pageId,inheritViewPermissions:l.inheritViewPermissions,inheritEditPermissions:l.inheritEditPermissions,contentPermissions:l.pageContent.contentPermissions};s.putPermission(e).then(function(e){console.log(e),n.dismiss("cancel")},function(e){v("error",SYS_ERROR_MSG)})},l.cancel=function(){n.dismiss("cancel")},a.get().then(function(e){l.roles=e},function(e){v("error","Cannot get all roles, please contact administrator")}),s.get(f.id).then(function(e){l.pageContent=e,l.inheritViewPermissions=l.pageContent.inheritViewPermissions,l.inheritEditPermissions=l.pageContent.inheritEditPermissions},function(e){v("error","Cannot get all roles, please contact administrator")})}])}(),function(){angular.module("deviserLayout",["ui.router","ui.bootstrap","dndLists","dev.modal","dev.sdlib","deviser.services","deviser.config"]).controller("LayoutCtrl",["$scope","$timeout","$filter","$q","globals","devUtil","editLayoutUtil","layoutService","pageService","layoutTypeService","pageContentService","moduleService","pageModuleService","modalService",function(e,t,n,o,r,i,a,s,c,l,u,d,p,f){var g=this;function m(){var e=o.defer();return s.get().then(function(t){console.log(t),t=_.filter(t,{isDeleted:!1}),_.forEach(t,function(e){e&&!e.placeHolders&&(e.placeHolders=[])}),g.layouts=t,e.resolve("data received!")},function(t){T("error",SYS_ERROR_MSG),e.reject(SYS_ERROR_MSG)}),e.promise}function v(){g.pageLayout={},g.pageLayout.id=void 0,g.pageLayout.name="",g.pageLayout.isChanged=!1,g.isLayoutEdit=!0,g.pageLayout.placeHolders=[]}function h(e){g.pageLayout=e,g.pageLayout.isChanged=!0,S(g.pageLayout.placeHolders)}function S(e,t){e&&_.forEach(e,function(e,n){console.log(e);var o=_.find(g.layoutTypes,{layoutTypeId:e.layoutTypeId});o&&(e.label=o.label),t&&e.properties?_.forEach(e.properties,function(e,t){e.optionList=null}):(y(e),e.id===g.selectedItem.id&&(g.selectedItem=e)),e.sortOrder=n+1,e.placeHolders&&S(e.placeHolders,t)})}function y(e){var t=e.properties,n=_.find(g.layoutTypes,{layoutTypeId:e.layoutTypeId}),o=n.properties;_.forEach(o,function(n){if(n){var o=_.find(t,{id:n.id});o?(o.label=n.label,o.description=n.description,o.defaultValue=n.defaultValue,o.optionList=n.optionList,o.optionListId=n.optionListId):e.properties.push(angular.copy(n))}})}function T(e,n){g.message={messageType:e,content:n},t(function(){g.message={messageType:"",content:""}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,g.alerts=[],g.pageLayout={},g.selectedItem={},g.deletedElements=[],g.layoutAllowedTypes=["9341f92e-83d8-4afe-ad4a-a95deeda9ae3","5a0a5884-da84-4922-a02f-5828b55d5c92"],g.newGuid=i.getGuid,g.dragoverCallback=function(e,t,n){return console.log(n),t>0},g.dropCallback=function(e,t,n){return n},g.logListEvent=function(e,t,n,o,r){var i=o?"External ":"";i+=r+" element is "+e+" position "+n,g.logEvent(i,t)},g.logEvent=function(e,t){console.log(e,"(triggered by the following",t.type,"event)"),console.log(t)},g.newLayout=v,g.selectLayout=h,g.copyLayout=function(){g.pageLayout.id=void 0,g.pageLayout.name="",g.pageLayout.isChanged=!0},g.saveLayout=function(){S(g.pageLayout.placeHolders,!0),g.pageLayout.pageId=pageContext.currentPageId,g.pageLayout.id?s.put(g.pageLayout).then(function(e){g.pageLayout.id=e.id,g.pageLayout.placeHolders=e.placeHolders,g.pageLayout.isChanged=!1,T("success","Layout has been saved"),S(g.pageLayout.placeHolders),g.isLayoutEdit=!1},function(e){T("error",SYS_ERROR_MSG)}):s.post(g.pageLayout).then(function(e){console.log(e),g.pageLayout.id=e.id,g.pageLayout.placeHolders=e.placeHolders,g.pageLayout.isChanged=!1,T("success","Layout has been saved"),m().then(function(){S(g.pageLayout.placeHolders)}),g.isLayoutEdit=!1},function(e){T("error",SYS_ERROR_MSG)})},g.deleteLayout=function(){f.showConfirmation({title:"Delete Confirmation",body:"Are you sure to delete the layout",okLabel:"Yes",cancelLabel:"No"}).then(function(){s.remove(g.pageLayout.id).then(function(e){console.log("Layout deletion agreed at:"+new Date),T("success","Layout has been removed"),m(),v()},function(e){T("error",SYS_ERROR_MSG)})},function(){console.log("Layout deletion disagreed at:"+new Date)})},g.selectItem=function(e){var t=e.properties;y(e);var n=a.getColumnWidthProperty(t);if(n&&!n.value){var o=_.find(n.optionList.list,{name:a.const.defaultWidth});n.value=o.id}g.selectedItem=e},g.itemMoved=function(e,t){e.splice(t,1)},g.deleteElement=function(e,t,n){return n},g.setColumnWidth=a.setColumnWidth,o.all([(L=o.defer(),c.get(pageContext.currentPageId).then(function(e){g.currentPage=e,L.resolve("data received!")},function(e){T("error",SYS_ERROR_MSG),L.reject(SYS_ERROR_MSG)}),L.promise),m(),(I=o.defer(),l.get().then(function(e){g.layoutTypes=e,I.resolve("data received!")},function(e){T("error",SYS_ERROR_MSG),I.reject(SYS_ERROR_MSG)}),I.promise)]).then(function(){if(function(e){e&&_.forEach(e,function(e){e.layoutTypeId=e.id,e.id=i.getGuid(),e.placeHolders=[],e.layoutTypeIds=e.layoutTypeIds.replace(/\s+/g,""),e.allowedTypes=e.layoutTypeIds?e.layoutTypeIds.split(","):"",e.type=e.name,"column"===e.type?e.layoutTemplate="column":"container"===e.type?e.layoutTemplate="container":"row"===e.type?e.layoutTemplate="row":e.layoutTemplate="repeater"})}(g.layoutTypes),g.currentPage.layoutId){var e=_.find(g.layouts,function(e){return e.id===g.currentPage.layoutId});e?h(e):v()}});var I;var L}])}(),function(){var e=angular.module("dev.sdlib",["ngSanitize"]);e.directive("devEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ictEnter)}),t.preventDefault())})}}),e.directive("devNumberOnly",function(){return{require:"ngModel",link:function(e,t,n,o){o.$parsers.push(function(e){if(void 0==e)return"";var t=e.replace(/[^0-9]/g,"");return t!=e&&(o.$setViewValue(t),o.$render()),t})}}}),e.directive("devAlphabetsOnly",function(){return{require:"ngModel",link:function(e,t,n,o){o.$parsers.push(function(e){return void 0==e?"":((t=(t=e.replace(/\s+/g,"_")).replace(/[^_a-zA-Z]/g,""))!=e&&(o.$setViewValue(t),o.$render()),t);var t})}}}),e.directive("devEdit",["$compile","$templateCache",function(e,t){return{restrict:"A",controller:function(e,t){var n=this,o=e;n.content||(n.content="Please enter the content");n.edit=function(){n.isEditMode=!n.isEditMode},n.save=function(){n.content&&o.sdVM.contentId&&o.sdVM.containerId&&o.sdVM.onSave()(n.content,o.sdVM.contentId,o.sdVM.containerId),n.cancel()},n.cancel=function(){n.isEditMode=!n.isEditMode},e.$watch(function(){return o.sdVM.ngModel},function(e){console.log("Changed to "+e),function(){if(o.sdVM.ngModel&&o.sdVM.contentId){var e=_.find(o.sdVM.ngModel,function(e){return e.id===o.sdVM.contentId});e&&(n.content=e)}}()})},controllerAs:"sdVM",bindToController:!0,link:function(n,o,r,i,a,s){var c="edit_"+r.contentType;template=t.get(c),o.html(template),e(o.contents())(n)},scope:{contentId:"@",containerId:"@",contentType:"@",ngModel:"=",onSave:"&"}}}]),e.directive("contenteditable",["$sce",function(e){return{restrict:"A",require:"?ngModel",link:function(t,n,o,r){function i(){var e=n.html();o.stripBr&&"<br>"==e&&(e=""),r.$setViewValue(e)}r&&(r.$render=function(){n.html(e.getTrustedHtml(r.$viewValue||""))},n.on("blur keyup change",function(){t.$evalAsync(i)}),i())}}}]),e.factory("devUtil",[function(){return{getGuid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},isGuid:function(e){return/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(e)}}}]),e.factory("editLayoutUtil",[function(){var e="col-md-4";return{const:{defaultWidth:e},setColumnWidth:function(n){var o,r=t(n);if(r&&r.value){var i=_.find(r.optionList.list,{id:r.value});o=i.name}else o=e;return o},getColumnWidthProperty:t};function t(e){return _.find(e,{name:"column_width"})}}]),e.factory("dateConverter",["dateFilter",function(e){return{parseResponse:function(e){return function e(t){_.forEach(t,function(n,o){t.hasOwnProperty(o)&&(moment(t[o],moment.ISO_8601,!0).isValid()&&(t[o]=moment(t[o]).toDate()),angular.isArray(t[o])&&t[o].length>0&&_.forEach(t[o],function(t){e(t)}))})}(e),e},prepareRequest:function(e){var t;return function e(t){_.forEach(t,function(n,o){t.hasOwnProperty(o)&&(angular.isDate(t[o])&&(t[o]=moment(t[o]).format()),angular.isArray(t[o])&&t[o].length>0&&_.forEach(t[o],function(t){e(t)}))})}(t=angular.copy(e)),t}}}]),e.filter("notInArray",["$filter",function(e){return function(t,n,o){return n?e("filter")(t,function(e){for(var t=0;t<n.length;t++)if(n[t][o]==e[o])return!1;return!0}):t}}])}(),function(){var e=angular.module("deviser.services",["deviser.config"]);function t(e,t,r,i){var a={get:function(r){var i=s;r&&(i=s+"/"+r);return e({method:"GET",url:i}).then(o,function(e){return n(e,t)})},put:function(r,i){var a=s;i&&(a=s+"/"+i);return e({method:"PUT",url:a,data:angular.toJson(r)}).then(o,function(e){return n(e,t)})},post:function(r){return e({method:"POST",url:s,data:angular.toJson(r)}).then(o,function(e){return n(e,t)})},remove:function(r){{var i=e({method:"DELETE",url:s+"/"+r})}return i.then(o,function(e){return n(e,t)})}},s=r.appSettings.serviceBaseUrl+i;return a}function n(e,t){return angular.isObject(e.data)&&e.data?t.reject(e.data):t.reject("An unknown error occurred.")}function o(e){return e.data}e.factory("layoutService",["$http","$q","globals",function(e,r,i){var a="/layout",s=t(e,r,i,a);return s.getDeletedLayouts=function(){var t=i.appSettings.serviceBaseUrl+a+"/deletedlist";return e({method:"GET",url:t}).then(o,function(e){return n(e,r)})},s.restoreLayout=function(t){var s=i.appSettings.serviceBaseUrl+a+"/"+t.id;return e({method:"PUT",url:s,data:angular.toJson(t)}).then(o,function(e){return n(e,r)})},s}]),e.factory("applicationService",["$http","$q","globals",function(e,t,r){var i="/application";return{restart:function(){var a=r.appSettings.serviceBaseUrl+i+"/restart";return e({method:"GET",url:a}).then(o,function(e){return n(e,t)})}}}]),e.factory("pageService",["$http","$q","globals",function(e,r,i){var a="/page",s=t(e,r,i,a);return s.getPages=function(){var t=i.appSettings.serviceBaseUrl+a+"/list";return e({method:"GET",url:t}).then(o,function(e){return n(e,r)})},s.getDeletedPages=function(){var t=i.appSettings.serviceBaseUrl+a+"/deletedlist";return e({method:"GET",url:t}).then(o,function(e){return n(e,r)})},s.restorePage=function(t){var s=i.appSettings.serviceBaseUrl+a+"/restore/"+t;return e({method:"PUT",url:s}).then(o,function(e){return n(e,r)})},s.deletePage=function(t){var s=i.appSettings.serviceBaseUrl+a+"/delete/"+t;return e({method:"DELETE",url:s}).then(o,function(e){return n(e,r)})},s.draftPage=function(t){var s=i.appSettings.serviceBaseUrl+a+"/draft/"+t;return e({method:"POST",url:s}).then(o,function(e){return n(e,r)})},s.publishPage=function(t){var s=i.appSettings.serviceBaseUrl+a+"/publish/"+t;return e({method:"POST",url:s}).then(o,function(e){return n(e,r)})},s}]),e.factory("contentTypeService",["$http","$q","globals",function(e,n,o){return t(e,n,o,"/contenttype")}]),e.factory("layoutTypeService",["$http","$q","globals",function(e,n,o){return t(e,n,o,"/layouttype")}]),e.factory("propertyService",["$http","$q","globals",function(e,n,o){return t(e,n,o,"/property")}]),e.factory("optionListService",["$http","$q","globals",function(e,n,o){return t(e,n,o,"/optionlist")}]),e.factory("siteSettingService",["$http","$q","globals",function(e,n,o){return t(e,n,o,"/sitesetting")}]),e.factory("pageContentService",["$http","$q","globals",function(e,r,i){var a=t(e,r,i,"/pagecontent"),s=i.appSettings.serviceBaseUrl+"/pagecontent";return a.get=function(){var t=s;if(arguments[0]&&arguments[1]){var i=arguments[1],a=arguments[0];t=s+"/"+i+"/"+a}else if(arguments[0]){var c=arguments[0];t=s+"/"+c}return e({method:"GET",url:t}).then(o,function(e){return n(e,r)})},a.getDeletedPageContents=function(){return e({method:"GET",url:s+"/list"}).then(o,function(e){return n(e,r)})},a.putContents=function(t){return e({method:"PUT",url:s+"/list",data:angular.toJson(t)}).then(o,function(e){return n(e,r)})},a.putPermission=function(t){return e({method:"PUT",url:s+"/permission",data:angular.toJson(t)}).then(o,function(e){return n(e,r)})},a.restorePageContent=function(t){return e({method:"PUT",url:s+"/restore/"+t}).then(o,function(e){return n(e,r)})},a.deletePageContent=function(t){return e({method:"DELETE",url:s+"/delete/"+t}).then(o,function(e){return n(e,r)})},a}]),e.factory("contentTranslationService",["$http","$q","globals",function(e,r,i){var a="/contenttranslation",s=t(e,r,i,a),c=i.appSettings.serviceBaseUrl+a;return s.get=function(){var t=c;if(arguments[0]&&arguments[1]){var i=arguments[1],a=arguments[0];t=c+"/"+i+"/"+a}else if(arguments[0]){var s=arguments[0];t=c+"/"+s}return e({method:"GET",url:t}).then(o,function(e){return n(e,r)})},s}]),e.factory("moduleService",["$http","$q","globals",function(e,r,i){var a="/module",s=t(e,r,i,"/module");return s.getModuleActionTypes=function(){var t=i.appSettings.serviceBaseUrl+a+"/moduleactiontype";return e({method:"GET",url:t}).then(o,function(e){return n(e,r)})},s}]),e.factory("moduleActionService",["$http","$q","globals",function(e,r,i){var a="/moduleaction",s=t(e,r,i,a);return s.getEditActions=function(t){var s=i.appSettings.serviceBaseUrl+a+"/edit/"+t;return e({method:"GET",url:s}).then(o,function(e){return n(e,r)})},s.getEditActionView=function(t,i,a){return e({method:"GET",url:"/page/editmodule/pageModuleId/"+i+"/moduleActionId/"+a+"?currentLink="+t}).then(o,function(e){return n(e,r)})},s}]),e.factory("pageModuleService",["$http","$q","globals",function(e,r,i){var a=i.appSettings.serviceBaseUrl+"/pagemodule",s=t(e,r,i,"/pagemodule");return s.getByPage=function(t){return e({method:"GET",url:a+"/page/"+t}).then(o,function(e){return n(e,r)})},s.getDeletedPageModules=function(){return e({method:"GET",url:a+"/list"}).then(o,function(e){return n(e,r)})},s.post=null,s.putModules=function(t){return e({method:"PUT",url:a+"/list",data:angular.toJson(t)}).then(o,function(e){return n(e,r)})},s.putPermission=function(t){return e({method:"PUT",url:a+"/permission",data:angular.toJson(t)}).then(o,function(e){return n(e,r)})},s.restorePageModule=function(t){return e({method:"PUT",url:a+"/restore/"+t}).then(o,function(e){return n(e,r)})},s.deletePageModule=function(t){return e({method:"DELETE",url:a+"/delete/"+t}).then(o,function(e){return n(e,r)})},s}]),e.factory("themeService",["$http","$q","globals",function(e,n,o){return t(e,n,o,"/theme")}]),e.factory("userService",["$http","$q","globals",function(e,n,o){return t(e,n,o,"/user")}]),e.factory("userExistService",["$http","$q","globals",function(e,n,o){return t(e,n,o,"/user/isexist")}]),e.factory("passwordResetService",["$http","$q","globals",function(e,n,o){return t(e,n,o,"/user/passwordreset")}]),e.factory("roleService",["$http","$q","globals",function(e,n,o){return t(e,n,o,"/role")}]),e.factory("userRoleService",["$http","$q","globals",function(e,r,i){var a=t(e,r,i,"/user/role"),s=i.appSettings.serviceBaseUrl+"/user/role";return a.remove=function(t,i){var a=e({method:"DELETE",url:s+"/"+t+"/"+i});return a.then(o,function(e){return n(e,r)})},a}]),e.factory("languageService",["$http","$q","globals",function(e,r,i){var a=i.appSettings.serviceBaseUrl+"/language",s=t(e,r,i,"/language");return s.getSiteLanguages=function(){return e({method:"GET",url:a+"/site"}).then(o,function(e){return n(e,r)})},s}]),e.factory("fileService",["$http","$q","globals",function(e,n,o){return t(e,n,o,"/file")}]),e.factory("assetService",["$http","$q","globals",function(e,n,o){return t(e,n,o,"/upload/images")}]),e.factory("conatctFormService",["$http","$q","globals",function(e,n,o){return t(e,n,o,"/contactform")}])}(),function(){var e=angular.module("dev.modal",["ui.bootstrap"]);e.factory("modalService",["$q","$uibModal",function(e,t){var n={};return n.showConfirmation=function(n){return e.defer(),t.open({animation:!0,backdrop:"static",templateUrl:"app/components/confirmdialog.tpl.html",controller:"ModalInstanceCtrl as mVM",resolve:{labels:function(){return n}}}).result},n}]),e.controller("ModalInstanceCtrl",["$uibModalInstance","$scope","labels",function(e,t,n){this.labels=n,this.ok=function(){e.close("ok")},this.cancel=function(){e.dismiss("cancel")}}])}(),function(){var e=angular.module("modules.app.imageManager",["ui.router","ui.bootstrap","ui.sortable","ui.select","deviser.services","ngFileUpload","angular-img-cropper"]);function t(e){var t=$(".focuspoint.preview"),n=$(".focuspoint");t.data("focusX",e.x),t.data("focusY",e.y),t.data("imageW",e.w),t.data("imageH",e.h),n.focusPoint()}e.directive("devImageManager",["$compile","$templateCache","assetService",function(e,n,o){return{restrict:"A",controller:["$scope","$uibModal",function(e,n){var o=this,r={};o.showPopup=function(){n.open({templateUrl:"app/components/imageManagerPopup.tpl.html",controller:"ImageManagerPopup as imVM",size:"sm",openedClass:"image-manager-modal",resolve:{selectedImage:function(){return{src:o.src,alt:o.alt,focusPoint:o.focusPoint,imageCropSize:r}}}}).result.then(function(e){o.src=e.imageSource,o.alt=e.imageAlt,o.focusPoint=e.focusPoint},function(e){console.log(e)})},o.removeImage=function(){o.src=null,o.alt=null,o.focusPoint=null},function(){var e=o.properties();if(e){var n=_.find(e,{name:"image_width"}),i=_.find(e,{name:"image_height"});r.width=n&&n.value?n.value:n.defaultValue,r.height=i&&i.value?i.value:i.defaultValue}o.focusPoint&&t(o.focusPoint)}(),e.$watch(function(){return o.focusPoint},function(){o.focusPoint&&t(o.focusPoint)})}],controllerAs:"locVM",bindToController:!0,link:function(t,o,r){template=n.get("app/components/imageManager.tpl.html"),o.html(template),e(o.contents())(t)},scope:{src:"=",alt:"=",focusPoint:"=",properties:"&",label:"@"}}}]),e.controller("ImageManagerPopup",["$scope","$uibModalInstance","$timeout","Upload","assetService","selectedImage",function(e,n,o,r,i,a){var s=this,c=a.imageCropSize;function l(){i.get().then(function(e){_.forEach(e,function(e){e.path+="?"+100*Math.random()}),s.images=e}),s.focusPointAttr={x:0,y:0,w:0,h:0},s.selectedTab="PREVIEW",s.imageSource&&(f(s.imageSource),s.imageSource=s.imageSource.split("?")[0],s.selectedImage={name:s.imageSource.split("/").pop()}),s.cropWidth=c&&c.width||300,s.cropHeight=c&&c.height||200}function u(e,t,n,o){l(),console.log(e),s.imageSource=e.data[0],s.imageSource+="?"+100*Math.random(),g("success","File uploaded successfully!")}function d(e){console.log(e),409==e.status?(l(),g("error","File already exists! if you want to replace this file, please check 'Replace Image'."),s.imageSource=e.data.filePath):g("error","Server error has been occured: "+e.data.ExceptionMessage)}function p(e){console.log("percent: "+parseInt(100*e.loaded/e.total,10))}function f(e){$("<img/>").attr("src",e).load(function(){s.focusPointAttr.w=this.width,s.focusPointAttr.h=this.height})}function g(e,t){s.message={messageType:e,content:t},o(function(){s.message={}},5e3)}s.imageSource=a.src,s.imageAlt=a.alt,s.focusPoint=a.focusPoint,s.focusPointAttr={},s.selectImage=function(e){s.selectedImage=e,s.imageSource=e.path,s.selectedTab="PREVIEW",f(s.imageSource)},s.yes=function(){n.close({imageSource:s.imageSource,imageAlt:s.imageAlt,focusPoint:s.focusPoint})},s.no=function(){n.dismiss("cancel")},s.isActive=function(e){if(e&&e.path){var t=e.path.split("?")[0],n=s.imageSource.split("?")[0];return n===t}return!1},s.onFileSelect=function(e){if(e){var t=r.upload({url:"/api/upload/images",method:"POST",data:{files:e},fileFormDataName:"files"});t.then(u,d,p)}},s.cropImage=function(){var e=r.dataUrltoBlob(s.croppedImage);e.name=s.selectedImage.name,r.upload({url:"/api/upload/images",method:"POST",file:e}).then(u,d,p)},s.focusImage=function(e){var n=$(e.target),o=n.width(),r=n.height(),i=e.pageX-n.offset().left,a=e.pageY-n.offset().top,c=2*(i/o-.5),l=-2*(a/r-.5);s.focusPointAttr.x=c.toFixed(2),s.focusPointAttr.y=l.toFixed(2),s.focusPoint=s.focusPointAttr;var u=i/o*100,d=a/r*100;t(s.focusPoint),$(".reticle").css({top:d+"%",left:u+"%"})},l()}])}(),function(){angular.module("modules.app.languageSelector",["ui.router","ui.bootstrap","ui.sortable","ui.select","deviser.services","ngFileUpload","angular-img-cropper"]).directive("devLanguageSelector",["$compile","$templateCache","assetService",function(e,t,n){return{restrict:"A",controller:["$scope","$uibModal","languageService",function(e,t,n){var o=this;o.changeLocalLanguage=function(){console.log(o),o.changeLanguage()},n.getSiteLanguages().then(function(e){o.languages=e},function(e){showMessage("error","Cannot get all languages, please contact administrator")})}],controllerAs:"locVM",bindToController:!0,link:function(n,o,r){template=t.get("app/components/languageSelector.tpl.html"),o.html(template),e(o.contents())(n)},scope:{selectedLocale:"=",changeLanguage:"&",label:"@"}}}])}(),function(){angular.module("modules.app.linkSelector",["ui.router","ui.bootstrap","ui.sortable","ui.select","deviser.services","ngFileUpload","angular-img-cropper"]).directive("devLinkSelector",["$compile","$templateCache","assetService",function(e,t,n){return{restrict:"A",controller:["$scope","$uibModal","pageService",function(e,t,n){var o=this,r=function(e,t){t?""===t&&(t="--"):t="";if(0!=e.pageLevel){var n=_.find(e.pageTranslation,{locale:"en-US"});e.pageName=t+n.name,o.pages.push(e)}e.childPage&&e.childPage.length>0&&_.each(e.childPage,function(e){r(e,t+"--")})};o.pages=[],function(){n.get().then(function(e){o.nestedPages=e,o.pages=[],r(o.nestedPages)}),o.selectedLink||(o.selectedLink={});o.selectedLink.linkType||(o.selectedLink.linkType="PAGE")}()}],controllerAs:"locVM",bindToController:!0,link:function(n,o,r){template=t.get("app/components/linkSelector.tpl.html"),o.html(template),e(o.contents())(n)},scope:{selectedLink:"=",properties:"&",label:"@"}}}])}(),function(){angular.module("deviser.contentTypes",["ui.router","ui.bootstrap","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("ContentTypesCtrl",["$scope","$timeout","$filter","$q","globals","devUtil","contentTypeService","propertyService",function(e,t,n,o,r,i,a,s){var c=this;function l(){a.get().then(function(e){c.contentTypes=e},function(e){f("error","Cannot get all content types, please contact administrator")}),d()}function u(){var e=_.find(c.selectedContentType.properties,{id:c.selectedProperty.id});return e}function d(){s.get().then(function(e){c.properties=e},function(e){f("error","Cannot get all properties, please contact administrator")})}function p(e){a.put(e).then(function(e){console.log(e),l(),f("success","Content Type has been updated"),c.currentViewState=c.viewStates.LIST},function(e){f("error","Cannot update content type, please contact administrator")})}function f(e,n){c.message={messageType:e,content:n},t(function(){c.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,c.alerts=[],c.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},c.currentViewState=c.viewStates.LIST,c.newContent=function(){c.currentViewState=c.viewStates.NEW,c.selectedContentType={}},c.edit=function(e){c.currentViewState=c.viewStates.EDIT,c.selectedContentType=e},c.isValidName=function(e){return!_.find(c.contentTypes,{name:e})},c.save=function(){e.contentTypeForm.submitted=!0,e.contentTypeForm.$valid&&(c.currentViewState==c.viewStates.NEW&&c.isValidName(c.selectedContentType.name)?a.post(c.selectedContentType).then(function(e){console.log(e),c.currentViewState=c.viewStates.LIST,c.selectedContentType={},l(),f("success","New content type has been added")},function(e){f("error","Cannot add content type, please contact administrator")}):p(c.selectedContentType))},c.activate=function(e){p(e)},c.cancel=function(){c.currentViewState=c.viewStates.LIST},c.hasError=function(e,t,n){if(e&&n)return e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n];return e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid},c.propertyTransform=function(e){var t=e.replace(/\s+/g,"");return{name:t=t.toLowerCase(),label:e}},c.addProperty=function(){u()||(c.selectedContentType.properties||(c.selectedContentType.properties=[]),c.selectedProperty.id?c.selectedContentType.properties.push(c.selectedProperty):s.post(c.selectedProperty).then(function(e){console.log(e),c.selectedProperty=e,c.selectedContentType.properties.push(c.selectedProperty),d(),f("success","New property has been added")},function(e){f("error","Cannot add new property, please contact administrator")}))},c.removeProperty=function(e){c.selectedContentType.properties=_.reject(c.selectedContentType.properties,function(t){return t.id===e.id})},c.isPropExist=u,l()}])}(),function(){angular.module("deviser.layoutTypes",["ui.router","ui.bootstrap","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("LayoutTypesCtrl",["$scope","$timeout","$filter","$q","globals","layoutTypeService","propertyService",function(e,t,n,o,r,i,a){var s=this;function c(){var e=_.find(s.selectedLayoutType.properties,{id:s.selectedProperty.id});return e}function l(){i.get().then(function(e){s.layoutTypes=e},function(e){p("error","Cannot get all layout types, please contact administrator")})}function u(){a.get().then(function(e){s.properties=e},function(e){p("error","Cannot get all properties, please contact administrator")})}function d(e){i.put(e).then(function(e){console.log(e),l(),p("success","Layout type has been updated"),s.currentViewState=s.viewStates.LIST},function(e){p("error","Cannot update layout type, please contact administrator")})}function p(e,n){s.message={messageType:e,content:n},t(function(){s.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,s.alerts=[],s.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},s.currentViewState=s.viewStates.LIST,s.newContentType=function(){s.currentViewState=s.viewStates.NEW,s.selectedLayoutType={}},s.edit=function(e){if(s.currentViewState=s.viewStates.EDIT,s.selectedLayoutType=e,s.selectedLayoutType.layoutTypeIds){var t=s.selectedLayoutType.layoutTypeIds.replace(/\s+/g,"").split(",");s.selectedLayoutType.allowedLayoutTypes=t}},s.isValidName=function(e){return!_.find(s.layoutTypes,{name:e})},s.save=function(){e.layoutForm.submitted=!0,e.layoutForm.$valid&&(s.currentViewState===s.viewStates.NEW&&s.isValidName(s.selectedLayoutType.name)?i.post(s.selectedLayoutType).then(function(e){console.log(e),s.currentViewState=s.viewStates.LIST,s.selectedLayoutType={},l(),p("success","New content type has been added")},function(e){p("error","Cannot add layout type, please contact administrator")}):(s.selectedLayoutType.layoutTypeIds=s.selectedLayoutType.allowedLayoutTypes.join(","),delete s.selectedLayoutType.allowedLayoutTypes,d(s.selectedLayoutType)))},s.activate=function(e){d(e)},s.cancel=function(){s.currentViewState=s.viewStates.LIST},s.hasError=function(e,t,n){if(e&&n)return e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n];return e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid},s.propertyTransform=function(e){var t=e.replace(/\s+/g,"");return{name:t=t.toLowerCase(),label:e}},s.addProperty=function(){c()||(s.selectedLayoutType.properties||(s.selectedLayoutType.properties=[]),s.selectedProperty.id?s.selectedLayoutType.properties.push(s.selectedProperty):a.post(s.selectedProperty).then(function(e){console.log(e),s.selectedProperty=e,s.selectedLayoutType.properties.push(s.selectedProperty),u(),p("success","New property has been added")},function(e){p("error","Cannot add new property, please contact administrator")}))},s.removeProperty=function(e){s.selectedLayoutType.properties=_.reject(s.selectedLayoutType.properties,function(t){return t.id===e.id})},s.isPropExist=c,l(),u()}])}(),function(){angular.module("deviser.optionList",["ui.router","ui.bootstrap","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("OptionListCtrl",["$scope","$timeout","$filter","$q","globals","devUtil","optionListService",function(e,t,n,o,r,i,a){var s=this;function c(){a.get().then(function(e){s.optionLists=e},function(e){u("error","Cannot get option lists, please contact administrator")})}function l(e){a.put(e).then(function(e){console.log(e),c(),u("success","Option list has been updated"),s.currentViewState=s.viewStates.LIST},function(e){u("error","Cannot update option list, please contact administrator")})}function u(e,n){s.message={messageType:e,content:n},t(function(){s.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,s.alerts=[],s.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},s.currentViewState=s.viewStates.LIST,s.newList=function(){s.currentViewState=s.viewStates.NEW,s.selectedOptionList={}},s.edit=function(e){s.currentViewState=s.viewStates.EDIT,s.selectedOptionList=e,s.selectedOptionList.items=[],s.selectedOptionList.list&&(s.selectedOptionList.items=s.selectedOptionList.list)},s.isValidName=function(e){return!_.find(s.optionLists,{name:e})},s.save=function(){e.optionListForm.submitted=!0,e.optionListForm.$valid&&(s.selectedOptionList.items&&(s.selectedOptionList.list=s.selectedOptionList.items),s.currentViewState==s.viewStates.NEW&&s.isValidName(s.selectedOptionList.name)?a.post(s.selectedOptionList).then(function(e){console.log(e),s.currentViewState=s.viewStates.LIST,s.selectedOptionList={},c(),u("success","New option list has been added")},function(e){u("error","Cannot add option list, please contact administrator")}):l(s.selectedOptionList))},s.activate=function(e){l(e)},s.cancel=function(){s.currentViewState=s.viewStates.LIST},s.hasError=function(e,t,n){if(e&&n)return e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n];return e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid},s.addListItem=function(){var e={id:i.getGuid(),name:"",label:""};s.selectedOptionList.items||(s.selectedOptionList.items=[]);s.selectedOptionList.items.push(e)},s.removeListItem=function(e){s.selectedOptionList.items=_.reject(s.selectedOptionList.items,function(t){return t.id===e.id})},c()}])}(),function(){angular.module("deviser.properties",["ui.router","ui.bootstrap","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("PropertiesCtrl",["$scope","$timeout","$filter","$q","globals","devUtil","propertyService","optionListService",function(e,t,n,o,r,i,a,s){var c=this;function l(){a.get().then(function(e){c.properties=e},function(e){d("error","Cannot get all properties, please contact administrator")})}function u(e){a.put(e).then(function(e){console.log(e),l(),d("success","Property has been updated"),c.currentViewState=c.viewStates.LIST},function(e){d("error","Cannot update layout type, please contact administrator")})}function d(e,n){c.message={messageType:e,content:n},t(function(){c.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,c.alerts=[],c.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},c.currentViewState=c.viewStates.LIST,c.newProperty=function(){c.currentViewState=c.viewStates.NEW,c.selectedProperty={}},c.edit=function(e){c.currentViewState=c.viewStates.EDIT,c.selectedProperty=e,c.selectedProperty.optionListId&&(c.selectedProperty.moreOption=!0)},c.isValidName=function(e){return!_.find(c.properties,{name:e})},c.save=function(){e.propertyForm.submitted=!0,e.propertyForm.$valid&&(c.selectedProperty.moreOption&&c.selectedProperty.optionList?c.selectedProperty.optionListId=c.selectedProperty.optionList.id:c.selectedProperty.optionListId=null,c.selectedProperty.optionList=null,c.currentViewState==c.viewStates.NEW&&c.isValidName(c.selectedProperty.name)?a.post(c.selectedProperty).then(function(e){console.log(e),c.currentViewState=c.viewStates.LIST,c.selectedProperty={},l(),d("success","New property has been added")},function(e){d("error","Cannot add new property, please contact administrator")}):u(c.selectedProperty))},c.activate=function(e){u(e)},c.cancel=function(){c.currentViewState=c.viewStates.LIST},c.hasError=function(e,t,n){if(e&&n)return e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n];return e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid},l(),s.get().then(function(e){c.optionLists=e},function(e){d("error","Cannot get option lists, please contact administrator")})}])}(),function(){angular.module("deviser.contact",["deviser.config","deviser.services"]).controller("ContactCtrl",["$scope","$timeout","$filter","$q","globals","conatctFormService",function(e,t,n,o,r,i){var a=this,s={};function c(e,n){a.message={messageType:e,content:n},t(function(){a.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,a.alerts=[],a.submit=function(){s.data=angular.toJson(a.form),s.pageModuleId=$("#ContactForm").closest(".dev-module-container").data("pageModuleId"),i.post(s).then(function(e){c("success","Your message have been successfully sent.")},function(e){c("error","Couldnt send your message, please try after sometime.")})},a.form={}}])}(),function(){angular.module("deviser.filemanger",["ui.router","ui.bootstrap","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("FileManagerCtrl",["$scope","$timeout","$filter","$q","globals","fileService",function(e,t,n,o,r,i){var a=this;function s(){i.get().then(function(e){a.files=e},function(e){!function(e,n){a.message={messageType:e,content:n},t(function(){a.message={}},r.appSettings.alertLifeTime)}("error","Cannot get all files and folders, please contact administrator")})}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,a.alerts=[],a.upload=function(){},s()}])}(),function(){angular.module("deviser.language",["ui.router","ui.bootstrap","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("LanguageCtrl",["$scope","$timeout","$filter","$q","globals","languageService",function(e,t,n,o,r,i){var a=this;function s(e){i.getSiteLanguages().then(function(t){a.siteLanguages=t;var n=_.filter(t,"isActive");if(e)if(console.log(pageContext),1==n.length){c("success","URLs has been updated based on active languages, this page will be reloaded automatically");var o=pageContext.currentUrl;_.forEach(a.siteLanguages,function(e){e=e.cultureCode.toLowerCase()+"/",_.startsWith(o,e)&&(o=_.replace(o,e,""))}),setTimeout(function(){window.location="/"+o},5e3)}else if(2==n.length){c("success","URLs has been updated based on active languages, this page will be reloaded automatically");var o=pageContext.currentUrl,r=pageContext.currentLocale.toLowerCase()+"/";_.startsWith(o,r)||(o=r+o),setTimeout(function(){window.location="/"+o},5e3)}},function(e){c("error","Cannot get site languages, please contact administrator")})}function c(e,n){a.message={messageType:e,content:n},t(function(){a.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,a.alerts=[],a.add=function(){a.currentViewState=a.viewStates.NEW},a.save=function(){i.post(a.selectedLanguage).then(function(e){console.log(e),a.currentViewState=a.viewStates.LIST,a.selectedLanguage={},s(),c("success","New language has been added")},function(e){c("error","Cannot add language, please contact administrator")})},a.activate=function(e){e.cultureCode!==pageContext.siteLanguage&&i.put(e).then(function(e){console.log(e),s(!0),c("success","Language has been updated")},function(e){c("error","Cannot update language, please contact administrator")})},a.cancel=function(){a.currentViewState=a.viewStates.LIST},a.viewStates={NEW:"NEW",LIST:"LIST"},a.currentViewState=a.viewStates.LIST,a.siteLanguage=pageContext.siteLanguage,i.get().then(function(e){a.languages=e},function(e){c("error","Cannot get all languages, please contact administrator")}),s()}])}(),function(){var e=angular.module("deviser.pageMangement",["ui.router","ui.bootstrap","ui.tree","ui.select","dev.modal","dev.sdlib","deviser.services","deviser.config"]);e.controller("PageManagementCtrl",["$scope","$timeout","$filter","$q","modalService","globals","pageService","themeService","languageService","roleService",function(e,t,n,o,r,i,a,s,c,l){var u=this,d=(i.appSettings.systemErrorMsg,i.appSettings.permissions.pageView),p=i.appSettings.permissions.pageEdit,f=i.appSettings.roles.administrator;u.alerts=[],u.pages=[],u.selectedItem={},u.liveTill={},u.liveFrom={},u.administratorRoleId=f,u.pageTypes=i.appSettings.pageTypes,u.reSortPages=function(e){e&&e.childPage&&_.forEach(e.childPage,function(e,t){e.pageOrder=t+1,u.reSortPages(e)})};var g=!1;function m(){a.get().then(function(e){u.pages=[],u.pages.push(e),function e(t){t&&(1==t.pageLevel&&(t.collapsed=!0),t.childPage?(t.childPage=_.sortBy(t.childPage,function(e){return e.pageOrder}),_.sortBy(t.childPage,function(t,n){e(t)})):t.childPage=[])}(u.pages[0])},function(e){y("error","Cannot load pages, please contact administrator")})}function v(e){u.currentLocale=u.siteLanguage,e.pageTranslation&&0!==e.pageTranslation.length||(e.pageTranslation=[{locale:u.currentLocale}]),u.selectedItem=e,u.accordion.common=!u.accordion.permissions,u.selectedItem.pagePermissions&&_.forEach(u.selectedItem.pagePermissions,function(e){e.isView=function(e){}})}function h(e,t){var n=_.find(e.pagePermissions,function(e){return e.roleId===t.id&&e.permissionId===d});return n}function S(e,t){var n=_.find(e.pagePermissions,function(e){return e.roleId===t.id&&e.permissionId===p});return n}function y(e,n){u.message={messageType:e,content:n},t(function(){u.message={}},i.appSettings.alertLifeTime)}u.options={accept:function(e,t,n){return t&&t.depth()>0},dropped:function(e){var t=e.source.nodeScope.page,n=e.dest.nodesScope.page;t&&n&&(t.parentId=n.id,t.pageLevel=e.dest.nodesScope.depth(),u.reSortPages(u.pages[0]),a.put(u.pages[0]).then(function(e){m(),y("success","All pages updated successfully")},function(e){y("error","'Cannot update all pages, please contact administrator")}))}},u.dateFormat="dd.MM.yyyy",u.openDatePicker=function(e,t){e.preventDefault(),e.stopPropagation(),t.opened=!0},u.dateOptions={formatYear:"yy",startingDay:1},u.disabledDatePicker=function(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())},e.$watch(function(){return u.pages},function(){u.isChanged=!0},!0),u.toggle=function(e){e.collapsed=!e.collapsed},u.selectPage=v,u.newSubPage=function(e){g=!0;var t={parentId:e.id,childPage:[],pageLevel:e.pageLevel+1,pageTypeId:u.pageTypes.standard.id,pageTranslation:[{locale:u.currentLocale,name:"",url:"",title:null,description:null,keywords:null}]};e.childPage||(e.childPage=[]);e.childPage.push(t),v(t)},u.changeLanguage=function(){if(!_.find(u.selectedItem.pageTranslation,{locale:u.currentLocale})){var e=_.find(u.selectedItem.pageTranslation,{locale:u.siteLanguage});(e=JSON.parse(angular.toJson(e))).locale=u.currentLocale,e.name="",e.title="",e.description="",e.keywords="",u.selectedItem.pageTranslation.push(e)}},u.save=function(){u.selectedItem&&e.managePage.$valid&&function(e){g?a.post(e).then(function(e){g=!1,u.selectedItem=e,m(),y("success","Page created successfully")},function(e){y("error","'Cannot create page, please contact administrator")}):a.put(e,e.id).then(function(e){u.selectedItem=e,m(),y("success","Page updated successfully")},function(e){y("error","'Cannot update page, please contact administrator")})}(u.selectedItem)},u.isView=h,u.isEdit=S,u.changeViewPermission=function(e,t){if(t.id!==f)if(h(e,t))e.pagePermissions=_.reject(e.pagePermissions,function(e){return e.roleId===t.id&&e.permissionId===d});else{var n={pageId:e.id,roleId:t.id,permissionId:d};e.pagePermissions.push(n)}},u.changeEditPermission=function(e,t){if(t.id!==f)if(S(e,t))e.pagePermissions=_.reject(e.pagePermissions,function(e){return e.roleId===t.id&&e.permissionId===p});else{var n={pageId:e.id,roleId:t.id,permissionId:p};e.pagePermissions.push(n)}},u.siteLanguage="en-US",u.openConfirmDialog=function(e){var t={title:"Delete Confirmation",body:"Are you sure to delete the "+e.pageTranslation[0].name+" page?",okLabel:"Yes",cancelLabel:"No"};r.showConfirmation(t).then(function(t){if(console.log("Modal agreed at: "+new Date),e){var n=e.id;a.remove(n).then(function(t){e.isDeleted=!0,y("success","Page has been removed")},function(e){y("error","'Cannot remove page, please contact administrator")})}},function(){console.log("Modal dismissed at: "+new Date)})},u.collapseAll=function(){e.$broadcast("angular-ui-tree:collapse-all")},u.currentLocale=pageContext.currentLocale,u.accordion={},m(),l.get().then(function(e){u.roles=e},function(e){y("error","Cannot get all roles, please contact administrator")}),s.get().then(function(e){u.themes=e},function(e){y("error","Cannot load theme, please contact administrator")}),c.getSiteLanguages().then(function(e){u.languages=e},function(e){y("error","Cannot get all languages, please contact administrator")})}]),e.filter("selectLanguage",function(){return function(e,t){return e&&t?_.filter(e,function(e){return e.locale===t}):e}})}(),function(){angular.module("deviser.module",["ui.router","ui.bootstrap","ui.tree","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("ModuleManagementCtrl",["$scope","$timeout","$filter","$q","globals","moduleService","moduleActionService","propertyService",function(e,t,n,o,r,i,a,s){var c=this;function l(){i.get().then(function(e){c.modules=e},function(e){f("error","Cannot get all modules, please contact administrator")})}function u(){s.get().then(function(e){c.properties=e},function(e){f("error","Cannot get all properties, please contact administrator")})}function d(e){i.put(e,e.id).then(function(e){console.log(e),l(),f("success","Modulehas been updated"),c.currentViewState=c.viewStates.LIST},function(e){f("error","Cannot update module, please contact administrator")})}function p(){var e=_.find(c.selectedModuleAction.properties,{id:c.selectedProperty.id});return e}function f(e,n){c.message={messageType:e,content:n},t(function(){c.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,c.alerts=[],c.add=function(){c.currentViewState=c.viewStates.NEW,c.selectedModule={}},c.edit=function(t){e.editModuleForm.submitted=!1,e.newModuleForm.submitted=!1,c.currentViewState=c.viewStates.EDIT,c.selectedModule=t},c.activate=function(e){d(e)},c.isValidName=function(e){return!_.find(c.modules,{name:e})},c.remove=function(e){i.remove(e.id).then(function(e){console.log(e),l(),c.currentViewState=c.viewStates.LIST,f("success","Module has been removed")},function(e){f("error","Cannot remove Module, please contact administrator")})},c.save=function(){e.newModuleForm.submitted=!0,e.newModuleForm.$valid&&(e.newModuleForm.submitted=!1,c.currentViewState==c.viewStates.NEW&&c.isValidName(c.selectedModule.name)?i.post(c.selectedModule).then(function(e){console.log(e),c.currentViewState=c.viewStates.LIST,c.selectedModule={},l(),f("success","New module has been added")},function(e){f("error","Cannot add module, please contact administrator")}):d(c.selectedModule))},c.cancel=function(){c.currentViewState=c.viewStates.LIST},c.addModuleActions=function(){c.currentViewState=c.viewStates.NEWMODULEACTION;var e={displayName:""};c.selectedModule.moduleAction||(c.selectedModule.moduleAction=[]);c.selectedModule.moduleAction.push(e),c.selectedModuleAction=e},c.editModuleActions=function(e){c.currentViewState=c.viewStates.EDITMODULEACTION,c.selectedModuleAction=e},c.removeModuleActions=function(e){var t=c.selectedModule.moduleAction.indexOf(e);c.selectedModule.moduleAction.splice(t,1)},c.saveModuleAction=function(){e.editModuleForm.submitted=!0,e.editModuleForm.$valid&&(e.editModuleForm.submitted=!1,c.currentViewState=c.viewStates.LISTMODULEACTION)},c.addProperty=function(){p()||(c.selectedModuleAction.properties||(c.selectedModuleAction.properties=[]),c.selectedProperty.id?c.selectedModuleAction.properties.push(c.selectedProperty):s.post(c.selectedProperty).then(function(e){console.log(e),c.selectedProperty=e,c.selectedModuleAction.properties.push(c.selectedProperty),u(),f("success","New property has been added")},function(e){f("error","Cannot add new property, please contact administrator")}))},c.isPropExist=p,c.removeProperty=function(e){c.selectedModuleAction.properties=_.reject(c.selectedModuleAction.properties,function(t){return t.id===e.id})},c.propertyTransform=function(e){var t=e.replace(/\s+/g,"");return{name:t=t.toLowerCase(),label:e}},c.viewStates={NEW:"NEW",LIST:"LIST",EDIT:"EDIT",NEWMODULEACTION:"NEWMODULEACTION",LISTMODULEACTION:"LISTMODULEACTION",EDITMODULEACTION:"EDITMODULEACTION"},c.currentViewState=c.viewStates.LIST,c.modules={},c.moduleActions={},l(),a.get().then(function(e){c.moduleActions=e},function(e){f("error","Cannot get all module actions, please contact administrator")}),i.getModuleActionTypes().then(function(e){c.moduleActionTypes=e},function(e){f("error","Cannot get all module action types, please contact administrator")}),u()}])}(),function(){angular.module("deviser.recycleBin",["ui.router","ui.bootstrap","ui.tree","dev.sdlib","deviser.services","deviser.config"]).controller("RecycleBinCtrl",["$scope","$timeout","$filter","$q","globals","pageService","layoutService","pageContentService","pageModuleService",function(e,t,n,o,r,i,a,s,c){var l=this;function u(){i.getDeletedPages().then(function(e){_.forEach(e,function(e){e.pageTranslation=_.find(e.pageTranslation,{locale:pageContext.siteLanguage})}),l.pages=e},function(e){g("error","Cannot get the pages, please contact administrator")})}function d(){a.getDeletedLayouts().then(function(e){l.layouts=e},function(e){g("error","Cannot get the layouts, please contact administrator")})}function p(){s.getDeletedPageContents().then(function(e){_.forEach(e,function(e){e.page.pageTranslation=_.find(e.page.pageTranslation,{locale:pageContext.siteLanguage})}),l.pageContents=e},function(e){g("error","Cannot get the page content elements, please contact administrator")})}function f(){c.getDeletedPageModules().then(function(e){_.forEach(e,function(e){e.page.pageTranslation=_.find(e.page.pageTranslation,{locale:pageContext.siteLanguage})}),l.pageModules=e},function(e){g("error","Cannot get the page modules, please contact administrator")})}function g(e,n){l.message={messageType:e,content:n},t(function(){l.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,l.alerts=[],l.restorePage=function(e){i.restorePage(e).then(function(e){!1===e.isDeleted&&u(),g("success","The page has been restored")},function(e){g("error","Cannot restore the page, please contact administrator")})},l.restorePageContent=function(e){s.restorePageContent(e).then(function(e){!1===e.isDeleted&&p(),g("success","The page content has been restored")},function(e){g("error","Cannot restore the page content, please contact administrator")})},l.restorePageModule=function(e){c.restorePageModule(e).then(function(e){!1===e.isDeleted&&f(),g("success","The page module has been restored")},function(e){g("error","Cannot restore the page module, please contact administrator")})},l.restoreLayout=function(e){a.restoreLayout(e).then(function(e){!1===e.isDeleted&&d(),g("success","The layout has been restored")},function(e){g("error","Cannot restore the layout, please contact administrator")})},l.deletePage=function(e){i.deletePage(e).then(function(e){u(),g("success","The page has been deleted")},function(e){g("error","Cannot delete the page, please contact administrator")})},l.deletePageContent=function(e){s.deletePageContent(e).then(function(e){p(),g("success","The page content has been deleted")},function(e){g("error","Cannot delete the page content, please contact administrator")})},l.deletePageModule=function(e){c.deletePageModule(e).then(function(e){f(),g("success","The page module has been deleted")},function(e){g("error","Cannot delete the page module, please contact administrator")})},l.deleteLayout=function(e){a.remove(e).then(function(e){d(),g("success","The layout has been deleted")},function(e){g("error","Cannot delete the layout, please contact administrator")})},u(),d(),p(),f()}])}(),function(){angular.module("deviser.securityRoles",["ui.router","ui.bootstrap","ui.tree","dev.sdlib","deviser.services","deviser.config"]).controller("SecurityRolesCtrl",["$scope","$timeout","$filter","$q","globals","roleService",function(e,t,n,o,r,i){var a=this;function s(){i.get().then(function(e){a.roles=e},function(e){c("error","Cannot get all roles, please contact administrator")})}function c(e,n){a.message={messageType:e,content:n},t(function(){a.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,a.alerts=[],a.add=function(){a.currentViewState=a.viewStates.NEW},a.edit=function(e){a.selectedRole=e,a.currentViewState=a.viewStates.EDIT},a.remove=function(e){i.remove(e.id).then(function(e){console.log(e),s(),a.currentViewState=a.viewStates.LIST,c("success","Role has been removed")},function(e){c("error","Cannot remove role, please contact administrator")})},a.save=function(){e.roleForm.submitted=!0,a.currentViewState==a.viewStates.EDIT?e.editRoleForm.$valid&&i.put(a.selectedRole).then(function(e){console.log(e),s(),a.currentViewState=a.viewStates.LIST,c("success","Role has been updated")},function(e){c("error","Cannot update role, please contact administrator")}):a.currentViewState==a.viewStates.NEW&&e.roleForm.$valid&&i.post(a.newRole).then(function(e){console.log(e),a.currentViewState=a.viewStates.LIST,a.newRole={},s(),c("success","New role has been created")},function(e){c("error","Cannot create role, please contact administrator")})},a.cancel=function(){a.currentViewState=a.viewStates.LIST},a.hasError=function(e,t,n){if(e&&n)return e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n];return e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid},a.viewStates={NEW:"NEW",LIST:"LIST",EDIT:"EDIT"},a.currentViewState=a.viewStates.LIST,s()}])}(),function(){angular.module("deviser.siteSettings",["ui.router","ui.bootstrap","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("SiteSettingsCtrl",["$scope","$timeout","$filter","$q","globals","devUtil","siteSettingService","pageService","layoutService","themeService","languageService","applicationService",function(e,t,n,o,r,i,a,s,c,l,u,d){var p=this;function f(){a.get().then(function(e){p.siteSettings=e,p.setting=_.keyBy(e,"settingName"),_.forEach(p.setting,function(e){e&&e.settingValue&&("true"===e.settingValue?e.settingValue=!0:"false"===e.settingValue&&(e.settingValue=!1))})},function(e){g("error","Cannot get all Site Settings, please contact administrator")})}function g(e,n){p.message={messageType:e,content:n},t(function(){p.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,p.alerts=[],p.update=function(){var e=_.values(p.setting);a.put(e).then(function(e){f(),g("success","Site Settings has been updated")},function(e){g("error","Cannot update site setting please contact administrator")})},p.restartApplication=function(){d.restart().then(function(e){location.reload()},function(e){g("error","Cannot update site setting please contact administrator")})},p.cancel=function(){f()},p.setting={},f(),s.getPages().then(function(e){p.pages=e,_.each(p.pages,function(e){var t=_.find(e.pageTranslation,{locale:"en-US"});e.pageName=t.name})}),c.get().then(function(e){p.layouts=e}),l.get().then(function(e){p.themes=e}),u.getSiteLanguages().then(function(e){p.languages=_.filter(e,{isActive:!0})},function(e){g("error","Cannot get all languages, please contact administrator")})}])}(),function(){angular.module("deviser.userManagement",["ui.router","ui.bootstrap","ui.tree","ui.select","ngSanitize","dev.sdlib","deviser.services","deviser.config"]).controller("UserManagementCtrl",["$scope","$timeout","$filter","$q","globals","userService","userExistService","passwordResetService","roleService","userRoleService",function(e,t,n,o,r,i,a,s,c,l){var u,d=this;function p(){i.get().then(function(e){d.users=e},function(e){g("error","Cannot get users, please contact administrator")})}function f(){d.selectedUser&&(d.roles=_.reject(u,function(e){return _.find(d.selectedUser.roles,{id:e.id})}))}function g(e,n){d.message={messageType:e,content:n},t(function(){d.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,d.alerts=[],d.add=function(){d.currentViewState=d.viewStates.NEW},d.edit=function(e){d.selectedUser=e,f(),d.currentViewState=d.viewStates.EDIT},d.remove=function(e){i.remove(e.id).then(function(e){console.log(e),p(),g("success","User has been removed")},function(e){g("error","Cannot remove the user, please contact administrator")})},d.save=function(){e.userForm.submitted=!0,d.currentViewState==d.viewStates.EDIT?e.editUserForm.$valid&&i.put(d.selectedUser).then(function(e){console.log(e),d.currentViewState=d.viewStates.LIST,g("success","Profile has been updated")},function(e){g("error","Cannot update user, please contact administrator")}):d.currentViewState==d.viewStates.NEW&&e.userForm.$valid&&!d.isUserExist&&i.post(d.newUser).then(function(e){console.log(e),d.currentViewState=d.viewStates.LIST,d.newUser={},p(),g("success","New user has been created")},function(e){if(e.errors){var t="";_.forEach(e.errors,function(e){t+=e.description}),g("error",t)}else g("error","Cannot update user, please contact administrator")})},d.cancel=function(){d.currentViewState=d.viewStates.LIST},d.checkUserExist=function(t){if(!e.userForm.email.$error.email&&t){var n={userName:t};a.post(n).then(function(e){d.isUserExist=e},function(e){g("error","Cannot check email address, please contact administrator")})}},d.resetPassword=function(){e.passwordResetForm.submitted=!0,e.passwordResetForm.$valid&&(d.passwordReset.userId=d.selectedUser.id,s.post(d.passwordReset).then(function(e){if(console.log(e),e&&!0===e.succeeded)d.currentViewState=d.viewStates.LIST,d.passwordReset={},p(),g("success","Password has been reset");else if(e.errors){var t="";_.forEach(e.errors,function(e){t+=e.description}),g("error",t)}else g("error","Cannot reset password, please contact administrator")},function(e){g("error","Cannot reset password, please contact administrator")}))},d.addRole=function(){var e={userId:d.selectedUser.id,roleName:d.selectedRole.name};l.post(e).then(function(e){d.selectedUser=e,f()},function(e){g("error","Cannot add role, please contact administrator")})},d.removeRole=function(e){var t={userId:d.selectedUser.id,roleName:e.name};l.remove(t.userId,t.roleName).then(function(e){d.selectedUser=e,f()},function(e){g("error","Cannot remove role, please contact administrator")})},d.hasError=function(e,t,n){if(e&&n)return e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n];return e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid},d.viewStates={NEW:"NEW",LIST:"LIST",EDIT:"EDIT"},d.isUserExist=!0,d.currentViewState=d.viewStates.LIST,p(),c.get().then(function(e){d.roles=u=e},function(e){g("error","Cannot get roles, please contact administrator")})}])}();