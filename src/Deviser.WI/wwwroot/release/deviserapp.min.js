!function(){var e=angular.module("deviser.config",[]);e.config(["globalsProvider",function(e){e.appSettings.serviceBaseUrl="/api",e.appSettings.systemErrorMsg="Unexpected error has been occured, Please contact system administrator"}]),e.provider("globals",function(){this.$get=function(){return{appSettings:e.appSettings}};var e=this;e.appSettings={serviceBaseUrl:"",systemErrorMsg:"",alertLifeTime:1e4,permissions:{pageView:"29cb1b57-1862-4300-b378-f3271b870148",pageEdit:"2da41181-be15-4ad6-a89c-3ba8b71f993b",moduleView:"34b46847-80be-4099-842a-b654ad550c3e",moduleEdit:"cc3dbe2d-1e4a-46a0-8c10-9e73f1f5c699",contentView:"491b37a3-deba-4f55-9df6-a67cdd810108",contentEdit:"461b37d9-b801-4235-b74f-0c51f35d170f"},roles:{administrator:"9b461499-c49e-4398-bfed-4364a176ebbd",allUsers:"086357bf-01b1-494c-a8b8-54fdfa7c4c9e"},pageTypes:{standard:{id:"4c06dcfd-214f-45af-8404-ff84b412ab01",name:"Standard"},Url:{id:"bfefa535-7af1-4ddc-82c0-c906c948367a",name:"URL"}}}})}(),function(a,s){function e(){s("body").on("submit","form.dev-form",t),s("body").on("click","a.dev-ajax-load",n)}function t(e){e.preventDefault();var r=s(this),t=r.attr("action"),n=r.serialize(),o=r.attr("method").toUpperCase();console.log(n);var i=s.ajax({type:o,url:t,data:n,headers:{IsAjaxRequest:!0}});i.done(function(e,t,n){if(console.log(e),"object"==typeof e)console.log(e),e.value&&302===e.statusCode&&(a.location=e.value);else{var o=r.closest(".dev-module-container");r.remove(),o.html(e)}}),i.fail(function(e,t){console.log(e+""+t)})}function n(e){e.preventDefault();var o=s(this),t=o.attr("href"),n=s.ajax({type:"GET",url:t,headers:{IsAjaxRequest:!0}});n.done(function(e,t,n){console.log(e),o.closest(".dev-module-container").html(e)}),n.fail(function(e,t){console.log(e+""+t)})}a.devFormHelper=e,s(function(){e()})}(window,$),function(){var e=angular.module("deviserEdit",["ui.router","ui.sortable","ui.bootstrap","ui.select","dndLists","textAngular","dev.sdlib","deviser.services","deviser.config","modules.app.imageManager","modules.app.languageSelector","modules.app.linkSelector"]);e.config(["$provide",function(e){e.decorator("taOptions",["taRegisterTool","$delegate",function(e,t){return t.toolbar=[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","indent","outdent"],["html","wordcount","charcount"]],t}])}]),e.directive("devContentPreview",["$compile","$templateCache",function(o,r){return{restrict:"A",controller:["$scope","$uibModal",function(e,t){var n=this;function o(){n.templateMode="PREVIEW",n.contentType=n.content.contentType,n.contentTranslations=n.content.pageContentTranslation;var e=pageContext.currentLocale,t=function(e){var t=_.find(n.contentTranslations,{cultureCode:e});t||(t={cultureCode:e,contentData:{}});return t}(e);n.contentTranslation=t,"string"==typeof n.contentTranslation.contentData&&(n.contentTranslation.contentData=JSON.parse(n.contentTranslation.contentData))}o(),e.$watch(function(){return n.content.pageContentTranslation},function(e,t){o()},!0)}],controllerAs:"ecVM",bindToController:!0,link:function(e,t,n){template=r.get("contenttypes/"+e.ecVM.content.contentType.name+".html"),t.html(template),o(t.contents())(e)},scope:{content:"="}}}]),e.controller("EditCtrl",["$scope","$timeout","$filter","$q","$uibModal","globals","devUtil","editLayoutUtil","layoutService","pageService","contentTypeService","layoutTypeService","pageContentService","moduleService","moduleActionService","pageModuleService",function(e,n,t,s,r,o,i,a,c,l,u,d,p,f,g,m){var v=this,h=[],S={};function y(){var n=[],o=[];T(S.placeHolders),v.pageLayout=S,v.pageLayout.pageId=v.currentPage.id;var e=_.reject(v.pageContents,function(e){return _.includes(h,e.containerId)}),t=_.reject(v.pageModules,function(e){return _.includes(h,e.containerId)});_.forEach(e,function(e){var t=I(e);t.isUnassigned=!0,n.push(t)}),_.forEach(t,function(e){e.sortOrder;var t=L(e);t.isUnassigned=!0,o.push(t)}),v.uaLayout.placeHolders=[],v.uaLayout.placeHolders=v.uaLayout.placeHolders.concat(n),v.uaLayout.placeHolders=v.uaLayout.placeHolders.concat(o)}function T(e){e&&_.forEach(e,function(n){h.push(n.id);var o,r,e,t,i=_.filter(v.pageContents,{containerId:n.id});i&&_.forEach(i,function(e){var t=I(e);t.title||(t.title=t.contentType.label+" "+(n.placeHolders.length+1)),n.placeHolders.push(t)}),"content"!==n.layoutTemplate&&"module"!==n.layoutTemplate&&(r=(o=o=n).properties,e=_.find(v.layoutTypes,{id:o.layoutTypeId}),t=e.properties,_.forEach(t,function(e){if(e){var t=_.find(r,{id:e.id});t?(t.label=e.label,t.description=e.description,t.defaultValue=e.defaultValue,t.optionList=e.optionList,t.optionListId=e.optionListId):o.properties.push(angular.copy(e))}}));var a=_.filter(v.pageModules,{containerId:n.id});a&&_.forEach(a,function(e){e.sortOrder;var t=L(e);t.title||(t.title=t.moduleAction.displayName+" "+(n.placeHolders.length+1)),n.placeHolders.push(t)}),n.placeHolders=_.sortBy(n.placeHolders,["sortOrder"]),n.placeHolders&&T(n.placeHolders)})}function I(t){var n=t.properties,e=_.find(v.contentTypes,function(e){return e.contentType.id===t.contentType.id}),o=angular.copy(e.properties);_.forEach(o,function(e){var t=_.find(n,{id:e.id});t&&(e.value=t.value),e.optionList&&e.optionList.list&&(e.optionList=angular.fromJson(e.optionList.list))});var r={id:t.id,layoutTemplate:"content",type:"content",title:t.title,properties:o,pageContent:t,contentType:t.contentType,sortOrder:t.sortOrder};return r}function L(t){var n=t.properties,e=_.find(v.modules,function(e){return e.moduleAction.id===t.moduleAction.id}),o=angular.copy(e.moduleAction.properties);_.forEach(o,function(e){var t=_.find(n,{id:e.id});t&&(e.value=t.value),e.optionList&&e.optionList.list&&(e.optionList=angular.fromJson(e.optionList.list))});var r={id:t.id,layoutTemplate:"module",type:"module",title:t.title,moduleAction:t.moduleAction,pageModule:t,sortOrder:t.sortOrder,properties:o};return r}function E(n){var o={contents:[],modules:[]};_.forEach(n.placeHolders,function(e,t){e.sortOrder=t+1,"content"===e.layoutTemplate?o.contents.push({element:e,containerId:n.id}):"module"===e.layoutTemplate&&o.modules.push({element:e,containerId:n.id})});var e,t,r=jQuery.extend(!0,{},v.pageLayout);!function t(e){e.placeHolders=_.reject(e.placeHolders,function(e){return"content"===e.layoutTemplate||"module"===e.layoutTemplate});_.forEach(e.placeHolders,function(e){_.forEach(e.properties,function(e,t){e.optionList=null}),e.placeHolders&&t(e)})}(r),console.log("--------------------------"),console.log("Layout only"),console.log(r),s.all([function(e){var t=s.defer(),o=[];_.forEach(e.contents,function(e){var t={};e.element.id?(t.id=e.element.pageContent.id,t.pageId=e.element.pageContent.pageId,t.contentTypeId=e.element.pageContent.contentTypeId,t.inheritViewPermissions=e.element.pageContent.inheritViewPermissions,t.inheritEditPermissions=e.element.pageContent.inheritEditPermissions,t.hasEditPermission=e.element.pageContent.hasEditPermission):(t.id=v.newGuid(),t.pageId=pageContext.currentPageId,t.contentTypeId=e.element.contentType.id,t.hasEditPermission=!0,e.element.id=t.id,e.element.pageContent=t);var n=[];_.forEach(e.element.properties,function(e){if(e){var t={id:e.id,name:e.name,label:e.label,value:e.value};n.push(t)}}),t.properties=n,t.containerId=e.containerId,t.sortOrder=e.element.sortOrder,o.push(t)}),o&&0<o.length?p.putContents(o).then(function(e){console.log(e),t.resolve("page content updated")},function(e){console.log(e),t.reject(SYS_ERROR_MSG)}):t.reject(SYS_ERROR_MSG);return t.promise}(o),function(e){var t=s.defer(),r=[];_.forEach(e.modules,function(e){var t={pageId:pageContext.currentPageId,containerId:e.containerId,sortOrder:e.element.sortOrder};e.element.id?t.id=e.element.id:(t.id=v.newGuid(),e.element.id=t.id);var n=[],o=e.element.pageModule&&e.element.pageModule.properties?e.element.pageModule.properties:e.element.moduleAction.properties;_.forEach(o,function(e){if(e){var t={id:e.id,name:e.name,label:e.label,value:e.value};n.push(t)}}),t.properties=n,e.element.pageModule&&e.element.pageModule.module?(t.moduleId=e.element.pageModule.module.id,t.moduleActionId=e.element.pageModule.moduleActionId):(t.moduleId=e.element.moduleAction.moduleId,t.moduleActionId=e.element.moduleAction.id,t.hasEditPermission=!0,e.element.pageModule=t),r.push(t)}),r&&0<r.length?m.putModules(r).then(function(e){console.log(e),t.resolve("page content updated")},function(e){t.reject(SYS_ERROR_MSG)}):t.reject(SYS_ERROR_MSG);return t.promise}(o),(e=r,t=s.defer(),c.put(e).then(function(e){t.resolve("layout only updated")},function(e){C("error",SYS_ERROR_MSG),t.reject(SYS_ERROR_MSG)}),t.promise)]).then(function(){C("success","Layout has been saved")})}function w(e){var t,n;"content"===e.layoutTemplate?(n=e.id,p.remove(n).then(function(e){console.log(e)},function(e){C("error",SYS_ERROR_MSG)})):"module"===e.layoutTemplate&&(t=e.id,m.remove(t).then(function(e){console.log(e)},function(e){C("error",SYS_ERROR_MSG)}))}function C(e,t){v.message={messageType:e,content:t},n(function(){v.message={messageType:"",content:""}},o.appSettings.alertLifeTime)}SYS_ERROR_MSG=o.appSettings.systemErrorMsg,v.alerts=[],v.pageLayout={},v.selectedItem={},v.deletedElements=[],v.layoutAllowedTypes=["container"],v.newGuid=i.getGuid,v.dropCallback=function(e,t,n){return n.sortOrder=t+1,n},v.insertedCallback=function(e,t,n){var o=$(e.currentTarget).scope().$parent;o.item.id;console.log("-----------------------"),console.log("insertedCallback"),console.log("-----------------------"),console.log("updatingElement"),E(o.item)},v.itemMoved=function(e,t,n){var o=$(n.currentTarget).closest(".dnd-list").scope().parentItem;e.splice(t,1),E(o),console.log("-----------------------"),console.log("itemMoved"),console.log("-----------------------")},v.deleteElement=function(e,t,n){return w(n),n},v.selectItem=function(e){"content"!==e.layoutTemplate&&"module"!==e.layoutTemplate||(v.selectedItem=e,_.forEach(e.properties,function(e){e.optionList&&e.optionList.list&&(e.optionList=angular.fromJson(e.optionList.list))}))},v.editContent=function(t){var n=s.defer(),o=t;return r.open({animation:!0,size:"lg",openedClass:"edit-content-modal",backdrop:"static",templateUrl:"contenttypes/"+o.contentType.name+".html",controller:"EditContentCtrl as ecVM",resolve:{contentInfo:function(){var e=o;return e}}}).result.then(function(e){t.pageContent.pageContentTranslation[0]=angular.fromJson(e),n.resolve("data received!")},function(){n.reject(SYS_ERROR_MSG)}),n.promise},v.editModule=function(e){var t;t=(v.selectedItem=e).pageModule?e.pageModule.moduleId:e.moduleAction.moduleId;g.getEditActions(t).then(function(e){v.selectedItem.pageModule||(v.selectedItem.pageModule={}),v.selectedItem.pageModule.editActions=e},function(e){console.log(e),C("error",SYS_ERROR_MSG)})},v.openModuleActionEdit=function(t){var n=s.defer();return r.open({animation:!0,size:"lg",openedClass:"edit-content-modal",backdrop:"static",templateUrl:"app/components/editModule.tpl.html",controller:"EditModuleCtrl as emVM",resolve:{moduleInfo:function(){var e={moduleActionId:t.id,pageModuleId:v.selectedItem.id};return e}}}).result.then(function(e){n.resolve("data received!")},function(){n.reject(SYS_ERROR_MSG)}),n.promise},v.changeModulePermission=function(t){var n=s.defer();return r.open({animation:!0,size:"lg",backdrop:"static",templateUrl:"app/components/permissionEditor.tpl.html",controller:"ModulePermissionCtrl as peVM",resolve:{pageModule:function(){var e=t;return e}}}).result.then(function(e){n.resolve("data received!")},function(){n.reject(SYS_ERROR_MSG)}),n.promise},v.changeContentPermission=function(t){var n=s.defer();return r.open({animation:!0,size:"lg",backdrop:"static",templateUrl:"app/components/permissionEditor.tpl.html",controller:"ContentPermissionCtrl as peVM",resolve:{pageContent:function(){var e=t;return e}}}).result.then(function(e){n.resolve("data received!")},function(){n.reject(SYS_ERROR_MSG)}),n.promise},v.saveProperties=function(){var n=[];if(_.forEach(v.selectedItem.properties,function(e){if(e){var t={id:e.id,name:e.name,label:e.label,value:e.value,description:e.description,defaultValue:e.defaultValue};n.push(t)}}),"content"===v.selectedItem.layoutTemplate){var e={};e.id=v.selectedItem.pageContent.id,e.pageId=v.selectedItem.pageContent.pageId,e.title=v.selectedItem.title,e.contentTypeId=v.selectedItem.pageContent.contentTypeId,e.properties=n,e.containerId=v.selectedItem.pageContent.containerId,e.sortOrder=v.selectedItem.sortOrder,p.put(e).then(function(e){console.log(e),v.selectedItem.isPropertyChanged=!1,C("success","Content Element properities have been saved successfully.")},function(e){console.log(e),C("error","Cannot save the content element properities,please contact administrator")},!0)}else if("module"===v.selectedItem.layoutTemplate){var t=v.selectedItem.pageModule;t.title=v.selectedItem.title,t.containerId=v.selectedItem.pageModule.containerId,t.sortOrder=v.selectedItem.sortOrder,t.properties=n,m.put(t).then(function(e){console.log(e),C("success","Module properities have been saved successfully.")},function(e){console.log(e),C("error","Cannot save the module properities,please contact administrator")},!0)}},v.setColumnWidth=a.setColumnWidth,v.draft=function(){l.draftPage(v.currentPage.id).then(function(e){v.currentPage.state="Publish",C("success","The Page has been drafted.")},function(e){C("error","Cannot draft the page, please contact the administrator.")})},v.publish=function(){"Publish"==v.currentPage.state&&l.publishPage(v.currentPage.id).then(function(e){v.currentPage.state="Published",C("success","The Page has been published.")},function(e){C("error","Cannot publish the page, please contact the administrator.")})},v.uaLayout={},S={},(b=s.defer(),l.get(pageContext.currentPageId).then(function(e){v.currentPage=e;var t=_.find(v.currentPage.pagePermissions,{roleId:o.appSettings.roles.allUsers});v.currentPage.state=t?"Published":"Publish",b.resolve(e)},function(e){C("error",SYS_ERROR_MSG),b.reject(SYS_ERROR_MSG)}),b.promise).then(function(){var t,n,o,r,i,a;s.all([(a=s.defer(),c.get(v.currentPage.layoutId).then(function(e){S=e,a.resolve("data received")},function(e){C("error",SYS_ERROR_MSG),a.reject(SYS_ERROR_MSG)}),a.promise),(i=s.defer(),u.get().then(function(e){var t=e;v.contentTypes=[],_.forEach(t,function(e){v.contentTypes.push({layoutTemplate:"content",type:"content",contentType:e,properties:e.properties})}),i.resolve("data received!")},function(e){C("error",SYS_ERROR_MSG),i.reject(SYS_ERROR_MSG)}),i.promise),(r=s.defer(),d.get().then(function(e){v.layoutTypes=e,r.resolve("data received!")},function(e){C("error",SYS_ERROR_MSG),r.reject(SYS_ERROR_MSG)}),r.promise),(o=s.defer(),g.get().then(function(e){var t=e;v.modules=[],_.forEach(t,function(e){v.modules.push({layoutTemplate:"module",type:"module",moduleAction:e,properties:e.properties})}),o.resolve("data received!")},function(e){C("error",SYS_ERROR_MSG),deferred.reject(SYS_ERROR_MSG)}),o.promise),(n=s.defer(),p.get(pageContext.currentPageId,pageContext.currentLocale).then(function(e){v.pageContents=e,n.resolve(e)},function(e){C("error",SYS_ERROR_MSG),n.reject(SYS_ERROR_MSG)}),n.promise),(t=s.defer(),m.getByPage(pageContext.currentPageId).then(function(e){v.pageModules=e,t.resolve(e)},function(e){C("error",SYS_ERROR_MSG),t.reject(SYS_ERROR_MSG)}),t.promise)]).then(function(){y()})}),e.$watch(function(){return v.selectedItem.properties},function(e,t){v.selectedItem.isPropertyChanged=!0},!0);var b}]),e.controller("EditContentCtrl",["$scope","$uibModalInstance","$q","devUtil","languageService","pageContentService","contentTranslationService","dateConverter","contentInfo",function(e,t,n,o,r,i,a,s,c){var l=this;function u(e){var t=_.find(l.contentTranslations,{cultureCode:e});return t||(t={cultureCode:e,contentData:{items:[]}}),t}function d(){var e=s.prepareRequest(l.contentTranslation.contentData);l.contentTranslation.contentData=angular.toJson(e)}function p(){if("string"==typeof l.contentTranslation.contentData){var e=JSON.parse(l.contentTranslation.contentData);l.contentTranslation.contentData=s.parseResponse(e)}}l.contentId=c.id,l.properties=c.properties,l.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},l.currentViewState=l.viewStates.LIST,l.changeLanguage=function(){var e=u(l.selectedLocale.cultureCode);l.contentTranslation=e,p()},l.save=function(){l.contentTranslation.id?(d(),a.put(l.contentTranslation).then(function(e){e.contentData=angular.fromJson(e.contentData),console.log(e),t.close(e)},function(e){showMessage("error",SYS_ERROR_MSG)})):(l.contentTranslation.pageContentId=l.contentId,d(),a.post(l.contentTranslation).then(function(e){e.contentData=angular.fromJson(e.contentData),console.log(e),t.close(e)},function(e){showMessage("error",SYS_ERROR_MSG)}))},l.cancel=function(){t.dismiss("cancel")},l.newItem=function(){l.selectedItem={},l.currentViewState=l.viewStates.NEW},l.updateItem=function(){l.selectedItem.id||(l.selectedItem.id=o.getGuid(),l.selectedItem.viewOrder=l.contentTranslation.contentData.items.length+1,l.contentTranslation.contentData.items.push(l.selectedItem));l.currentViewState=l.viewStates.LIST},l.editItem=function(e){l.selectedItem=e,l.tempItem=angular.copy(e),l.currentViewState=l.viewStates.EDIT},l.removeItem=function(e){var t=l.contentTranslation.contentData.items.indexOf(e);l.contentTranslation.contentData.items.splice(t,1),l.isChanged=!0},l.cancelDetailView=function(){if(l.currentViewState==l.viewStates.NEW)l.selectedItem={};else if(l.currentViewState==l.viewStates.EDIT){var e=_.findIndex(l.contentTranslation.contentData.items,l.selectedItem);l.selectedItem=l.tempItem,l.contentTranslation.contentData.items.splice(e,1,l.tempItem)}l.currentViewState=l.viewStates.LIST},l.sortableOptions={stop:function(e,t){_.forEach(l.contentTranslation.contentData.items,function(e,t){e.viewOrder=t+1})}},l.dateOptions={formatYear:"yy",maxDate:new Date(2025,11,31),minDate:new Date(2018,0,1),startingDay:1},l.templateMode="EDITCONTENT",n.all([(g=n.defer(),i.get(l.contentId).then(function(e){console.log(e),l.contentTranslations=e.pageContentTranslation,l.contentType=e.contentType,g.resolve("data received!")},function(e){showMessage("error",SYS_ERROR_MSG),g.reject(SYS_ERROR_MSG)}),g.promise),(f=n.defer(),r.getSiteLanguages().then(function(e){l.languages=e,f.resolve("data received!")},function(e){showMessage("error","Cannot get all languages, please contact administrator"),f.reject(SYS_ERROR_MSG)}),f.promise)]).then(function(){var e=pageContext.currentLocale;l.selectedLocale=_.find(l.languages,{cultureCode:e});var t=u(l.selectedLocale.cultureCode);l.contentTranslation=t,p()});var f,g}]),e.controller("EditModuleCtrl",["$scope","$timeout","$uibModalInstance","$q","$sce","devUtil","globals","moduleActionService","moduleInfo",function(e,t,n,o,r,i,a,s,c){var l=this;l.pageModuleId=c.pageModuleId,l.moduleActionId=c.moduleActionId,l.cancel=function(){n.dismiss("cancel")},s.getEditActionView(pageContext.currentUrl,l.pageModuleId,l.moduleActionId).then(function(e){console.log(e),l.editView=r.trustAsHtml(e)},function(e){console.log(e)})}]),e.controller("ModulePermissionCtrl",["$scope","$timeout","$uibModalInstance","$q","devUtil","globals","roleService","pageModuleService","pageModule",function(e,n,t,o,r,i,a,s,c){var l=this,u=i.appSettings.permissions.moduleView,d=i.appSettings.permissions.moduleEdit,p=i.appSettings.roles.administrator,f=c;function g(t){if(l.pageModule){var e=_.find(l.pageModule.modulePermissions,function(e){return e.roleId===t.id&&e.permissionId===u});return e}return!1}function m(t){if(l.pageModule){var e=_.find(l.pageModule.modulePermissions,function(e){return e.roleId===t.id&&e.permissionId===d});return e}return!1}function v(e,t){l.message={messageType:e,content:t},n(function(){l.message={messageType:"",content:""}},i.appSettings.alertLifeTime)}l.label={title:"Module Permission",tableRowTitleView:"View Module",tableRowTitleEdit:"Edit Module"},l.administratorRoleId=p,l.isView=g,l.isEdit=m,l.changeViewPermission=function(t){if(t.id!==p)if(g(t))l.pageModule.modulePermissions=_.reject(l.pageModule.modulePermissions,function(e){return e.roleId===t.id&&e.permissionId===u});else{var e={pageModuleId:l.pageModule.id,roleId:t.id,permissionId:u};l.pageModule.modulePermissions.push(e)}},l.changeEditPermission=function(t){if(t.id!==p)if(m(t))l.pageModule.modulePermissions=_.reject(l.pageModule.modulePermissions,function(e){return e.roleId===t.id&&e.permissionId===d});else{var e={pageModuleId:l.pageModule.id,roleId:t.id,permissionId:d};l.pageModule.modulePermissions.push(e)}},l.save=function(){var e={id:l.pageModule.id,pageId:l.pageModule.pageId,inheritViewPermissions:l.inheritViewPermissions,inheritEditPermissions:l.inheritEditPermissions,modulePermissions:l.pageModule.modulePermissions};s.putPermission(e).then(function(e){console.log(e),t.dismiss("cancel")},function(e){v("error",SYS_ERROR_MSG)})},l.cancel=function(){t.dismiss("cancel")},a.get().then(function(e){l.roles=e},function(e){v("error","Cannot get all roles, please contact administrator")}),s.get(f.id).then(function(e){l.pageModule=e,l.inheritViewPermissions=l.pageModule.inheritViewPermissions,l.inheritEditPermissions=l.pageModule.inheritEditPermissions},function(e){v("error","Cannot get all roles, please contact administrator")})}]),e.controller("ContentPermissionCtrl",["$scope","$timeout","$uibModalInstance","$q","devUtil","globals","roleService","pageContentService","pageContent",function(e,n,t,o,r,i,a,s,c){var l=this,u=i.appSettings.permissions.contentView,d=i.appSettings.permissions.contentEdit,p=i.appSettings.roles.administrator,f=c;function g(t){if(l.pageContent){var e=_.find(l.pageContent.contentPermissions,function(e){return e.roleId===t.id&&e.permissionId===u});return e}return!1}function m(t){if(l.pageContent){var e=_.find(l.pageContent.contentPermissions,function(e){return e.roleId===t.id&&e.permissionId===d});return e}return!1}function v(e,t){l.message={messageType:e,content:t},n(function(){l.message={messageType:"",content:""}},i.appSettings.alertLifeTime)}l.label={title:"Content Permission",tableRowTitleView:"View Content",tableRowTitleEdit:"Edit Content"},l.administratorRoleId=p,l.isView=g,l.isEdit=m,l.changeViewPermission=function(t){if(t.id!==p)if(g(t))l.pageContent.contentPermissions=_.reject(l.pageContent.contentPermissions,function(e){return e.roleId===t.id&&e.permissionId===u});else{var e={pageContentId:l.pageContent.id,roleId:t.id,permissionId:u};l.pageContent.contentPermissions.push(e)}},l.changeEditPermission=function(t){if(t.id!==p)if(m(t))l.pageContent.contentPermissions=_.reject(l.pageContent.contentPermissions,function(e){return e.roleId===t.id&&e.permissionId===d});else{var e={pageContentId:l.pageContent.id,roleId:t.id,permissionId:d};l.pageContent.contentPermissions.push(e)}},l.save=function(){var e={id:l.pageContent.id,pageId:l.pageContent.pageId,inheritViewPermissions:l.inheritViewPermissions,inheritEditPermissions:l.inheritEditPermissions,contentPermissions:l.pageContent.contentPermissions};s.putPermission(e).then(function(e){console.log(e),t.dismiss("cancel")},function(e){v("error",SYS_ERROR_MSG)})},l.cancel=function(){t.dismiss("cancel")},a.get().then(function(e){l.roles=e},function(e){v("error","Cannot get all roles, please contact administrator")}),s.get(f.id).then(function(e){l.pageContent=e,l.inheritViewPermissions=l.pageContent.inheritViewPermissions,l.inheritEditPermissions=l.pageContent.inheritEditPermissions},function(e){v("error","Cannot get all roles, please contact administrator")})}])}(),angular.module("deviserLayout",["ui.router","ui.bootstrap","dndLists","dev.modal","dev.sdlib","deviser.services","deviser.config"]).controller("LayoutCtrl",["$scope","$timeout","$filter","$q","globals","devUtil","editLayoutUtil","layoutService","pageService","layoutTypeService","pageContentService","moduleService","pageModuleService","modalService",function(e,n,t,o,r,i,a,s,c,l,u,d,p,f){var g,m,v=this;function h(){var t=o.defer();return s.get().then(function(e){console.log(e),e=_.filter(e,{isDeleted:!1}),_.forEach(e,function(e){e&&!e.placeHolders&&(e.placeHolders=[])}),v.layouts=e,t.resolve("data received!")},function(e){E("error",SYS_ERROR_MSG),t.reject(SYS_ERROR_MSG)}),t.promise}function S(e){e&&_.forEach(e,function(e){e.layoutTypeId=e.id,e.id=i.getGuid(),e.placeHolders=[],e.layoutTypeIds=e.layoutTypeIds.replace(/\s+/g,""),e.allowedTypes=e.layoutTypeIds?e.layoutTypeIds.split(","):"",e.type=e.name,"column"===e.type?e.layoutTemplate="column":"container"===e.type?e.layoutTemplate="container":"row"===e.type?e.layoutTemplate="row":e.layoutTemplate="repeater"})}function y(){v.pageLayout={},v.pageLayout.id=void 0,v.pageLayout.name="",v.pageLayout.isChanged=!1,v.isLayoutEdit=!0,v.pageLayout.placeHolders=[]}function T(e){v.pageLayout=e,v.pageLayout.isChanged=!0,I(v.pageLayout.placeHolders)}function I(e,o){e&&_.forEach(e,function(e,t){console.log(e);var n=_.find(v.layoutTypes,{layoutTypeId:e.layoutTypeId});n&&(e.label=n.label),o&&e.properties?_.forEach(e.properties,function(e,t){e.optionList=null}):(L(e),e.id===v.selectedItem.id&&(v.selectedItem=e)),e.sortOrder=t+1,e.placeHolders&&I(e.placeHolders,o)})}function L(n){var o=n.properties,e=_.find(v.layoutTypes,{layoutTypeId:n.layoutTypeId}),t=e.properties;_.forEach(t,function(e){if(e){var t=_.find(o,{id:e.id});t?(t.label=e.label,t.description=e.description,t.defaultValue=e.defaultValue,t.optionList=e.optionList,t.optionListId=e.optionListId):n.properties.push(angular.copy(e))}})}function E(e,t){v.message={messageType:e,content:t},n(function(){v.message={messageType:"",content:""}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,v.alerts=[],v.pageLayout={},v.selectedItem={},v.deletedElements=[],v.layoutAllowedTypes=["9341f92e-83d8-4afe-ad4a-a95deeda9ae3","5a0a5884-da84-4922-a02f-5828b55d5c92"],v.newGuid=i.getGuid,v.dragoverCallback=function(e,t,n){return console.log(n),0<t},v.dropCallback=function(e,t,n){return n},v.logListEvent=function(e,t,n,o,r){var i=o?"External ":"";i+=r+" element is "+e+" position "+n,v.logEvent(i,t)},v.logEvent=function(e,t){console.log(e,"(triggered by the following",t.type,"event)"),console.log(t)},v.newLayout=y,v.selectLayout=T,v.copyLayout=function(){v.pageLayout.id=void 0,v.pageLayout.name="",v.pageLayout.isChanged=!0},v.saveLayout=function(){I(v.pageLayout.placeHolders,!0),v.pageLayout.pageId=pageContext.currentPageId,v.pageLayout.id?s.put(v.pageLayout).then(function(e){v.pageLayout.id=e.id,v.pageLayout.placeHolders=e.placeHolders,v.pageLayout.isChanged=!1,E("success","Layout has been saved"),I(v.pageLayout.placeHolders),v.isLayoutEdit=!1},function(e){E("error",SYS_ERROR_MSG)}):s.post(v.pageLayout).then(function(e){console.log(e),v.pageLayout.id=e.id,v.pageLayout.placeHolders=e.placeHolders,v.pageLayout.isChanged=!1,E("success","Layout has been saved"),h().then(function(){I(v.pageLayout.placeHolders)}),v.isLayoutEdit=!1},function(e){E("error",SYS_ERROR_MSG)})},v.deleteLayout=function(){var e={title:"Delete Confirmation",body:"Are you sure to delete the layout",okLabel:"Yes",cancelLabel:"No"};f.showConfirmation(e).then(function(){s.remove(v.pageLayout.id).then(function(e){console.log("Layout deletion agreed at:"+new Date),E("success","Layout has been removed"),h(),y()},function(e){E("error",SYS_ERROR_MSG)})},function(){console.log("Layout deletion disagreed at:"+new Date)})},v.selectItem=function(e){var t=e.properties;L(e);var n=a.getColumnWidthProperty(t);if(n&&!n.value){var o=_.find(n.optionList.list,{name:a.const.defaultWidth});n.value=o.id}v.selectedItem=e},v.itemMoved=function(e,t){e.splice(t,1)},v.deleteElement=function(e,t,n){return n},v.setColumnWidth=a.setColumnWidth,o.all([(m=o.defer(),c.get(pageContext.currentPageId).then(function(e){v.currentPage=e,m.resolve("data received!")},function(e){E("error",SYS_ERROR_MSG),m.reject(SYS_ERROR_MSG)}),m.promise),h(),(g=o.defer(),l.get().then(function(e){v.layoutTypes=e,g.resolve("data received!")},function(e){E("error",SYS_ERROR_MSG),g.reject(SYS_ERROR_MSG)}),g.promise)]).then(function(){if(S(v.layoutTypes),v.currentPage.layoutId){var e=_.find(v.layouts,function(e){return e.id===v.currentPage.layoutId});e?T(e):y()}})}]),function(){var e=angular.module("dev.sdlib",["ngSanitize"]);e.directive("devEnter",function(){return function(t,e,n){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(n.ictEnter)}),e.preventDefault())})}}),e.directive("devNumberOnly",function(){return{require:"ngModel",link:function(e,t,n,o){o.$parsers.push(function(e){if(null==e)return"";var t=e.replace(/[^0-9]/g,"");return t!=e&&(o.$setViewValue(t),o.$render()),t})}}}),e.directive("devAlphabetsOnly",function(){return{require:"ngModel",link:function(e,t,n,o){o.$parsers.push(function(e){return null==e?"":((t=(t=e.replace(/\s+/g,"_")).replace(/[^_a-zA-Z]/g,""))!=e&&(o.$setViewValue(t),o.$render()),t);var t})}}}),e.directive("devEdit",["$compile","$templateCache",function(s,c){return{restrict:"A",controller:function(e,t){var n=this,o=e;n.content||(n.content="Please enter the content");n.edit=function(){n.isEditMode=!n.isEditMode},n.save=function(){n.content&&o.sdVM.contentId&&o.sdVM.containerId&&o.sdVM.onSave()(n.content,o.sdVM.contentId,o.sdVM.containerId),n.cancel()},n.cancel=function(){n.isEditMode=!n.isEditMode},e.$watch(function(){return o.sdVM.ngModel},function(e){console.log("Changed to "+e),function(){if(o.sdVM.ngModel&&o.sdVM.contentId){var e=_.find(o.sdVM.ngModel,function(e){return e.id===o.sdVM.contentId});e&&(n.content=e)}}()})},controllerAs:"sdVM",bindToController:!0,link:function(e,t,n,o,r,i){var a="edit_"+n.contentType;template=c.get(a),t.html(template),s(t.contents())(e)},scope:{contentId:"@",containerId:"@",contentType:"@",ngModel:"=",onSave:"&"}}}]),e.directive("contenteditable",["$sce",function(i){return{restrict:"A",require:"?ngModel",link:function(e,t,n,o){function r(){var e=t.html();n.stripBr&&"<br>"==e&&(e=""),o.$setViewValue(e)}o&&(o.$render=function(){t.html(i.getTrustedHtml(o.$viewValue||""))},t.on("blur keyup change",function(){e.$evalAsync(r)}),r())}}}]),e.factory("devUtil",[function(){return{getGuid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},isGuid:function(e){return/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(e)}}}]),e.factory("editLayoutUtil",[function(){var r="col-md-4";return{const:{defaultWidth:r},setColumnWidth:function(e){var t,n=i(e);if(n&&n.value){var o=_.find(n.optionList.list,{id:n.value});t=o.name}else t=r;return t},getColumnWidthProperty:i};function i(e){return _.find(e,{name:"column_width"})}}]),e.factory("dateConverter",["dateFilter",function(e){return{parseResponse:function(e){return function n(o){_.forEach(o,function(e,t){o.hasOwnProperty(t)&&(moment(o[t],moment.ISO_8601,!0).isValid()&&(o[t]=moment(o[t]).toDate()),angular.isArray(o[t])&&0<o[t].length&&_.forEach(o[t],function(e){n(e)}))})}(e),e},prepareRequest:function(e){var t;return function n(o){_.forEach(o,function(e,t){o.hasOwnProperty(t)&&(angular.isDate(o[t])&&(o[t]=moment(o[t]).format()),angular.isArray(o[t])&&0<o[t].length&&_.forEach(o[t],function(e){n(e)}))})}(t=angular.copy(e)),t}}}]),e.filter("notInArray",["$filter",function(t){return function(e,n,o){return n?t("filter")(e,function(e){for(var t=0;t<n.length;t++)if(n[t][o]==e[o])return!1;return!0}):e}}])}(),function(){var e=angular.module("deviser.services",["deviser.config"]);function s(o,r,e,t){var n={get:function(e){var t=i;e&&(t=i+"/"+e);return o({method:"GET",url:t}).then(l,function(e){return c(e,r)})},put:function(e,t){var n=i;t&&(n=i+"/"+t);return o({method:"PUT",url:n,data:angular.toJson(e)}).then(l,function(e){return c(e,r)})},post:function(e){return o({method:"POST",url:i,data:angular.toJson(e)}).then(l,function(e){return c(e,r)})},remove:function(e){{var t=o({method:"DELETE",url:i+"/"+e})}return t.then(l,function(e){return c(e,r)})}},i=e.appSettings.serviceBaseUrl+t;return n}function c(e,t){return angular.isObject(e.data)&&e.data?t.reject(e.data):t.reject("An unknown error occurred.")}function l(e){return e.data}e.factory("layoutService",["$http","$q","globals",function(n,o,r){var i="/layout",e=s(n,o,r,i);return e.getDeletedLayouts=function(){var e=r.appSettings.serviceBaseUrl+i+"/deletedlist";return n({method:"GET",url:e}).then(l,function(e){return c(e,o)})},e.restoreLayout=function(e){var t=r.appSettings.serviceBaseUrl+i+"/"+e.id;return n({method:"PUT",url:t,data:angular.toJson(e)}).then(l,function(e){return c(e,o)})},e}]),e.factory("applicationService",["$http","$q","globals",function(t,n,o){var r="/application";return{restart:function(){var e=o.appSettings.serviceBaseUrl+r+"/restart";return t({method:"GET",url:e}).then(l,function(e){return c(e,n)})}}}]),e.factory("pageService",["$http","$q","globals",function(n,o,r){var i="/page",e=s(n,o,r,i);return e.getPages=function(){var e=r.appSettings.serviceBaseUrl+i+"/list";return n({method:"GET",url:e}).then(l,function(e){return c(e,o)})},e.getDeletedPages=function(){var e=r.appSettings.serviceBaseUrl+i+"/deletedlist";return n({method:"GET",url:e}).then(l,function(e){return c(e,o)})},e.restorePage=function(e){var t=r.appSettings.serviceBaseUrl+i+"/restore/"+e;return n({method:"PUT",url:t}).then(l,function(e){return c(e,o)})},e.deletePage=function(e){var t=r.appSettings.serviceBaseUrl+i+"/delete/"+e;return n({method:"DELETE",url:t}).then(l,function(e){return c(e,o)})},e.draftPage=function(e){var t=r.appSettings.serviceBaseUrl+i+"/draft/"+e;return n({method:"POST",url:t}).then(l,function(e){return c(e,o)})},e.publishPage=function(e){var t=r.appSettings.serviceBaseUrl+i+"/publish/"+e;return n({method:"POST",url:t}).then(l,function(e){return c(e,o)})},e}]),e.factory("contentTypeService",["$http","$q","globals",function(e,t,n){return s(e,t,n,"/contenttype")}]),e.factory("layoutTypeService",["$http","$q","globals",function(e,t,n){return s(e,t,n,"/layouttype")}]),e.factory("propertyService",["$http","$q","globals",function(e,t,n){return s(e,t,n,"/property")}]),e.factory("optionListService",["$http","$q","globals",function(e,t,n){return s(e,t,n,"/optionlist")}]),e.factory("siteSettingService",["$http","$q","globals",function(e,t,n){return s(e,t,n,"/sitesetting")}]),e.factory("pageContentService",["$http","$q","globals",function(r,i,e){var t="/pagecontent",n=s(r,i,e,t),a=e.appSettings.serviceBaseUrl+t;return n.get=function(){var e=a;if(arguments[0]&&arguments[1]){var t=arguments[1],n=arguments[0];e=a+"/"+t+"/"+n}else if(arguments[0]){var o=arguments[0];e=a+"/"+o}return r({method:"GET",url:e}).then(l,function(e){return c(e,i)})},n.getDeletedPageContents=function(){return r({method:"GET",url:a+"/list"}).then(l,function(e){return c(e,i)})},n.putContents=function(e){return r({method:"PUT",url:a+"/list",data:angular.toJson(e)}).then(l,function(e){return c(e,i)})},n.putPermission=function(e){return r({method:"PUT",url:a+"/permission",data:angular.toJson(e)}).then(l,function(e){return c(e,i)})},n.restorePageContent=function(e){return r({method:"PUT",url:a+"/restore/"+e}).then(l,function(e){return c(e,i)})},n.deletePageContent=function(e){return r({method:"DELETE",url:a+"/delete/"+e}).then(l,function(e){return c(e,i)})},n}]),e.factory("contentTranslationService",["$http","$q","globals",function(r,i,e){var t="/contenttranslation",n=s(r,i,e,t),a=e.appSettings.serviceBaseUrl+t;return n.get=function(){var e=a;if(arguments[0]&&arguments[1]){var t=arguments[1],n=arguments[0];e=a+"/"+t+"/"+n}else if(arguments[0]){var o=arguments[0];e=a+"/"+o}return r({method:"GET",url:e}).then(l,function(e){return c(e,i)})},n}]),e.factory("moduleService",["$http","$q","globals",function(t,n,o){var e=s(t,n,o,"/module");return e.getModuleActionTypes=function(){var e=o.appSettings.serviceBaseUrl+"/module/moduleactiontype";return t({method:"GET",url:e}).then(l,function(e){return c(e,n)})},e}]),e.factory("moduleActionService",["$http","$q","globals",function(o,r,n){var i="/moduleaction",e=s(o,r,n,i);return e.getEditActions=function(e){var t=n.appSettings.serviceBaseUrl+i+"/edit/"+e;return o({method:"GET",url:t}).then(l,function(e){return c(e,r)})},e.getEditActionView=function(e,t,n){return o({method:"GET",url:"/page/editmodule/pageModuleId/"+t+"/moduleActionId/"+n+"?currentLink="+e}).then(l,function(e){return c(e,r)})},e}]),e.factory("pageModuleService",["$http","$q","globals",function(t,n,e){var o="/pagemodule",r=e.appSettings.serviceBaseUrl+o,i=s(t,n,e,o);return i.getByPage=function(e){return t({method:"GET",url:r+"/page/"+e}).then(l,function(e){return c(e,n)})},i.getDeletedPageModules=function(){return t({method:"GET",url:r+"/list"}).then(l,function(e){return c(e,n)})},i.post=null,i.putModules=function(e){return t({method:"PUT",url:r+"/list",data:angular.toJson(e)}).then(l,function(e){return c(e,n)})},i.putPermission=function(e){return t({method:"PUT",url:r+"/permission",data:angular.toJson(e)}).then(l,function(e){return c(e,n)})},i.restorePageModule=function(e){return t({method:"PUT",url:r+"/restore/"+e}).then(l,function(e){return c(e,n)})},i.deletePageModule=function(e){return t({method:"DELETE",url:r+"/delete/"+e}).then(l,function(e){return c(e,n)})},i}]),e.factory("themeService",["$http","$q","globals",function(e,t,n){return s(e,t,n,"/theme")}]),e.factory("userService",["$http","$q","globals",function(e,t,n){return s(e,t,n,"/user")}]),e.factory("userExistService",["$http","$q","globals",function(e,t,n){return s(e,t,n,"/user/isexist")}]),e.factory("passwordResetService",["$http","$q","globals",function(e,t,n){return s(e,t,n,"/user/passwordreset")}]),e.factory("roleService",["$http","$q","globals",function(e,t,n){return s(e,t,n,"/role")}]),e.factory("userRoleService",["$http","$q","globals",function(o,r,e){var t="/user/role",n=s(o,r,e,t),i=e.appSettings.serviceBaseUrl+t;return n.remove=function(e,t){var n=o({method:"DELETE",url:i+"/"+e+"/"+t});return n.then(l,function(e){return c(e,r)})},n}]),e.factory("languageService",["$http","$q","globals",function(e,t,n){var o="/language",r=n.appSettings.serviceBaseUrl+o,i=s(e,t,n,o);return i.getSiteLanguages=function(){return e({method:"GET",url:r+"/site"}).then(l,function(e){return c(e,t)})},i}]),e.factory("fileService",["$http","$q","globals",function(e,t,n){return s(e,t,n,"/file")}]),e.factory("assetService",["$http","$q","globals",function(e,t,n){return s(e,t,n,"/upload/images")}]),e.factory("conatctFormService",["$http","$q","globals",function(e,t,n){return s(e,t,n,"/contactform")}])}(),function(){var e=angular.module("dev.modal",["ui.bootstrap"]);e.factory("modalService",["$q","$uibModal",function(t,n){var e={};return e.showConfirmation=function(e){return t.defer(),n.open({animation:!0,backdrop:"static",templateUrl:"app/components/confirmdialog.tpl.html",controller:"ModalInstanceCtrl as mVM",resolve:{labels:function(){return e}}}).result},e.showProgressModel=function(e){return n.open({animation:!0,backdrop:"static",templateUrl:"app/components/progressdialog.tpl.html",controller:"ModalInstanceCtrl as mVM",windowClass:"progress-model",resolve:{labels:function(){return e}}}).result},e}]),e.controller("ModalInstanceCtrl",["$uibModalInstance","$scope","labels",function(e,t,n){this.labels=n,this.ok=function(){e.close("ok")},this.cancel=function(){e.dismiss("cancel")}}])}(),function(){var e=angular.module("modules.app.imageManager",["ui.router","ui.bootstrap","ui.sortable","ui.select","deviser.services","ngFileUpload","angular-img-cropper"]);function g(e){var t=$(".focuspoint.preview"),n=$(".focuspoint");t.data("focusX",e.x),t.data("focusY",e.y),t.data("imageW",e.w),t.data("imageH",e.h),n.focusPoint()}e.directive("devImageManager",["$compile","$templateCache","assetService",function(o,r,e){return{restrict:"A",controller:["$scope","$uibModal",function(e,t){var o=this,r={};o.showPopup=function(){t.open({templateUrl:"app/components/imageManagerPopup.tpl.html",controller:"ImageManagerPopup as imVM",size:"sm",openedClass:"image-manager-modal",resolve:{selectedImage:function(){return{src:o.src,alt:o.alt,focusPoint:o.focusPoint,imageCropSize:r}}}}).result.then(function(e){o.src=e.imageSource,o.alt=e.imageAlt,o.focusPoint=e.focusPoint},function(e){console.log(e)})},o.removeImage=function(){o.src=null,o.alt=null,o.focusPoint=null},function(){var e=o.properties();if(e){var t=_.find(e,{name:"image_width"}),n=_.find(e,{name:"image_height"});r.width=t&&t.value?t.value:t.defaultValue,r.height=n&&n.value?n.value:n.defaultValue}o.focusPoint&&g(o.focusPoint)}(),e.$watch(function(){return o.focusPoint},function(){o.focusPoint&&g(o.focusPoint)})}],controllerAs:"locVM",bindToController:!0,link:function(e,t,n){template=r.get("app/components/imageManager.tpl.html"),t.html(template),o(t.contents())(e)},scope:{src:"=",alt:"=",focusPoint:"=",properties:"&",label:"@"}}}]),e.controller("ImageManagerPopup",["$scope","$uibModalInstance","$timeout","Upload","assetService","selectedImage",function(e,t,n,o,r,i){var u=this,a=i.imageCropSize;function s(){r.get().then(function(e){_.forEach(e,function(e){e.path+="?"+100*Math.random()}),u.images=e}),u.focusPointAttr={x:0,y:0,w:0,h:0},u.selectedTab="PREVIEW",u.imageSource&&(p(u.imageSource),u.imageSource=u.imageSource.split("?")[0],u.selectedImage={name:u.imageSource.split("/").pop()}),u.cropWidth=a&&a.width||300,u.cropHeight=a&&a.height||200}function c(e,t,n,o){s(),console.log(e),u.imageSource=e.data[0],u.imageSource+="?"+100*Math.random(),f("success","File uploaded successfully!")}function l(e){console.log(e),409==e.status?(s(),f("error","File already exists! if you want to replace this file, please check 'Replace Image'."),u.imageSource=e.data.filePath):f("error","Server error has been occured: "+e.data.ExceptionMessage)}function d(e){console.log("percent: "+parseInt(100*e.loaded/e.total,10))}function p(e){$("<img/>").attr("src",e).load(function(){u.focusPointAttr.w=this.width,u.focusPointAttr.h=this.height})}function f(e,t){u.message={messageType:e,content:t},n(function(){u.message={}},5e3)}u.imageSource=i.src,u.imageAlt=i.alt,u.focusPoint=i.focusPoint,u.focusPointAttr={},u.selectImage=function(e){u.selectedImage=e,u.imageSource=e.path,u.selectedTab="PREVIEW",p(u.imageSource)},u.yes=function(){t.close({imageSource:u.imageSource,imageAlt:u.imageAlt,focusPoint:u.focusPoint})},u.no=function(){t.dismiss("cancel")},u.isActive=function(e){if(e&&e.path){var t=e.path.split("?")[0],n=u.imageSource.split("?")[0];return n===t}return!1},u.onFileSelect=function(e){if(e){var t=o.upload({url:"/api/upload/images",method:"POST",data:{files:e},fileFormDataName:"files"});t.then(c,l,d)}},u.cropImage=function(){var e=o.dataUrltoBlob(u.croppedImage);e.name=u.selectedImage.name,o.upload({url:"/api/upload/images",method:"POST",file:e}).then(c,l,d)},u.focusImage=function(e){var t=$(e.target),n=t.width(),o=t.height(),r=e.pageX-t.offset().left,i=e.pageY-t.offset().top,a=2*(r/n-.5),s=-2*(i/o-.5);u.focusPointAttr.x=a.toFixed(2),u.focusPointAttr.y=s.toFixed(2),u.focusPoint=u.focusPointAttr;var c=r/n*100,l=i/o*100;g(u.focusPoint),$(".reticle").css({top:l+"%",left:c+"%"})},s()}])}(),angular.module("modules.app.languageSelector",["ui.router","ui.bootstrap","ui.sortable","ui.select","deviser.services","ngFileUpload","angular-img-cropper"]).directive("devLanguageSelector",["$compile","$templateCache","assetService",function(o,r,e){return{restrict:"A",controller:["$scope","$uibModal","languageService",function(e,t,n){var o=this;o.changeLocalLanguage=function(){console.log(o),o.changeLanguage()},n.getSiteLanguages().then(function(e){o.languages=e},function(e){showMessage("error","Cannot get all languages, please contact administrator")})}],controllerAs:"locVM",bindToController:!0,link:function(e,t,n){template=r.get("app/components/languageSelector.tpl.html"),t.html(template),o(t.contents())(e)},scope:{selectedLocale:"=",changeLanguage:"&",label:"@"}}}]),angular.module("modules.app.linkSelector",["ui.router","ui.bootstrap","ui.sortable","ui.select","deviser.services","ngFileUpload","angular-img-cropper"]).directive("devLinkSelector",["$compile","$templateCache","assetService",function(o,r,e){return{restrict:"A",controller:["$scope","$uibModal","pageService",function(e,t,n){var o=this,r=function(e,t){if(t?""===t&&(t="--"):t="",0!=e.pageLevel){var n=_.find(e.pageTranslation,{locale:"en-US"});e.pageName=t+n.name,o.pages.push(e)}e.childPage&&0<e.childPage.length&&_.each(e.childPage,function(e){r(e,t+"--")})};o.pages=[],n.get().then(function(e){o.nestedPages=e,o.pages=[],r(o.nestedPages)}),o.selectedLink||(o.selectedLink={}),o.selectedLink.linkType||(o.selectedLink.linkType="PAGE")}],controllerAs:"locVM",bindToController:!0,link:function(e,t,n){template=r.get("app/components/linkSelector.tpl.html"),t.html(template),o(t.contents())(e)},scope:{selectedLink:"=",properties:"&",label:"@"}}}]),angular.module("deviser.contact",["deviser.config","deviser.services"]).controller("ContactCtrl",["$scope","$timeout","$filter","$q","globals","conatctFormService",function(e,n,t,o,r,i){var a=this,s={};function c(e,t){a.message={messageType:e,content:t},n(function(){a.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,a.alerts=[],a.submit=function(){s.data=angular.toJson(a.form),s.pageModuleId=$("#ContactForm").closest(".dev-module-container").data("pageModuleId"),i.post(s).then(function(e){c("success","Your message have been successfully sent.")},function(e){c("error","Couldnt send your message, please try after sometime.")})},a.form={}}]),angular.module("deviser.contentTypes",["ui.router","ui.bootstrap","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("ContentTypesCtrl",["$scope","$timeout","$filter","$q","globals","devUtil","contentTypeService","propertyService",function(e,n,t,o,r,i,a,s){var c=this;function l(){a.get().then(function(e){c.contentTypes=e},function(e){f("error","Cannot get all content types, please contact administrator")}),d()}function u(){var e=_.find(c.selectedContentType.properties,{id:c.selectedProperty.id});return e}function d(){s.get().then(function(e){c.properties=e},function(e){f("error","Cannot get all properties, please contact administrator")})}function p(e){a.put(e).then(function(e){console.log(e),l(),f("success","Content Type has been updated"),c.currentViewState=c.viewStates.LIST},function(e){f("error","Cannot update content type, please contact administrator")})}function f(e,t){c.message={messageType:e,content:t},n(function(){c.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,c.alerts=[],c.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},c.currentViewState=c.viewStates.LIST,c.newContent=function(){c.currentViewState=c.viewStates.NEW,c.selectedContentType={}},c.edit=function(e){c.currentViewState=c.viewStates.EDIT,c.selectedContentType=e},c.isValidName=function(e){return!_.find(c.contentTypes,{name:e})},c.save=function(){e.contentTypeForm.submitted=!0,e.contentTypeForm.$valid&&(c.currentViewState==c.viewStates.NEW&&c.isValidName(c.selectedContentType.name)?a.post(c.selectedContentType).then(function(e){console.log(e),c.currentViewState=c.viewStates.LIST,c.selectedContentType={},l(),f("success","New content type has been added")},function(e){f("error","Cannot add content type, please contact administrator")}):p(c.selectedContentType))},c.activate=function(e){p(e)},c.cancel=function(){c.currentViewState=c.viewStates.LIST},c.hasError=function(e,t,n){return e&&n?e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n]:e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid},c.propertyTransform=function(e){var t=e.replace(/\s+/g,"");return{name:t=t.toLowerCase(),label:e}},c.addProperty=function(){u()||(c.selectedContentType.properties||(c.selectedContentType.properties=[]),c.selectedProperty.id?c.selectedContentType.properties.push(c.selectedProperty):s.post(c.selectedProperty).then(function(e){console.log(e),c.selectedProperty=e,c.selectedContentType.properties.push(c.selectedProperty),d(),f("success","New property has been added")},function(e){f("error","Cannot add new property, please contact administrator")}))},c.removeProperty=function(t){c.selectedContentType.properties=_.reject(c.selectedContentType.properties,function(e){return e.id===t.id})},c.isPropExist=u,l()}]),angular.module("deviser.layoutTypes",["ui.router","ui.bootstrap","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("LayoutTypesCtrl",["$scope","$timeout","$filter","$q","globals","layoutTypeService","propertyService",function(e,n,t,o,r,i,a){var s=this;function c(){var e=_.find(s.selectedLayoutType.properties,{id:s.selectedProperty.id});return e}function l(){i.get().then(function(e){s.layoutTypes=e},function(e){p("error","Cannot get all layout types, please contact administrator")})}function u(){a.get().then(function(e){s.properties=e},function(e){p("error","Cannot get all properties, please contact administrator")})}function d(e){i.put(e).then(function(e){console.log(e),l(),p("success","Layout type has been updated"),s.currentViewState=s.viewStates.LIST},function(e){p("error","Cannot update layout type, please contact administrator")})}function p(e,t){s.message={messageType:e,content:t},n(function(){s.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,s.alerts=[],s.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},s.currentViewState=s.viewStates.LIST,s.newContentType=function(){s.currentViewState=s.viewStates.NEW,s.selectedLayoutType={}},s.edit=function(e){if(s.currentViewState=s.viewStates.EDIT,s.selectedLayoutType=e,s.selectedLayoutType.layoutTypeIds){var t=s.selectedLayoutType.layoutTypeIds.replace(/\s+/g,"").split(",");s.selectedLayoutType.allowedLayoutTypes=t}},s.isValidName=function(e){return!_.find(s.layoutTypes,{name:e})},s.save=function(){e.layoutForm.submitted=!0,e.layoutForm.$valid&&(s.currentViewState===s.viewStates.NEW&&s.isValidName(s.selectedLayoutType.name)?i.post(s.selectedLayoutType).then(function(e){console.log(e),s.currentViewState=s.viewStates.LIST,s.selectedLayoutType={},l(),p("success","New content type has been added")},function(e){p("error","Cannot add layout type, please contact administrator")}):(s.selectedLayoutType.layoutTypeIds=s.selectedLayoutType.allowedLayoutTypes.join(","),delete s.selectedLayoutType.allowedLayoutTypes,d(s.selectedLayoutType)))},s.activate=function(e){d(e)},s.cancel=function(){s.currentViewState=s.viewStates.LIST},s.hasError=function(e,t,n){return e&&n?e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n]:e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid},s.propertyTransform=function(e){var t=e.replace(/\s+/g,"");return{name:t=t.toLowerCase(),label:e}},s.addProperty=function(){c()||(s.selectedLayoutType.properties||(s.selectedLayoutType.properties=[]),s.selectedProperty.id?s.selectedLayoutType.properties.push(s.selectedProperty):a.post(s.selectedProperty).then(function(e){console.log(e),s.selectedProperty=e,s.selectedLayoutType.properties.push(s.selectedProperty),u(),p("success","New property has been added")},function(e){p("error","Cannot add new property, please contact administrator")}))},s.removeProperty=function(t){s.selectedLayoutType.properties=_.reject(s.selectedLayoutType.properties,function(e){return e.id===t.id})},s.isPropExist=c,l(),u()}]),angular.module("deviser.optionList",["ui.router","ui.bootstrap","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("OptionListCtrl",["$scope","$timeout","$filter","$q","globals","devUtil","optionListService",function(e,n,t,o,r,i,a){var s=this;function c(){a.get().then(function(e){s.optionLists=e},function(e){u("error","Cannot get option lists, please contact administrator")})}function l(e){a.put(e).then(function(e){console.log(e),c(),u("success","Option list has been updated"),s.currentViewState=s.viewStates.LIST},function(e){u("error","Cannot update option list, please contact administrator")})}function u(e,t){s.message={messageType:e,content:t},n(function(){s.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,s.alerts=[],s.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},s.currentViewState=s.viewStates.LIST,s.newList=function(){s.currentViewState=s.viewStates.NEW,s.selectedOptionList={}},s.edit=function(e){s.currentViewState=s.viewStates.EDIT,s.selectedOptionList=e,s.selectedOptionList.items=[],s.selectedOptionList.list&&(s.selectedOptionList.items=s.selectedOptionList.list)},s.isValidName=function(e){return!_.find(s.optionLists,{name:e})},s.save=function(){e.optionListForm.submitted=!0,e.optionListForm.$valid&&(s.selectedOptionList.items&&(s.selectedOptionList.list=s.selectedOptionList.items),s.currentViewState==s.viewStates.NEW&&s.isValidName(s.selectedOptionList.name)?a.post(s.selectedOptionList).then(function(e){console.log(e),s.currentViewState=s.viewStates.LIST,s.selectedOptionList={},c(),u("success","New option list has been added")},function(e){u("error","Cannot add option list, please contact administrator")}):l(s.selectedOptionList))},s.activate=function(e){l(e)},s.cancel=function(){s.currentViewState=s.viewStates.LIST},s.hasError=function(e,t,n){return e&&n?e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n]:e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid},s.addListItem=function(){var e={id:i.getGuid(),name:"",label:""};s.selectedOptionList.items||(s.selectedOptionList.items=[]),s.selectedOptionList.items.push(e)},s.removeListItem=function(t){s.selectedOptionList.items=_.reject(s.selectedOptionList.items,function(e){return e.id===t.id})},c()}]),angular.module("deviser.properties",["ui.router","ui.bootstrap","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("PropertiesCtrl",["$scope","$timeout","$filter","$q","globals","devUtil","propertyService","optionListService",function(e,n,t,o,r,i,a,s){var c=this;function l(){a.get().then(function(e){c.properties=e},function(e){d("error","Cannot get all properties, please contact administrator")})}function u(e){a.put(e).then(function(e){console.log(e),l(),d("success","Property has been updated"),c.currentViewState=c.viewStates.LIST},function(e){d("error","Cannot update layout type, please contact administrator")})}function d(e,t){c.message={messageType:e,content:t},n(function(){c.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,c.alerts=[],c.viewStates={NEW:"NEW",EDIT:"EDIT",LIST:"LIST"},c.currentViewState=c.viewStates.LIST,c.newProperty=function(){c.currentViewState=c.viewStates.NEW,c.selectedProperty={}},c.edit=function(e){c.currentViewState=c.viewStates.EDIT,c.selectedProperty=e,c.selectedProperty.optionListId&&(c.selectedProperty.moreOption=!0)},c.isValidName=function(e){return!_.find(c.properties,{name:e})},c.save=function(){e.propertyForm.submitted=!0,e.propertyForm.$valid&&(c.selectedProperty.moreOption&&c.selectedProperty.optionList?c.selectedProperty.optionListId=c.selectedProperty.optionList.id:c.selectedProperty.optionListId=null,c.selectedProperty.optionList=null,c.currentViewState==c.viewStates.NEW&&c.isValidName(c.selectedProperty.name)?a.post(c.selectedProperty).then(function(e){console.log(e),c.currentViewState=c.viewStates.LIST,c.selectedProperty={},l(),d("success","New property has been added")},function(e){d("error","Cannot add new property, please contact administrator")}):u(c.selectedProperty))},c.activate=function(e){u(e)},c.cancel=function(){c.currentViewState=c.viewStates.LIST},c.hasError=function(e,t,n){return e&&n?e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n]:e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid},l(),s.get().then(function(e){c.optionLists=e},function(e){d("error","Cannot get option lists, please contact administrator")})}]),angular.module("deviser.filemanger",["ui.router","ui.bootstrap","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("FileManagerCtrl",["$scope","$timeout","$filter","$q","globals","fileService",function(e,o,t,n,r,i){var a=this;function s(){i.get().then(function(e){a.files=e},function(e){var t,n;t="error",n="Cannot get all files and folders, please contact administrator",a.message={messageType:t,content:n},o(function(){a.message={}},r.appSettings.alertLifeTime)})}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,a.alerts=[],a.upload=function(){},s()}]),angular.module("deviser.language",["ui.router","ui.bootstrap","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("LanguageCtrl",["$scope","$timeout","$filter","$q","globals","languageService",function(e,n,t,o,r,i){var a=this;function s(r){i.getSiteLanguages().then(function(e){a.siteLanguages=e;var t=_.filter(e,"isActive");if(r)if(console.log(pageContext),1==t.length){c("success","URLs has been updated based on active languages, this page will be reloaded automatically");var n=pageContext.currentUrl;_.forEach(a.siteLanguages,function(e){e=e.cultureCode.toLowerCase()+"/",_.startsWith(n,e)&&(n=_.replace(n,e,""))}),setTimeout(function(){window.location="/"+n},5e3)}else if(2==t.length){c("success","URLs has been updated based on active languages, this page will be reloaded automatically");var n=pageContext.currentUrl,o=pageContext.currentLocale.toLowerCase()+"/";_.startsWith(n,o)||(n=o+n),setTimeout(function(){window.location="/"+n},5e3)}},function(e){c("error","Cannot get site languages, please contact administrator")})}function c(e,t){a.message={messageType:e,content:t},n(function(){a.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,a.alerts=[],a.add=function(){a.currentViewState=a.viewStates.NEW},a.save=function(){i.post(a.selectedLanguage).then(function(e){console.log(e),a.currentViewState=a.viewStates.LIST,a.selectedLanguage={},s(),c("success","New language has been added")},function(e){c("error","Cannot add language, please contact administrator")})},a.activate=function(e){e.cultureCode!==pageContext.siteLanguage&&i.put(e).then(function(e){console.log(e),s(!0),c("success","Language has been updated")},function(e){c("error","Cannot update language, please contact administrator")})},a.cancel=function(){a.currentViewState=a.viewStates.LIST},a.viewStates={NEW:"NEW",LIST:"LIST"},a.currentViewState=a.viewStates.LIST,a.siteLanguage=pageContext.siteLanguage,i.get().then(function(e){a.languages=e},function(e){c("error","Cannot get all languages, please contact administrator")}),s()}]),function(){var e=angular.module("deviser.pageMangement",["ui.router","ui.bootstrap","ui.tree","ui.select","dev.modal","dev.sdlib","deviser.services","deviser.config"]);e.controller("PageManagementCtrl",["$scope","$timeout","$filter","$q","modalService","globals","pageService","themeService","languageService","roleService",function(e,n,t,o,r,i,a,s,c,l){var u=this,d=(i.appSettings.systemErrorMsg,i.appSettings.permissions.pageView),p=i.appSettings.permissions.pageEdit,f=i.appSettings.roles.administrator;u.alerts=[],u.pages=[],u.selectedItem={},u.liveTill={},u.liveFrom={},u.administratorRoleId=f,u.pageTypes=i.appSettings.pageTypes,u.reSortPages=function(e){e&&e.childPage&&_.forEach(e.childPage,function(e,t){e.pageOrder=t+1,u.reSortPages(e)})};var g=!1;function m(){a.get().then(function(e){u.pages=[],u.pages.push(e),function n(e){e&&(1==e.pageLevel&&(e.collapsed=!0),e.childPage?(e.childPage=_.sortBy(e.childPage,function(e){return e.pageOrder}),_.sortBy(e.childPage,function(e,t){n(e)})):e.childPage=[])}(u.pages[0])},function(e){T("error","Cannot load pages, please contact administrator")})}function v(e){u.currentLocale=u.siteLanguage,e.pageTranslation&&0!==e.pageTranslation.length||(e.pageTranslation=[{locale:u.currentLocale}]),u.selectedItem=e,u.accordion.common=!u.accordion.permissions,u.selectedItem.pagePermissions&&_.forEach(u.selectedItem.pagePermissions,function(e){e.isView=function(e){}})}function h(e,t){var n=_.find(e.pagePermissions,function(e){return e.roleId===t.id&&e.permissionId===d});return n}function S(e,t){var n=_.find(e.pagePermissions,function(e){return e.roleId===t.id&&e.permissionId===p});return n}function y(e){g?a.post(e).then(function(e){g=!1,u.selectedItem=e,m(),T("success","Page created successfully")},function(e){T("error","'Cannot create page, please contact administrator")}):a.put(e,e.id).then(function(e){u.selectedItem=e,m(),T("success","Page updated successfully")},function(e){T("error","'Cannot update page, please contact administrator")})}function T(e,t){u.message={messageType:e,content:t},n(function(){u.message={}},i.appSettings.alertLifeTime)}u.options={accept:function(e,t,n){return t&&0<t.depth()},dropped:function(e){var t=e.source.nodeScope.page,n=e.dest.nodesScope.page;t&&n&&(t.parentId=n.id,t.pageLevel=e.dest.nodesScope.depth(),u.reSortPages(u.pages[0]),a.put(u.pages[0]).then(function(e){m(),T("success","All pages updated successfully")},function(e){T("error","'Cannot update all pages, please contact administrator")}))}},u.dateFormat="dd.MM.yyyy",u.openDatePicker=function(e,t){e.preventDefault(),e.stopPropagation(),t.opened=!0},u.dateOptions={formatYear:"yy",startingDay:1},u.disabledDatePicker=function(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())},e.$watch(function(){return u.pages},function(){u.isChanged=!0},!0),u.toggle=function(e){e.collapsed=!e.collapsed},u.selectPage=v,u.newSubPage=function(e){g=!0;var t={parentId:e.id,childPage:[],pageLevel:e.pageLevel+1,pageTypeId:u.pageTypes.standard.id,pageTranslation:[{locale:u.currentLocale,name:"",url:"",title:null,description:null,keywords:null}]};e.childPage||(e.childPage=[]);e.childPage.push(t),v(t)},u.changeLanguage=function(){if(!_.find(u.selectedItem.pageTranslation,{locale:u.currentLocale})){var e=_.find(u.selectedItem.pageTranslation,{locale:u.siteLanguage});(e=JSON.parse(angular.toJson(e))).locale=u.currentLocale,e.name="",e.title="",e.description="",e.keywords="",u.selectedItem.pageTranslation.push(e)}},u.save=function(){u.selectedItem&&e.managePage.$valid&&y(u.selectedItem)},u.isView=h,u.isEdit=S,u.changeViewPermission=function(e,t){if(t.id!==f)if(h(e,t))e.pagePermissions=_.reject(e.pagePermissions,function(e){return e.roleId===t.id&&e.permissionId===d});else{var n={pageId:e.id,roleId:t.id,permissionId:d};e.pagePermissions.push(n)}},u.changeEditPermission=function(e,t){if(t.id!==f)if(S(e,t))e.pagePermissions=_.reject(e.pagePermissions,function(e){return e.roleId===t.id&&e.permissionId===p});else{var n={pageId:e.id,roleId:t.id,permissionId:p};e.pagePermissions.push(n)}},u.siteLanguage="en-US",u.openConfirmDialog=function(n){var e={title:"Delete Confirmation",body:"Are you sure to delete the "+n.pageTranslation[0].name+" page?",okLabel:"Yes",cancelLabel:"No"};r.showConfirmation(e).then(function(e){if(console.log("Modal agreed at: "+new Date),n){var t=n.id;a.remove(t).then(function(e){n.isDeleted=!0,T("success","Page has been removed")},function(e){T("error","'Cannot remove page, please contact administrator")})}},function(){console.log("Modal dismissed at: "+new Date)})},u.collapseAll=function(){e.$broadcast("angular-ui-tree:collapse-all")},u.currentLocale=pageContext.currentLocale,u.accordion={},m(),l.get().then(function(e){u.roles=e},function(e){T("error","Cannot get all roles, please contact administrator")}),s.get().then(function(e){u.themes=e},function(e){T("error","Cannot load theme, please contact administrator")}),c.getSiteLanguages().then(function(e){u.languages=e},function(e){T("error","Cannot get all languages, please contact administrator")})}]),e.filter("selectLanguage",function(){return function(e,t){return e&&t?_.filter(e,function(e){return e.locale===t}):e}})}(),angular.module("deviser.module",["ui.router","ui.bootstrap","ui.tree","ui.select","dev.sdlib","deviser.services","deviser.config"]).controller("ModuleManagementCtrl",["$scope","$timeout","$filter","$q","globals","moduleService","moduleActionService","propertyService",function(t,n,e,o,r,i,a,s){var c=this;function l(){i.get().then(function(e){c.modules=e},function(e){f("error","Cannot get all modules, please contact administrator")})}function u(){s.get().then(function(e){c.properties=e},function(e){f("error","Cannot get all properties, please contact administrator")})}function d(e){i.put(e,e.id).then(function(e){console.log(e),l(),f("success","Modulehas been updated"),c.currentViewState=c.viewStates.LIST},function(e){f("error","Cannot update module, please contact administrator")})}function p(){var e=_.find(c.selectedModuleAction.properties,{id:c.selectedProperty.id});return e}function f(e,t){c.message={messageType:e,content:t},n(function(){c.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,c.alerts=[],c.add=function(){c.currentViewState=c.viewStates.NEW,c.selectedModule={}},c.edit=function(e){t.editModuleForm.submitted=!1,t.newModuleForm.submitted=!1,c.currentViewState=c.viewStates.EDIT,c.selectedModule=e},c.activate=function(e){d(e)},c.isValidName=function(e){return!_.find(c.modules,{name:e})},c.remove=function(e){i.remove(e.id).then(function(e){console.log(e),l(),c.currentViewState=c.viewStates.LIST,f("success","Module has been removed")},function(e){f("error","Cannot remove Module, please contact administrator")})},c.save=function(){t.newModuleForm.submitted=!0,t.newModuleForm.$valid&&(t.newModuleForm.submitted=!1,c.currentViewState==c.viewStates.NEW&&c.isValidName(c.selectedModule.name)?i.post(c.selectedModule).then(function(e){console.log(e),c.currentViewState=c.viewStates.LIST,c.selectedModule={},l(),f("success","New module has been added")},function(e){f("error","Cannot add module, please contact administrator")}):d(c.selectedModule))},c.cancel=function(){c.currentViewState=c.viewStates.LIST},c.addModuleActions=function(){c.currentViewState=c.viewStates.NEWMODULEACTION;var e={displayName:""};c.selectedModule.moduleAction||(c.selectedModule.moduleAction=[]),c.selectedModule.moduleAction.push(e),c.selectedModuleAction=e},c.editModuleActions=function(e){c.currentViewState=c.viewStates.EDITMODULEACTION,c.selectedModuleAction=e},c.removeModuleActions=function(e){var t=c.selectedModule.moduleAction.indexOf(e);c.selectedModule.moduleAction.splice(t,1)},c.saveModuleAction=function(){t.editModuleForm.submitted=!0,t.editModuleForm.$valid&&(t.editModuleForm.submitted=!1,c.currentViewState=c.viewStates.LISTMODULEACTION)},c.addProperty=function(){p()||(c.selectedModuleAction.properties||(c.selectedModuleAction.properties=[]),c.selectedProperty.id?c.selectedModuleAction.properties.push(c.selectedProperty):s.post(c.selectedProperty).then(function(e){console.log(e),c.selectedProperty=e,c.selectedModuleAction.properties.push(c.selectedProperty),u(),f("success","New property has been added")},function(e){f("error","Cannot add new property, please contact administrator")}))},c.isPropExist=p,c.removeProperty=function(t){c.selectedModuleAction.properties=_.reject(c.selectedModuleAction.properties,function(e){return e.id===t.id})},c.propertyTransform=function(e){var t=e.replace(/\s+/g,"");return{name:t=t.toLowerCase(),label:e}},c.viewStates={NEW:"NEW",LIST:"LIST",EDIT:"EDIT",NEWMODULEACTION:"NEWMODULEACTION",LISTMODULEACTION:"LISTMODULEACTION",EDITMODULEACTION:"EDITMODULEACTION"},c.currentViewState=c.viewStates.LIST,c.modules={},c.moduleActions={},l(),a.get().then(function(e){c.moduleActions=e},function(e){f("error","Cannot get all module actions, please contact administrator")}),i.getModuleActionTypes().then(function(e){c.moduleActionTypes=e},function(e){f("error","Cannot get all module action types, please contact administrator")}),u()}]),angular.module("deviser.recycleBin",["ui.router","ui.bootstrap","ui.tree","dev.sdlib","deviser.services","deviser.config"]).controller("RecycleBinCtrl",["$scope","$timeout","$filter","$q","globals","pageService","layoutService","pageContentService","pageModuleService",function(e,n,t,o,r,i,a,s,c){var l=this;function u(){i.getDeletedPages().then(function(e){_.forEach(e,function(e){e.pageTranslation=_.find(e.pageTranslation,{locale:pageContext.siteLanguage})}),l.pages=e},function(e){g("error","Cannot get the pages, please contact administrator")})}function d(){a.getDeletedLayouts().then(function(e){l.layouts=e},function(e){g("error","Cannot get the layouts, please contact administrator")})}function p(){s.getDeletedPageContents().then(function(e){_.forEach(e,function(e){e.page.pageTranslation=_.find(e.page.pageTranslation,{locale:pageContext.siteLanguage})}),l.pageContents=e},function(e){g("error","Cannot get the page content elements, please contact administrator")})}function f(){c.getDeletedPageModules().then(function(e){_.forEach(e,function(e){e.page.pageTranslation=_.find(e.page.pageTranslation,{locale:pageContext.siteLanguage})}),l.pageModules=e},function(e){g("error","Cannot get the page modules, please contact administrator")})}function g(e,t){l.message={messageType:e,content:t},n(function(){l.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,l.alerts=[],l.restorePage=function(e){i.restorePage(e).then(function(e){!1===e.isDeleted&&u(),g("success","The page has been restored")},function(e){g("error","Cannot restore the page, please contact administrator")})},l.restorePageContent=function(e){s.restorePageContent(e).then(function(e){!1===e.isDeleted&&p(),g("success","The page content has been restored")},function(e){g("error","Cannot restore the page content, please contact administrator")})},l.restorePageModule=function(e){c.restorePageModule(e).then(function(e){!1===e.isDeleted&&f(),g("success","The page module has been restored")},function(e){g("error","Cannot restore the page module, please contact administrator")})},l.restoreLayout=function(e){a.restoreLayout(e).then(function(e){!1===e.isDeleted&&d(),g("success","The layout has been restored")},function(e){g("error","Cannot restore the layout, please contact administrator")})},l.deletePage=function(e){i.deletePage(e).then(function(e){u(),g("success","The page has been deleted")},function(e){g("error","Cannot delete the page, please contact administrator")})},l.deletePageContent=function(e){s.deletePageContent(e).then(function(e){p(),g("success","The page content has been deleted")},function(e){g("error","Cannot delete the page content, please contact administrator")})},l.deletePageModule=function(e){c.deletePageModule(e).then(function(e){f(),g("success","The page module has been deleted")},function(e){g("error","Cannot delete the page module, please contact administrator")})},l.deleteLayout=function(e){a.remove(e).then(function(e){d(),g("success","The layout has been deleted")},function(e){g("error","Cannot delete the layout, please contact administrator")})},u(),d(),p(),f()}]),angular.module("deviser.securityRoles",["ui.router","ui.bootstrap","ui.tree","dev.sdlib","deviser.services","deviser.config"]).controller("SecurityRolesCtrl",["$scope","$timeout","$filter","$q","globals","roleService",function(e,n,t,o,r,i){var a=this;function s(){i.get().then(function(e){a.roles=e},function(e){c("error","Cannot get all roles, please contact administrator")})}function c(e,t){a.message={messageType:e,content:t},n(function(){a.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,a.alerts=[],a.add=function(){a.currentViewState=a.viewStates.NEW},a.edit=function(e){a.selectedRole=e,a.currentViewState=a.viewStates.EDIT},a.remove=function(e){i.remove(e.id).then(function(e){console.log(e),s(),a.currentViewState=a.viewStates.LIST,c("success","Role has been removed")},function(e){c("error","Cannot remove role, please contact administrator")})},a.save=function(){e.roleForm.submitted=!0,a.currentViewState==a.viewStates.EDIT?e.editRoleForm.$valid&&i.put(a.selectedRole).then(function(e){console.log(e),s(),a.currentViewState=a.viewStates.LIST,c("success","Role has been updated")},function(e){c("error","Cannot update role, please contact administrator")}):a.currentViewState==a.viewStates.NEW&&e.roleForm.$valid&&i.post(a.newRole).then(function(e){console.log(e),a.currentViewState=a.viewStates.LIST,a.newRole={},s(),c("success","New role has been created")},function(e){c("error","Cannot create role, please contact administrator")})},a.cancel=function(){a.currentViewState=a.viewStates.LIST},a.hasError=function(e,t,n){return e&&n?e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n]:e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid},a.viewStates={NEW:"NEW",LIST:"LIST",EDIT:"EDIT"},a.currentViewState=a.viewStates.LIST,s()}]),angular.module("deviser.siteSettings",["ui.router","ui.bootstrap","ui.select","dev.sdlib","dev.modal","deviser.services","deviser.config"]).controller("SiteSettingsCtrl",["$scope","$timeout","$filter","$q","globals","devUtil","modalService","siteSettingService","pageService","layoutService","themeService","languageService","applicationService",function(e,n,t,o,r,i,a,s,c,l,u,d,p){var f=this;function g(){var t=(new signalR.HubConnectionBuilder).withUrl("/appHub").configureLogging(signalR.LogLevel.Information).build();function n(t){t.start().catch(function(e){o(3e3),console.log("Reconnecting Socket"),n(t)})}function o(e){for(var t=(new Date).getTime(),n=0;n<1e7&&!((new Date).getTime()-t>e);n++);}t.on("OnStarted",function(e){console.log(e),location.reload()}),n(t),t.onclose(function(e){n(t)})}function m(){s.get().then(function(e){f.siteSettings=e,f.setting=_.keyBy(e,"settingName"),_.forEach(f.setting,function(e){e&&e.settingValue&&("true"===e.settingValue?e.settingValue=!0:"false"===e.settingValue&&(e.settingValue=!1))})},function(e){v("error","Cannot get all Site Settings, please contact administrator")})}function v(e,t){f.message={messageType:e,content:t},n(function(){f.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,f.alerts=[],f.update=function(){var e=_.values(f.setting);s.put(e).then(function(e){m(),v("success","Site Settings has been updated")},function(e){v("error","Cannot update site setting please contact administrator")})},f.restartApplication=function(){a.showProgressModel("Please wait..."),p.restart().then(function(e){},function(e){})},f.cancel=function(){m()},f.setting={},m(),c.getPages().then(function(e){f.pages=e,_.each(f.pages,function(e){var t=_.find(e.pageTranslation,{locale:"en-US"});e.pageName=t.name})}),l.get().then(function(e){f.layouts=e}),u.get().then(function(e){f.themes=e}),d.getSiteLanguages().then(function(e){f.languages=_.filter(e,{isActive:!0})},function(e){v("error","Cannot get all languages, please contact administrator")}),g()}]),angular.module("deviser.userManagement",["ui.router","ui.bootstrap","ui.tree","ui.select","ngSanitize","dev.sdlib","deviser.services","deviser.config"]).controller("UserManagementCtrl",["$scope","$timeout","$filter","$q","globals","userService","userExistService","passwordResetService","roleService","userRoleService",function(n,o,e,t,r,i,a,s,c,l){var u,d=this;function p(){i.get().then(function(e){d.users=e},function(e){g("error","Cannot get users, please contact administrator")})}function f(){d.selectedUser&&(d.roles=_.reject(u,function(e){return _.find(d.selectedUser.roles,{id:e.id})}))}function g(e,t){d.message={messageType:e,content:t},o(function(){d.message={}},r.appSettings.alertLifeTime)}SYS_ERROR_MSG=r.appSettings.systemErrorMsg,d.alerts=[],d.add=function(){d.currentViewState=d.viewStates.NEW},d.edit=function(e){d.selectedUser=e,f(),d.currentViewState=d.viewStates.EDIT},d.remove=function(e){i.remove(e.id).then(function(e){console.log(e),p(),g("success","User has been removed")},function(e){g("error","Cannot remove the user, please contact administrator")})},d.save=function(){n.userForm.submitted=!0,d.currentViewState==d.viewStates.EDIT?n.editUserForm.$valid&&i.put(d.selectedUser).then(function(e){console.log(e),d.currentViewState=d.viewStates.LIST,g("success","Profile has been updated")},function(e){g("error","Cannot update user, please contact administrator")}):d.currentViewState==d.viewStates.NEW&&n.userForm.$valid&&!d.isUserExist&&i.post(d.newUser).then(function(e){console.log(e),d.currentViewState=d.viewStates.LIST,d.newUser={},p(),g("success","New user has been created")},function(e){if(e.errors){var t="";_.forEach(e.errors,function(e){t+=e.description}),g("error",t)}else g("error","Cannot update user, please contact administrator")})},d.cancel=function(){d.currentViewState=d.viewStates.LIST},d.checkUserExist=function(e){if(!n.userForm.email.$error.email&&e){var t={userName:e};a.post(t).then(function(e){d.isUserExist=e},function(e){g("error","Cannot check email address, please contact administrator")})}},d.resetPassword=function(){n.passwordResetForm.submitted=!0,n.passwordResetForm.$valid&&(d.passwordReset.userId=d.selectedUser.id,s.post(d.passwordReset).then(function(e){if(console.log(e),e&&!0===e.succeeded)d.currentViewState=d.viewStates.LIST,d.passwordReset={},p(),g("success","Password has been reset");else if(e.errors){var t="";_.forEach(e.errors,function(e){t+=e.description}),g("error",t)}else g("error","Cannot reset password, please contact administrator")},function(e){g("error","Cannot reset password, please contact administrator")}))},d.addRole=function(){var e={userId:d.selectedUser.id,roleName:d.selectedRole.name};l.post(e).then(function(e){d.selectedUser=e,f()},function(e){g("error","Cannot add role, please contact administrator")})},d.removeRole=function(e){var t={userId:d.selectedUser.id,roleName:e.name};l.remove(t.userId,t.roleName).then(function(e){d.selectedUser=e,f()},function(e){g("error","Cannot remove role, please contact administrator")})},d.hasError=function(e,t,n){return e&&n?e[t].$dirty&&e[t].$error[n]||e.submitted&&e[t].$error[n]:e[t].$dirty&&e[t].$invalid||e.submitted&&e[t].$invalid},d.viewStates={NEW:"NEW",LIST:"LIST",EDIT:"EDIT"},d.isUserExist=!0,d.currentViewState=d.viewStates.LIST,p(),c.get().then(function(e){d.roles=u=e},function(e){g("error","Cannot get roles, please contact administrator")})}]);